/** Copyright (C) Leepfrog Technologies, Inc - All Rights Reserved           **/
/** Unauthorized copying of this file, via any medium is strictly prohibited **/
/** Proprietary and confidential                                             **/
/** License details available from http://www.courseleaf.com/                **/

/** DO NOT EDIT THIS FILE, IT WAS BUILT FROM SOURCE **/


/*! jQuery v2.1.4 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b="length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,aa=/[+~]/,ba=/'|\\/g,ca=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),da=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ea=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fa){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(ba,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+ra(o[l]);w=aa.test(a)&&pa(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",ea,!1):e.attachEvent&&e.attachEvent("onunload",ea)),p=!f(g),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?la(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ca,da),a[3]=(a[3]||a[4]||a[5]||"").replace(ca,da),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ca,da).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(ca,da),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return W.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(ca,da).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:oa(function(){return[0]}),last:oa(function(a,b){return[b-1]}),eq:oa(function(a,b,c){return[0>c?c+b:c]}),even:oa(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:oa(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:oa(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:oa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function qa(){}qa.prototype=d.filters=d.pseudos,d.setFilters=new qa,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function ra(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sa(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function ta(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c){for(var d=0,e=b.length;e>d;d++)ga(a,b[d],c);return c}function va(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wa(a,b,c,d,e,f){return d&&!d[u]&&(d=wa(d)),e&&!e[u]&&(e=wa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ua(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:va(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=va(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=va(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sa(function(a){return a===b},h,!0),l=sa(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sa(ta(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wa(i>1&&ta(m),i>1&&ra(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xa(a.slice(i,e)),f>e&&xa(a=a.slice(e)),f>e&&ra(a))}m.push(c)}return ta(m)}function ya(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=va(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&ga.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,ya(e,d)),f.selector=a}return f},i=ga.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ca,da),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ca,da),aa.test(j[0].type)&&pa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&ra(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,aa.test(a)&&pa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+K.uid++}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){
return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ba=/<([\w:]+)/,ca=/<|&#?\w+;/,da=/<(?:script|style|link)/i,ea=/checked\s*(?:[^=]|=\s*.checked.)/i,fa=/^$|\/(?:java|ecma)script/i,ga=/^true\/(.*)/,ha=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ia={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ia.optgroup=ia.option,ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead,ia.th=ia.td;function ja(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function ka(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function la(a){var b=ga.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function ma(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function na(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function oa(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pa(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=oa(h),f=oa(a),d=0,e=f.length;e>d;d++)pa(f[d],g[d]);if(b)if(c)for(f=f||oa(a),g=g||oa(h),d=0,e=f.length;e>d;d++)na(f[d],g[d]);else na(a,h);return g=oa(h,"script"),g.length>0&&ma(g,!i&&oa(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if("object"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(ca.test(e)){f=f||k.appendChild(b.createElement("div")),g=(ba.exec(e)||["",""])[1].toLowerCase(),h=ia[g]||ia._default,f.innerHTML=h[1]+e.replace(aa,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=oa(k.appendChild(e),"script"),i&&ma(f),c)){j=0;while(e=f[j++])fa.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=ja(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=ja(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(oa(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&ma(oa(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(oa(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!da.test(a)&&!ia[(ba.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(aa,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(oa(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(oa(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&ea.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(oa(c,"script"),ka),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,oa(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,la),j=0;g>j;j++)h=f[j],fa.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(ha,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qa,ra={};function sa(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function ta(a){var b=l,c=ra[a];return c||(c=sa(a,b),"none"!==c&&c||(qa=(qa||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qa[0].contentDocument,b.write(),b.close(),c=sa(a,b),qa.detach()),ra[a]=c),c}var ua=/^margin/,va=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wa=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};function xa(a,b,c){var d,e,f,g,h=a.style;return c=c||wa(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),va.test(g)&&ua.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function ya(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),f.removeChild(c),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var za=/^(none|table(?!-c[ea]).+)/,Aa=new RegExp("^("+Q+")(.*)$","i"),Ba=new RegExp("^([+-])=("+Q+")","i"),Ca={position:"absolute",visibility:"hidden",display:"block"},Da={letterSpacing:"0",fontWeight:"400"},Ea=["Webkit","O","Moz","ms"];function Fa(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Ea.length;while(e--)if(b=Ea[e]+c,b in a)return b;return d}function Ga(a,b,c){var d=Aa.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Ha(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ia(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wa(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xa(a,b,f),(0>e||null==e)&&(e=a.style[b]),va.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Ha(a,b,c||(g?"border":"content"),d,f)+"px"}function Ja(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",ta(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xa(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fa(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ba.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fa(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xa(a,b,d)),"normal"===e&&b in Da&&(e=Da[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?za.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Ca,function(){return Ia(a,b,d)}):Ia(a,b,d):void 0},set:function(a,c,d){var e=d&&wa(a);return Ga(a,c,d?Ha(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=ya(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xa,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ua.test(a)||(n.cssHooks[a+b].set=Ga)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wa(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Ja(this,!0)},hide:function(){return Ja(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Ka(a,b,c,d,e){return new Ka.prototype.init(a,b,c,d,e)}n.Tween=Ka,Ka.prototype={constructor:Ka,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Ka.propHooks[this.prop];return a&&a.get?a.get(this):Ka.propHooks._default.get(this)},run:function(a){var b,c=Ka.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ka.propHooks._default.set(this),this}},Ka.prototype.init.prototype=Ka.prototype,Ka.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Ka.propHooks.scrollTop=Ka.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Ka.prototype.init,n.fx.step={};var La,Ma,Na=/^(?:toggle|show|hide)$/,Oa=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pa=/queueHooks$/,Qa=[Va],Ra={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Oa.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Oa.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sa(){return setTimeout(function(){La=void 0}),La=n.now()}function Ta(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ua(a,b,c){for(var d,e=(Ra[b]||[]).concat(Ra["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Va(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||ta(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Na.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?ta(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ua(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wa(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xa(a,b,c){var d,e,f=0,g=Qa.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=La||Sa(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:La||Sa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wa(k,j.opts.specialEasing);g>f;f++)if(d=Qa[f].call(j,a,k,j.opts))return d;return n.map(k,Ua,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xa,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Ra[c]=Ra[c]||[],Ra[c].unshift(b)},prefilter:function(a,b){b?Qa.unshift(a):Qa.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xa(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pa.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Ta(b,!0),a,d,e)}}),n.each({slideDown:Ta("show"),slideUp:Ta("hide"),slideToggle:Ta("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(La=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),La=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ma||(Ma=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Ma),Ma=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Ya,Za,$a=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Za:Ya)),
void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Za={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$a[b]||n.find.attr;$a[b]=function(a,b,d){var e,f;return d||(f=$a[b],$a[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$a[b]=f),e}});var _a=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_a.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ab=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ab," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ab," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ab," ").indexOf(b)>=0)return!0;return!1}});var bb=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cb=n.now(),db=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var eb=/#.*$/,fb=/([?&])_=[^&]*/,gb=/^(.*?):[ \t]*([^\r\n]*)$/gm,hb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ib=/^(?:GET|HEAD)$/,jb=/^\/\//,kb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,lb={},mb={},nb="*/".concat("*"),ob=a.location.href,pb=kb.exec(ob.toLowerCase())||[];function qb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function rb(a,b,c,d){var e={},f=a===mb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function sb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function tb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function ub(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ob,type:"GET",isLocal:hb.test(pb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":nb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?sb(sb(a,n.ajaxSettings),b):sb(n.ajaxSettings,a)},ajaxPrefilter:qb(lb),ajaxTransport:qb(mb),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=gb.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||ob)+"").replace(eb,"").replace(jb,pb[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=kb.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===pb[1]&&h[2]===pb[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(pb[3]||("http:"===pb[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),rb(lb,k,b,v),2===t)return v;i=n.event&&k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!ib.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(db.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=fb.test(d)?d.replace(fb,"$1_="+cb++):d+(db.test(d)?"&":"?")+"_="+cb++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+nb+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=rb(mb,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=tb(k,v,f)),u=ub(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var vb=/%20/g,wb=/\[\]$/,xb=/\r?\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;function Ab(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||wb.test(a)?d(a,e):Ab(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Ab(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Ab(c,a[c],b,e);return d.join("&").replace(vb,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&zb.test(this.nodeName)&&!yb.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(xb,"\r\n")}}):{name:b.name,value:c.replace(xb,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Bb=0,Cb={},Db={0:200,1223:204},Eb=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Cb)Cb[a]()}),k.cors=!!Eb&&"withCredentials"in Eb,k.ajax=Eb=!!Eb,n.ajaxTransport(function(a){var b;return k.cors||Eb&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Bb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Cb[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Db[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Cb[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Fb=[],Gb=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Fb.pop()||n.expando+"_"+cb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Gb.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Gb,"$1"+e):b.jsonp!==!1&&(b.url+=(db.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Fb.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Hb=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Hb)return Hb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Ib=a.document.documentElement;function Jb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Jb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Ib;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Ib})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Jb(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=ya(k.pixelPosition,function(a,c){return c?(c=xa(a,b),va.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Kb=a.jQuery,Lb=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Lb),b&&a.jQuery===n&&(a.jQuery=Kb),n},typeof b===U&&(a.jQuery=a.$=n),n});

//need to add this in since lfjs has jQuery.browser references
jQuery.uaMatch = function (ua) {
	ua = ua.toLowerCase();

	var match = /(chrome)[ \/]([\w.]+)/.exec(ua) ||
		/(webkit)[ \/]([\w.]+)/.exec(ua) ||
		/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua) ||
		/(msie) ([\w.]+)/.exec(ua) ||
		ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua) ||
		[];

	return {
		browser: match[1] || "",
		version: match[2] || "0"
	};
};

// Don't clobber any existing jQuery.browser in case it's different
if (!jQuery.browser) {
	var matched = jQuery.uaMatch(navigator.userAgent);
	var browser = {};

	if (matched.browser) {
		browser[matched.browser] = true;
		browser.version = matched.version;
	}

	// Chrome is Webkit, but Webkit is also Safari.
	if (browser.chrome) {
		browser.webkit = true;
	} else if (browser.webkit) {
		browser.safari = true;
	}

	jQuery.browser = browser;
}
!function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView)}function e(n,t){return t>n?-1:n>t?1:n>=t?0:0/0}function r(n){return null===n?0/0:+n}function u(n){return!isNaN(n)}function i(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)<0?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)>0?u=i:r=i+1}return r}}}function o(n){return n.length}function a(n){for(var t=1;n*t%1;)t*=10;return t}function c(n,t){for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}function l(){this._=Object.create(null)}function s(n){return(n+="")===pa||n[0]===va?va+n:n}function f(n){return(n+="")[0]===va?n.slice(1):n}function h(n){return s(n)in this._}function g(n){return(n=s(n))in this._&&delete this._[n]}function p(){var n=[];for(var t in this._)n.push(f(t));return n}function v(){var n=0;for(var t in this._)++n;return n}function d(){for(var n in this._)return!1;return!0}function m(){this._=Object.create(null)}function y(n){return n}function M(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function x(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=da.length;r>e;++e){var u=da[e]+t;if(u in n)return u}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new l;return t.on=function(t,u){var i,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,i=e.indexOf(o)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function S(){ta.event.preventDefault()}function k(){for(var n,t=ta.event;n=t.sourceEvent;)t=n;return t}function E(n){for(var t=new _,e=0,r=arguments.length;++e<r;)t[arguments[e]]=w(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=ta.event;u.target=n,ta.event=u,t[u.type].apply(e,r)}finally{ta.event=i}}},t}function A(n){return ya(n,_a),n}function N(n){return"function"==typeof n?n:function(){return Ma(n,this)}}function C(n){return"function"==typeof n?n:function(){return xa(n,this)}}function z(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=ta.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?i:u}function q(n){return n.trim().replace(/\s+/g," ")}function L(n){return new RegExp("(?:^|\\s+)"+ta.requote(n)+"(?:\\s+|$)","g")}function T(n){return(n+"").trim().split(/^|\s+/)}function R(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=T(n).map(D);var u=n.length;return"function"==typeof t?r:e}function D(n){var t=L(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",q(u+" "+n))):e.setAttribute("class",q(u.replace(t," ")))}}function P(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function U(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function j(n){function t(){var t=this.ownerDocument,e=this.namespaceURI;return e?t.createElementNS(e,n):t.createElement(n)}function e(){return this.ownerDocument.createElementNS(n.space,n.local)}return"function"==typeof n?n:(n=ta.ns.qualify(n)).local?e:t}function F(){var n=this.parentNode;n&&n.removeChild(this)}function H(n){return{__data__:n}}function O(n){return function(){return ba(this,n)}}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function Y(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,e);return n}function Z(n){return ya(n,Sa),n}function V(n){var t,e;return function(r,u,i){var o,a=n[i].update,c=a.length;for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function X(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=c(t,ra(arguments));r.call(this),this.addEventListener(n,this[o]=u,u.$=e),u._=t}function i(){var t,e=new RegExp("^__on([^.]+)"+ta.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),c=$;a>0&&(n=n.slice(0,a));var l=ka.get(n);return l&&(n=l,c=B),a?t?u:r:t?b:i}function $(n,t){return function(e){var r=ta.event;ta.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ta.event=r}}}function B(n,t){var e=$(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function W(e){var r=".dragsuppress-"+ ++Aa,u="click"+r,i=ta.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);if(null==Ea&&(Ea="onselectstart"in e?!1:x(e.style,"userSelect")),Ea){var o=n(e).style,a=o[Ea];o[Ea]="none"}return function(n){if(i.on(r,null),Ea&&(o[Ea]=a),n){var t=function(){i.on(u,null)};i.on(u,function(){S(),t()},!0),setTimeout(t,0)}}}function J(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var u=r.createSVGPoint();if(0>Na){var i=t(n);if(i.scrollX||i.scrollY){r=ta.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=r[0][0].getScreenCTM();Na=!(o.f||o.e),r.remove()}}return Na?(u.x=e.pageX,u.y=e.pageY):(u.x=e.clientX,u.y=e.clientY),u=u.matrixTransform(n.getScreenCTM().inverse()),[u.x,u.y]}var a=n.getBoundingClientRect();return[e.clientX-a.left-n.clientLeft,e.clientY-a.top-n.clientTop]}function G(){return ta.event.changedTouches[0].identifier}function K(n){return n>0?1:0>n?-1:0}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function nt(n){return n>1?0:-1>n?qa:Math.acos(n)}function tt(n){return n>1?Ra:-1>n?-Ra:Math.asin(n)}function et(n){return((n=Math.exp(n))-1/n)/2}function rt(n){return((n=Math.exp(n))+1/n)/2}function ut(n){return((n=Math.exp(2*n))-1)/(n+1)}function it(n){return(n=Math.sin(n/2))*n}function ot(){}function at(n,t,e){return this instanceof at?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof at?new at(n.h,n.s,n.l):bt(""+n,_t,at):new at(n,t,e)}function ct(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,i=2*e-o,new mt(u(n+120),u(n),u(n-120))}function lt(n,t,e){return this instanceof lt?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof lt?new lt(n.h,n.c,n.l):n instanceof ft?gt(n.l,n.a,n.b):gt((n=wt((n=ta.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new lt(n,t,e)}function st(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new ft(e,Math.cos(n*=Da)*t,Math.sin(n)*t)}function ft(n,t,e){return this instanceof ft?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof ft?new ft(n.l,n.a,n.b):n instanceof lt?st(n.h,n.c,n.l):wt((n=mt(n)).r,n.g,n.b):new ft(n,t,e)}function ht(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=pt(u)*Xa,r=pt(r)*$a,i=pt(i)*Ba,new mt(dt(3.2404542*u-1.5371385*r-.4985314*i),dt(-.969266*u+1.8760108*r+.041556*i),dt(.0556434*u-.2040259*r+1.0572252*i))}function gt(n,t,e){return n>0?new lt(Math.atan2(e,t)*Pa,Math.sqrt(t*t+e*e),n):new lt(0/0,0/0,n)}function pt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function vt(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function dt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function mt(n,t,e){return this instanceof mt?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof mt?new mt(n.r,n.g,n.b):bt(""+n,mt,ct):new mt(n,t,e)}function yt(n){return new mt(n>>16,n>>8&255,255&n)}function Mt(n){return yt(n)+""}function xt(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function bt(n,t,e){var r,u,i,o=0,a=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(kt(u[0]),kt(u[1]),kt(u[2]))}return(i=Ga.get(n.toLowerCase()))?t(i.r,i.g,i.b):(null==n||"#"!==n.charAt(0)||isNaN(i=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&i)>>4,o=o>>4|o,a=240&i,a=a>>4|a,c=15&i,c=c<<4|c):7===n.length&&(o=(16711680&i)>>16,a=(65280&i)>>8,c=255&i)),t(o,a,c))}function _t(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=0/0,u=c>0&&1>c?0:r),new at(r,u,c)}function wt(n,t,e){n=St(n),t=St(t),e=St(e);var r=vt((.4124564*n+.3575761*t+.1804375*e)/Xa),u=vt((.2126729*n+.7151522*t+.072175*e)/$a),i=vt((.0193339*n+.119192*t+.9503041*e)/Ba);return ft(116*u-16,500*(r-u),200*(u-i))}function St(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function kt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function Et(n){return"function"==typeof n?n:function(){return n}}function At(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Nt(t,e,n,r)}}function Nt(n,t,e,r){function u(){var n,t=c.status;if(!t&&zt(c)||t>=200&&300>t||304===t){try{n=e.call(i,c)}catch(r){return void o.error.call(i,r)}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=ta.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,l=null;return!this.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=ta.event;ta.event=n;try{o.progress.call(i,c)}finally{ta.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(l=n,i):l},i.response=function(n){return e=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(ra(arguments)))}}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var s in a)c.setRequestHeader(s,a[s]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=l&&(c.responseType=l),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==r?null:r),i},i.abort=function(){return c.abort(),i},ta.rebind(i,o,"on"),null==r?i:i.get(Ct(r))}function Ct(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function zt(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function qt(){var n=Lt(),t=Tt()-n;t>24?(isFinite(t)&&(clearTimeout(tc),tc=setTimeout(qt,t)),nc=0):(nc=1,rc(qt))}function Lt(){var n=Date.now();for(ec=Ka;ec;)n>=ec.t&&(ec.f=ec.c(n-ec.t)),ec=ec.n;return n}function Tt(){for(var n,t=Ka,e=1/0;t;)t.f?t=n?n.n=t.n:Ka=t.n:(t.t<e&&(e=t.t),t=(n=t).n);return Qa=n,e}function Rt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Dt(n,t){var e=Math.pow(10,3*ga(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function Pt(n){var t=n.decimal,e=n.thousands,r=n.grouping,u=n.currency,i=r&&e?function(n,t){for(var u=n.length,i=[],o=0,a=r[0],c=0;u>0&&a>0&&(c+a+1>t&&(a=Math.max(1,t-c)),i.push(n.substring(u-=a,u+a)),!((c+=a+1)>t));)a=r[o=(o+1)%r.length];return i.reverse().join(e)}:y;return function(n){var e=ic.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"-",c=e[4]||"",l=e[5],s=+e[6],f=e[7],h=e[8],g=e[9],p=1,v="",d="",m=!1,y=!0;switch(h&&(h=+h.substring(1)),(l||"0"===r&&"="===o)&&(l=r="0",o="="),g){case"n":f=!0,g="g";break;case"%":p=100,d="%",g="f";break;case"p":p=100,d="%",g="r";break;case"b":case"o":case"x":case"X":"#"===c&&(v="0"+g.toLowerCase());case"c":y=!1;case"d":m=!0,h=0;break;case"s":p=-1,g="r"}"$"===c&&(v=u[0],d=u[1]),"r"!=g||h||(g="g"),null!=h&&("g"==g?h=Math.max(1,Math.min(21,h)):("e"==g||"f"==g)&&(h=Math.max(0,Math.min(20,h)))),g=oc.get(g)||Ut;var M=l&&f;return function(n){var e=d;if(m&&n%1)return"";var u=0>n||0===n&&0>1/n?(n=-n,"-"):"-"===a?"":a;if(0>p){var c=ta.formatPrefix(n,h);n=c.scale(n),e=c.symbol+d}else n*=p;n=g(n,h);var x,b,_=n.lastIndexOf(".");if(0>_){var w=y?n.lastIndexOf("e"):-1;0>w?(x=n,b=""):(x=n.substring(0,w),b=n.substring(w))}else x=n.substring(0,_),b=t+n.substring(_+1);!l&&f&&(x=i(x,1/0));var S=v.length+x.length+b.length+(M?0:u.length),k=s>S?new Array(S=s-S+1).join(r):"";return M&&(x=i(k+x,k.length?s-b.length:1/0)),u+=v,n=x+b,("<"===o?u+n+k:">"===o?k+u+n:"^"===o?k.substring(0,S>>=1)+u+n+k.substring(S):u+(M?n:k+n))+e}}}function Ut(n){return n+""}function jt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ft(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new cc(e-1)),1),e}function i(n,e){return t(n=new cc(+n),e),n}function o(n,r,i){var o=u(n),a=[];if(i>1)for(;r>o;)e(o)%i||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{cc=jt;var r=new jt;return r._=n,o(r,t,e)}finally{cc=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=Ht(n);return c.floor=c,c.round=Ht(r),c.ceil=Ht(u),c.offset=Ht(i),c.range=a,n}function Ht(n){return function(t,e){try{cc=jt;var r=new jt;return r._=t,n(r,e)._}finally{cc=Date}}}function Ot(n){function t(n){function t(t){for(var e,u,i,o=[],a=-1,c=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(c,a)),null!=(u=sc[e=n.charAt(++a)])&&(e=n.charAt(++a)),(i=N[e])&&(e=i(t,null==u?"e"===e?" ":"0":u)),o.push(e),c=a+1);return o.push(n.slice(c,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},u=e(r,n,t,0);if(u!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var i=null!=r.Z&&cc!==jt,o=new(i?jt:cc);return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),i?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var u,i,o,a=0,c=t.length,l=e.length;c>a;){if(r>=l)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=C[o in sc?t.charAt(a++):o],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function r(n,t,e){_.lastIndex=0;var r=_.exec(t.slice(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1}function u(n,t,e){x.lastIndex=0;var r=x.exec(t.slice(e));return r?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1}function i(n,t,e){E.lastIndex=0;var r=E.exec(t.slice(e));return r?(n.m=A.get(r[0].toLowerCase()),e+r[0].length):-1}function o(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1}function a(n,t,r){return e(n,N.c.toString(),t,r)}function c(n,t,r){return e(n,N.x.toString(),t,r)}function l(n,t,r){return e(n,N.X.toString(),t,r)}function s(n,t,e){var r=M.get(t.slice(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}var f=n.dateTime,h=n.date,g=n.time,p=n.periods,v=n.days,d=n.shortDays,m=n.months,y=n.shortMonths;t.utc=function(n){function e(n){try{cc=jt;var t=new cc;return t._=n,r(t)}finally{cc=Date}}var r=t(n);return e.parse=function(n){try{cc=jt;var t=r.parse(n);return t&&t._}finally{cc=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ae;var M=ta.map(),x=Yt(v),b=Zt(v),_=Yt(d),w=Zt(d),S=Yt(m),k=Zt(m),E=Yt(y),A=Zt(y);p.forEach(function(n,t){M.set(n.toLowerCase(),t)});var N={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return y[n.getMonth()]},B:function(n){return m[n.getMonth()]},c:t(f),d:function(n,t){return It(n.getDate(),t,2)},e:function(n,t){return It(n.getDate(),t,2)},H:function(n,t){return It(n.getHours(),t,2)},I:function(n,t){return It(n.getHours()%12||12,t,2)},j:function(n,t){return It(1+ac.dayOfYear(n),t,3)},L:function(n,t){return It(n.getMilliseconds(),t,3)},m:function(n,t){return It(n.getMonth()+1,t,2)},M:function(n,t){return It(n.getMinutes(),t,2)},p:function(n){return p[+(n.getHours()>=12)]},S:function(n,t){return It(n.getSeconds(),t,2)},U:function(n,t){return It(ac.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return It(ac.mondayOfYear(n),t,2)},x:t(h),X:t(g),y:function(n,t){return It(n.getFullYear()%100,t,2)},Y:function(n,t){return It(n.getFullYear()%1e4,t,4)},Z:ie,"%":function(){return"%"}},C={a:r,A:u,b:i,B:o,c:a,d:Qt,e:Qt,H:te,I:te,j:ne,L:ue,m:Kt,M:ee,p:s,S:re,U:Xt,w:Vt,W:$t,x:c,X:l,y:Wt,Y:Bt,Z:Jt,"%":oe};return t}function It(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u)}function Yt(n){return new RegExp("^(?:"+n.map(ta.requote).join("|")+")","i")}function Zt(n){for(var t=new l,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Vt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Xt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function $t(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Bt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Wt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.y=Gt(+r[0]),e+r[0].length):-1}function Jt(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function Gt(n){return n+(n>68?1900:2e3)}function Kt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function Qt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function ne(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function te(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function ee(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function re(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ue(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function ie(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=ga(t)/60|0,u=ga(t)%60;return e+It(r,"0",2)+It(u,"0",2)}function oe(n,t,e){hc.lastIndex=0;var r=hc.exec(t.slice(e,e+1));return r?e+r[0].length:-1}function ae(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ce(){}function le(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u)}function se(n,t){n&&dc.hasOwnProperty(n.type)&&dc[n.type](n,t)}function fe(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function he(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)fe(n[e],t,1);t.polygonEnd()}function ge(){function n(n,t){n*=Da,t=t*Da/2+qa/4;var e=n-r,o=e>=0?1:-1,a=o*e,c=Math.cos(t),l=Math.sin(t),s=i*l,f=u*c+s*Math.cos(a),h=s*o*Math.sin(a);yc.add(Math.atan2(h,f)),r=n,u=c,i=l}var t,e,r,u,i;Mc.point=function(o,a){Mc.point=n,r=(t=o)*Da,u=Math.cos(a=(e=a)*Da/2+qa/4),i=Math.sin(a)},Mc.lineEnd=function(){n(t,e)}}function pe(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function ve(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function de(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function me(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function ye(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Me(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function xe(n){return[Math.atan2(n[1],n[0]),tt(n[2])]}function be(n,t){return ga(n[0]-t[0])<Ca&&ga(n[1]-t[1])<Ca}function _e(n,t){n*=Da;var e=Math.cos(t*=Da);we(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function we(n,t,e){++xc,_c+=(n-_c)/xc,wc+=(t-wc)/xc,Sc+=(e-Sc)/xc}function Se(){function n(n,u){n*=Da;var i=Math.cos(u*=Da),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),l=Math.atan2(Math.sqrt((l=e*c-r*a)*l+(l=r*o-t*c)*l+(l=t*a-e*o)*l),t*o+e*a+r*c);bc+=l,kc+=l*(t+(t=o)),Ec+=l*(e+(e=a)),Ac+=l*(r+(r=c)),we(t,e,r)}var t,e,r;qc.point=function(u,i){u*=Da;var o=Math.cos(i*=Da);t=o*Math.cos(u),e=o*Math.sin(u),r=Math.sin(i),qc.point=n,we(t,e,r)}}function ke(){qc.point=_e}function Ee(){function n(n,t){n*=Da;var e=Math.cos(t*=Da),o=e*Math.cos(n),a=e*Math.sin(n),c=Math.sin(t),l=u*c-i*a,s=i*o-r*c,f=r*a-u*o,h=Math.sqrt(l*l+s*s+f*f),g=r*o+u*a+i*c,p=h&&-nt(g)/h,v=Math.atan2(h,g);Nc+=p*l,Cc+=p*s,zc+=p*f,bc+=v,kc+=v*(r+(r=o)),Ec+=v*(u+(u=a)),Ac+=v*(i+(i=c)),we(r,u,i)}var t,e,r,u,i;qc.point=function(o,a){t=o,e=a,qc.point=n,o*=Da;var c=Math.cos(a*=Da);r=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),we(r,u,i)},qc.lineEnd=function(){n(t,e),qc.lineEnd=ke,qc.point=_e}}function Ae(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function Ne(){return!0}function Ce(n,t,e,r,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(be(e,r)){u.lineStart();for(var a=0;t>a;++a)u.point((e=n[a])[0],e[1]);return void u.lineEnd()}var c=new qe(e,n,null,!0),l=new qe(e,null,c,!1);c.o=l,i.push(c),o.push(l),c=new qe(r,n,null,!1),l=new qe(r,null,c,!0),c.o=l,i.push(c),o.push(l)}}),o.sort(t),ze(i),ze(o),i.length){for(var a=0,c=e,l=o.length;l>a;++a)o[a].e=c=!c;for(var s,f,h=i[0];;){for(var g=h,p=!0;g.v;)if((g=g.n)===h)return;s=g.z,u.lineStart();do{if(g.v=g.o.v=!0,g.e){if(p)for(var a=0,l=s.length;l>a;++a)u.point((f=s[a])[0],f[1]);else r(g.x,g.n.x,1,u);g=g.n}else{if(p){s=g.p.z;for(var a=s.length-1;a>=0;--a)u.point((f=s[a])[0],f[1])}else r(g.x,g.p.x,-1,u);g=g.p}g=g.o,s=g.z,p=!p}while(!g.v);u.lineEnd()}}}function ze(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.n=e=n[r],e.p=u,u=e;u.n=e=n[0],e.p=u}}function qe(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Le(n,t,e,r){return function(u,i){function o(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e)}function a(n,t){var e=u(n,t);d.point(e[0],e[1])}function c(){y.point=a,d.lineStart()}function l(){y.point=o,d.lineEnd()}function s(n,t){v.push([n,t]);var e=u(n,t);x.point(e[0],e[1])}function f(){x.lineStart(),v=[]}function h(){s(v[0][0],v[0][1]),x.lineEnd();var n,t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),p.push(v),v=null,r)if(1&t){n=e[0];var u,r=n.length-1,o=-1;if(r>0){for(b||(i.polygonStart(),b=!0),i.lineStart();++o<r;)i.point((u=n[o])[0],u[1]);i.lineEnd()}}else r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(Te))}var g,p,v,d=t(i),m=u.invert(r[0],r[1]),y={point:o,lineStart:c,lineEnd:l,polygonStart:function(){y.point=s,y.lineStart=f,y.lineEnd=h,g=[],p=[]},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=l,g=ta.merge(g);var n=Fe(m,p);g.length?(b||(i.polygonStart(),b=!0),Ce(g,De,n,e,i)):n&&(b||(i.polygonStart(),b=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),b&&(i.polygonEnd(),b=!1),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},M=Re(),x=t(M),b=!1;return y}}function Te(n){return n.length>1}function Re(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function De(n,t){return((n=n.x)[0]<0?n[1]-Ra-Ca:Ra-n[1])-((t=t.x)[0]<0?t[1]-Ra-Ca:Ra-t[1])}function Pe(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?qa:-qa,c=ga(i-e);ga(c-qa)<Ca?(n.point(e,r=(r+o)/2>0?Ra:-Ra),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):u!==a&&c>=qa&&(ga(e-u)<Ca&&(e-=u*Ca),ga(i-a)<Ca&&(i-=a*Ca),r=Ue(e,r,i,o),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=o),u=a},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function Ue(n,t,e,r){var u,i,o=Math.sin(n-e);return ga(o)>Ca?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+r)/2}function je(n,t,e,r){var u;if(null==n)u=e*Ra,r.point(-qa,u),r.point(0,u),r.point(qa,u),r.point(qa,0),r.point(qa,-u),r.point(0,-u),r.point(-qa,-u),r.point(-qa,0),r.point(-qa,u);else if(ga(n[0]-t[0])>Ca){var i=n[0]<t[0]?qa:-qa;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function Fe(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,o=0;yc.reset();for(var a=0,c=t.length;c>a;++a){var l=t[a],s=l.length;if(s)for(var f=l[0],h=f[0],g=f[1]/2+qa/4,p=Math.sin(g),v=Math.cos(g),d=1;;){d===s&&(d=0),n=l[d];var m=n[0],y=n[1]/2+qa/4,M=Math.sin(y),x=Math.cos(y),b=m-h,_=b>=0?1:-1,w=_*b,S=w>qa,k=p*M;if(yc.add(Math.atan2(k*_*Math.sin(w),v*x+k*Math.cos(w))),i+=S?b+_*La:b,S^h>=e^m>=e){var E=de(pe(f),pe(n));Me(E);var A=de(u,E);Me(A);var N=(S^b>=0?-1:1)*tt(A[2]);(r>N||r===N&&(E[0]||E[1]))&&(o+=S^b>=0?1:-1)}if(!d++)break;h=m,p=M,v=x,f=n}}return(-Ca>i||Ca>i&&0>yc)^1&o}function He(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,l,s;return{lineStart:function(){l=c=!1,s=1},point:function(f,h){var g,p=[f,h],v=t(f,h),d=o?v?0:u(f,h):v?u(f+(0>f?qa:-qa),h):0;if(!e&&(l=c=v)&&n.lineStart(),v!==c&&(g=r(e,p),(be(e,g)||be(p,g))&&(p[0]+=Ca,p[1]+=Ca,v=t(p[0],p[1]))),v!==c)s=0,v?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(a&&e&&o^v){var m;d&i||!(m=r(p,e,!0))||(s=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!v||e&&be(e,p)||n.point(p[0],p[1]),e=p,c=v,i=d},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return s|(l&&c)<<1}}}function r(n,t,e){var r=pe(n),u=pe(t),o=[1,0,0],a=de(r,u),c=ve(a,a),l=a[0],s=c-l*l;if(!s)return!e&&n;var f=i*c/s,h=-i*l/s,g=de(o,a),p=ye(o,f),v=ye(a,h);me(p,v);var d=g,m=ve(p,d),y=ve(d,d),M=m*m-y*(ve(p,p)-1);if(!(0>M)){var x=Math.sqrt(M),b=ye(d,(-m-x)/y);if(me(b,p),b=xe(b),!e)return b;var _,w=n[0],S=t[0],k=n[1],E=t[1];w>S&&(_=w,w=S,S=_);var A=S-w,N=ga(A-qa)<Ca,C=N||Ca>A;if(!N&&k>E&&(_=k,k=E,E=_),C?N?k+E>0^b[1]<(ga(b[0]-w)<Ca?k:E):k<=b[1]&&b[1]<=E:A>qa^(w<=b[0]&&b[0]<=S)){var z=ye(d,(-m+x)/y);return me(z,p),[b,xe(z)]}}}function u(t,e){var r=o?n:qa-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),o=i>0,a=ga(i)>Ca,c=gr(n,6*Da);return Le(t,e,c,o?[0,-n]:[-qa,n-qa])}function Oe(n,t,e,r){return function(u){var i,o=u.a,a=u.b,c=o.x,l=o.y,s=a.x,f=a.y,h=0,g=1,p=s-c,v=f-l;if(i=n-c,p||!(i>0)){if(i/=p,0>p){if(h>i)return;g>i&&(g=i)}else if(p>0){if(i>g)return;i>h&&(h=i)}if(i=e-c,p||!(0>i)){if(i/=p,0>p){if(i>g)return;i>h&&(h=i)}else if(p>0){if(h>i)return;g>i&&(g=i)}if(i=t-l,v||!(i>0)){if(i/=v,0>v){if(h>i)return;g>i&&(g=i)}else if(v>0){if(i>g)return;i>h&&(h=i)}if(i=r-l,v||!(0>i)){if(i/=v,0>v){if(i>g)return;i>h&&(h=i)}else if(v>0){if(h>i)return;g>i&&(g=i)}return h>0&&(u.a={x:c+h*p,y:l+h*v}),1>g&&(u.b={x:c+g*p,y:l+g*v}),u}}}}}}function Ie(n,t,e,r){function u(r,u){return ga(r[0]-n)<Ca?u>0?0:3:ga(r[0]-e)<Ca?u>0?2:1:ga(r[1]-t)<Ca?u>0?1:0:u>0?3:2}function i(n,t){return o(n.x,t.x)}function o(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(n){for(var t=0,e=d.length,r=n[1],u=0;e>u;++u)for(var i,o=1,a=d[u],c=a.length,l=a[0];c>o;++o)i=a[o],l[1]<=r?i[1]>r&&Q(l,i,n)>0&&++t:i[1]<=r&&Q(l,i,n)<0&&--t,l=i;return 0!==t}function l(i,a,c,l){var s=0,f=0;if(null==i||(s=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do l.point(0===s||3===s?n:e,s>1?r:t);while((s=(s+c+4)%4)!==f)}else l.point(a[0],a[1])}function s(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function f(n,t){s(n,t)&&a.point(n,t)}function h(){C.point=p,d&&d.push(m=[]),S=!0,w=!1,b=_=0/0}function g(){v&&(p(y,M),x&&w&&A.rejoin(),v.push(A.buffer())),C.point=f,w&&a.lineEnd()}function p(n,t){n=Math.max(-Tc,Math.min(Tc,n)),t=Math.max(-Tc,Math.min(Tc,t));var e=s(n,t);if(d&&m.push([n,t]),S)y=n,M=t,x=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:b,y:_},b:{x:n,y:t}};N(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}b=n,_=t,w=e}var v,d,m,y,M,x,b,_,w,S,k,E=a,A=Re(),N=Oe(n,t,e,r),C={point:f,lineStart:h,lineEnd:g,polygonStart:function(){a=A,v=[],d=[],k=!0},polygonEnd:function(){a=E,v=ta.merge(v);var t=c([n,r]),e=k&&t,u=v.length;(e||u)&&(a.polygonStart(),e&&(a.lineStart(),l(null,null,1,a),a.lineEnd()),u&&Ce(v,i,t,l,a),a.polygonEnd()),v=d=m=null}};return C}}function Ye(n){var t=0,e=qa/3,r=ir(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*qa/180,e=n[1]*qa/180):[t/qa*180,e/qa*180]},u}function Ze(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),o-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),o=Math.sqrt(i)/u;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/u,tt((i-(n*n+e*e)*u*u)/(2*u))]},e}function Ve(){function n(n,t){Dc+=u*n-r*t,r=n,u=t}var t,e,r,u;Hc.point=function(i,o){Hc.point=n,t=r=i,e=u=o},Hc.lineEnd=function(){n(t,e)}}function Xe(n,t){Pc>n&&(Pc=n),n>jc&&(jc=n),Uc>t&&(Uc=t),t>Fc&&(Fc=t)}function $e(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function u(){o.push("Z")}var i=Be(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return i=Be(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Be(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function We(n,t){_c+=n,wc+=t,++Sc}function Je(){function n(n,r){var u=n-t,i=r-e,o=Math.sqrt(u*u+i*i);kc+=o*(t+n)/2,Ec+=o*(e+r)/2,Ac+=o,We(t=n,e=r)}var t,e;Ic.point=function(r,u){Ic.point=n,We(t=r,e=u)}}function Ge(){Ic.point=We}function Ke(){function n(n,t){var e=n-r,i=t-u,o=Math.sqrt(e*e+i*i);kc+=o*(r+n)/2,Ec+=o*(u+t)/2,Ac+=o,o=u*n-r*t,Nc+=o*(r+n),Cc+=o*(u+t),zc+=3*o,We(r=n,u=t)}var t,e,r,u;Ic.point=function(i,o){Ic.point=n,We(t=r=i,e=u=o)},Ic.lineEnd=function(){n(t,e)}}function Qe(n){function t(t,e){n.moveTo(t+o,e),n.arc(t,e,o,0,La)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:b};return a}function nr(n){function t(n){return(a?r:e)(n)}function e(t){return rr(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){M=0/0,S.point=i,t.lineStart()}function i(e,r){var i=pe([e,r]),o=n(e,r);u(M,x,y,b,_,w,M=o[0],x=o[1],y=e,b=i[0],_=i[1],w=i[2],a,t),t.point(M,x)}function o(){S.point=e,t.lineEnd()}function c(){r(),S.point=l,S.lineEnd=s}function l(n,t){i(f=n,h=t),g=M,p=x,v=b,d=_,m=w,S.point=i}function s(){u(M,x,y,b,_,w,g,p,f,v,d,m,a,t),S.lineEnd=o,o()}var f,h,g,p,v,d,m,y,M,x,b,_,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c
},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function u(t,e,r,a,c,l,s,f,h,g,p,v,d,m){var y=s-t,M=f-e,x=y*y+M*M;if(x>4*i&&d--){var b=a+g,_=c+p,w=l+v,S=Math.sqrt(b*b+_*_+w*w),k=Math.asin(w/=S),E=ga(ga(w)-1)<Ca||ga(r-h)<Ca?(r+h)/2:Math.atan2(_,b),A=n(E,k),N=A[0],C=A[1],z=N-t,q=C-e,L=M*z-y*q;(L*L/x>i||ga((y*z+M*q)/x-.5)>.3||o>a*g+c*p+l*v)&&(u(t,e,r,a,c,l,N,C,E,b/=S,_/=S,w,d,m),m.point(N,C),u(N,C,E,b,_,w,s,f,h,g,p,v,d,m))}}var i=.5,o=Math.cos(30*Da),a=16;return t.precision=function(n){return arguments.length?(a=(i=n*n)>0&&16,t):Math.sqrt(i)},t}function tr(n){var t=nr(function(t,e){return n([t*Pa,e*Pa])});return function(n){return or(t(n))}}function er(n){this.stream=n}function rr(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function ur(n){return ir(function(){return n})()}function ir(n){function t(n){return n=a(n[0]*Da,n[1]*Da),[n[0]*h+c,l-n[1]*h]}function e(n){return n=a.invert((n[0]-c)/h,(l-n[1])/h),n&&[n[0]*Pa,n[1]*Pa]}function r(){a=Ae(o=lr(m,M,x),i);var n=i(v,d);return c=g-n[0]*h,l=p+n[1]*h,u()}function u(){return s&&(s.valid=!1,s=null),t}var i,o,a,c,l,s,f=nr(function(n,t){return n=i(n,t),[n[0]*h+c,l-n[1]*h]}),h=150,g=480,p=250,v=0,d=0,m=0,M=0,x=0,b=Lc,_=y,w=null,S=null;return t.stream=function(n){return s&&(s.valid=!1),s=or(b(o,f(_(n)))),s.valid=!0,s},t.clipAngle=function(n){return arguments.length?(b=null==n?(w=n,Lc):He((w=+n)*Da),u()):w},t.clipExtent=function(n){return arguments.length?(S=n,_=n?Ie(n[0][0],n[0][1],n[1][0],n[1][1]):y,u()):S},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(v=n[0]%360*Da,d=n[1]%360*Da,r()):[v*Pa,d*Pa]},t.rotate=function(n){return arguments.length?(m=n[0]%360*Da,M=n[1]%360*Da,x=n.length>2?n[2]%360*Da:0,r()):[m*Pa,M*Pa,x*Pa]},ta.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r()}}function or(n){return rr(n,function(t,e){n.point(t*Da,e*Da)})}function ar(n,t){return[n,t]}function cr(n,t){return[n>qa?n-La:-qa>n?n+La:n,t]}function lr(n,t,e){return n?t||e?Ae(fr(n),hr(t,e)):fr(n):t||e?hr(t,e):cr}function sr(n){return function(t,e){return t+=n,[t>qa?t-La:-qa>t?t+La:t,e]}}function fr(n){var t=sr(n);return t.invert=sr(-n),t}function hr(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*r+a*u;return[Math.atan2(c*i-s*o,a*r-l*u),tt(s*i+c*o)]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*i-c*o;return[Math.atan2(c*i+l*o,a*r+s*u),tt(s*r-a*u)]},e}function gr(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=pr(e,u),i=pr(e,i),(o>0?i>u:u>i)&&(u+=o*La)):(u=n+o*La,i=n-.5*c);for(var l,s=u;o>0?s>i:i>s;s-=c)a.point((l=xe([e,-r*Math.cos(s),-r*Math.sin(s)]))[0],l[1])}}function pr(n,t){var e=pe(t);e[0]-=n,Me(e);var r=nt(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Ca)%(2*Math.PI)}function vr(n,t,e){var r=ta.range(n,t-Ca,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function dr(n,t,e){var r=ta.range(n,t-Ca,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function mr(n){return n.source}function yr(n){return n.target}function Mr(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(r),a=Math.sin(r),c=u*Math.cos(n),l=u*Math.sin(n),s=o*Math.cos(e),f=o*Math.sin(e),h=2*Math.asin(Math.sqrt(it(r-t)+u*o*it(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*s,u=e*l+t*f,o=e*i+t*a;return[Math.atan2(u,r)*Pa,Math.atan2(o,Math.sqrt(r*r+u*u))*Pa]}:function(){return[n*Pa,t*Pa]};return p.distance=h,p}function xr(){function n(n,u){var i=Math.sin(u*=Da),o=Math.cos(u),a=ga((n*=Da)-t),c=Math.cos(a);Yc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*i-e*o*c)*a),e*i+r*o*c),t=n,e=i,r=o}var t,e,r;Zc.point=function(u,i){t=u*Da,e=Math.sin(i*=Da),r=Math.cos(i),Zc.point=n},Zc.lineEnd=function(){Zc.point=Zc.lineEnd=b}}function br(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,r*o),Math.asin(r&&e*i/r)]},e}function _r(n,t){function e(n,t){o>0?-Ra+Ca>t&&(t=-Ra+Ca):t>Ra-Ca&&(t=Ra-Ca);var e=o/Math.pow(u(t),i);return[e*Math.sin(i*n),o-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(qa/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),o=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=o-t,r=K(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(o/r,1/i))-Ra]},e):Sr}function wr(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return ga(u)<Ca?ar:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-K(u)*Math.sqrt(n*n+e*e)]},e)}function Sr(n,t){return[n,Math.log(Math.tan(qa/4+t/2))]}function kr(n){var t,e=ur(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=i.apply(e,arguments);if(o===e){if(t=null==n){var a=qa*r(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Er(n,t){return[Math.log(Math.tan(qa/4+t/2)),-n]}function Ar(n){return n[0]}function Nr(n){return n[1]}function Cr(n){for(var t=n.length,e=[0,1],r=2,u=2;t>u;u++){for(;r>1&&Q(n[e[r-2]],n[e[r-1]],n[u])<=0;)--r;e[r++]=u}return e.slice(0,r)}function zr(n,t){return n[0]-t[0]||n[1]-t[1]}function qr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Lr(n,t,e,r){var u=n[0],i=e[0],o=t[0]-u,a=r[0]-i,c=n[1],l=e[1],s=t[1]-c,f=r[1]-l,h=(a*(c-l)-f*(u-i))/(f*o-a*s);return[u+h*o,c+h*s]}function Tr(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Rr(){tu(this),this.edge=this.site=this.circle=null}function Dr(n){var t=el.pop()||new Rr;return t.site=n,t}function Pr(n){Xr(n),Qc.remove(n),el.push(n),tu(n)}function Ur(n){var t=n.circle,e=t.x,r=t.cy,u={x:e,y:r},i=n.P,o=n.N,a=[n];Pr(n);for(var c=i;c.circle&&ga(e-c.circle.x)<Ca&&ga(r-c.circle.cy)<Ca;)i=c.P,a.unshift(c),Pr(c),c=i;a.unshift(c),Xr(c);for(var l=o;l.circle&&ga(e-l.circle.x)<Ca&&ga(r-l.circle.cy)<Ca;)o=l.N,a.push(l),Pr(l),l=o;a.push(l),Xr(l);var s,f=a.length;for(s=1;f>s;++s)l=a[s],c=a[s-1],Kr(l.edge,c.site,l.site,u);c=a[0],l=a[f-1],l.edge=Jr(c.site,l.site,null,u),Vr(c),Vr(l)}function jr(n){for(var t,e,r,u,i=n.x,o=n.y,a=Qc._;a;)if(r=Fr(a,o)-i,r>Ca)a=a.L;else{if(u=i-Hr(a,o),!(u>Ca)){r>-Ca?(t=a.P,e=a):u>-Ca?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var c=Dr(n);if(Qc.insert(t,c),t||e){if(t===e)return Xr(t),e=Dr(t.site),Qc.insert(c,e),c.edge=e.edge=Jr(t.site,c.site),Vr(t),void Vr(e);if(!e)return void(c.edge=Jr(t.site,c.site));Xr(t),Xr(e);var l=t.site,s=l.x,f=l.y,h=n.x-s,g=n.y-f,p=e.site,v=p.x-s,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,M=v*v+d*d,x={x:(d*y-g*M)/m+s,y:(h*M-v*y)/m+f};Kr(e.edge,l,p,x),c.edge=Jr(l,n,null,x),e.edge=Jr(n,p,null,x),Vr(t),Vr(e)}}function Fr(n,t){var e=n.site,r=e.x,u=e.y,i=u-t;if(!i)return r;var o=n.P;if(!o)return-1/0;e=o.site;var a=e.x,c=e.y,l=c-t;if(!l)return a;var s=a-r,f=1/i-1/l,h=s/l;return f?(-h+Math.sqrt(h*h-2*f*(s*s/(-2*l)-c+l/2+u-i/2)))/f+r:(r+a)/2}function Hr(n,t){var e=n.N;if(e)return Fr(e,t);var r=n.site;return r.y===t?r.x:1/0}function Or(n){this.site=n,this.edges=[]}function Ir(n){for(var t,e,r,u,i,o,a,c,l,s,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=Kc,d=v.length;d--;)if(i=v[d],i&&i.prepare())for(a=i.edges,c=a.length,o=0;c>o;)s=a[o].end(),r=s.x,u=s.y,l=a[++o%c].start(),t=l.x,e=l.y,(ga(r-t)>Ca||ga(u-e)>Ca)&&(a.splice(o,0,new Qr(Gr(i.site,s,ga(r-f)<Ca&&p-u>Ca?{x:f,y:ga(t-f)<Ca?e:p}:ga(u-p)<Ca&&h-r>Ca?{x:ga(e-p)<Ca?t:h,y:p}:ga(r-h)<Ca&&u-g>Ca?{x:h,y:ga(t-h)<Ca?e:g}:ga(u-g)<Ca&&r-f>Ca?{x:ga(e-g)<Ca?t:f,y:g}:null),i.site,null)),++c)}function Yr(n,t){return t.angle-n.angle}function Zr(){tu(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vr(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,u=n.site,i=e.site;if(r!==i){var o=u.x,a=u.y,c=r.x-o,l=r.y-a,s=i.x-o,f=i.y-a,h=2*(c*f-l*s);if(!(h>=-za)){var g=c*c+l*l,p=s*s+f*f,v=(f*g-l*p)/h,d=(c*p-s*g)/h,f=d+a,m=rl.pop()||new Zr;m.arc=n,m.site=u,m.x=v+o,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;for(var y=null,M=tl._;M;)if(m.y<M.y||m.y===M.y&&m.x<=M.x){if(!M.L){y=M.P;break}M=M.L}else{if(!M.R){y=M;break}M=M.R}tl.insert(y,m),y||(nl=m)}}}}function Xr(n){var t=n.circle;t&&(t.P||(nl=t.N),tl.remove(t),rl.push(t),tu(t),n.circle=null)}function $r(n){for(var t,e=Gc,r=Oe(n[0][0],n[0][1],n[1][0],n[1][1]),u=e.length;u--;)t=e[u],(!Br(t,n)||!r(t)||ga(t.a.x-t.b.x)<Ca&&ga(t.a.y-t.b.y)<Ca)&&(t.a=t.b=null,e.splice(u,1))}function Br(n,t){var e=n.b;if(e)return!0;var r,u,i=n.a,o=t[0][0],a=t[1][0],c=t[0][1],l=t[1][1],s=n.l,f=n.r,h=s.x,g=s.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;if(v===g){if(o>d||d>=a)return;if(h>p){if(i){if(i.y>=l)return}else i={x:d,y:c};e={x:d,y:l}}else{if(i){if(i.y<c)return}else i={x:d,y:l};e={x:d,y:c}}}else if(r=(h-p)/(v-g),u=m-r*d,-1>r||r>1)if(h>p){if(i){if(i.y>=l)return}else i={x:(c-u)/r,y:c};e={x:(l-u)/r,y:l}}else{if(i){if(i.y<c)return}else i={x:(l-u)/r,y:l};e={x:(c-u)/r,y:c}}else if(v>g){if(i){if(i.x>=a)return}else i={x:o,y:r*o+u};e={x:a,y:r*a+u}}else{if(i){if(i.x<o)return}else i={x:a,y:r*a+u};e={x:o,y:r*o+u}}return n.a=i,n.b=e,!0}function Wr(n,t){this.l=n,this.r=t,this.a=this.b=null}function Jr(n,t,e,r){var u=new Wr(n,t);return Gc.push(u),e&&Kr(u,n,t,e),r&&Kr(u,t,n,r),Kc[n.i].edges.push(new Qr(u,n,t)),Kc[t.i].edges.push(new Qr(u,t,n)),u}function Gr(n,t,e){var r=new Wr(n,null);return r.a=t,r.b=e,Gc.push(r),r}function Kr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function Qr(n,t,e){var r=n.a,u=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y)}function nu(){this._=null}function tu(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function eu(n,t){var e=t,r=t.R,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function ru(n,t){var e=t,r=t.L,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function uu(n){for(;n.L;)n=n.L;return n}function iu(n,t){var e,r,u,i=n.sort(ou).pop();for(Gc=[],Kc=new Array(n.length),Qc=new nu,tl=new nu;;)if(u=nl,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x))(i.x!==e||i.y!==r)&&(Kc[i.i]=new Or(i),jr(i),e=i.x,r=i.y),i=n.pop();else{if(!u)break;Ur(u.arc)}t&&($r(t),Ir(t));var o={cells:Kc,edges:Gc};return Qc=tl=Gc=Kc=null,o}function ou(n,t){return t.y-n.y||t.x-n.x}function au(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function cu(n){return n.x}function lu(n){return n.y}function su(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function fu(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var o=.5*(e+u),a=.5*(r+i),c=t.nodes;c[0]&&fu(n,c[0],e,r,o,a),c[1]&&fu(n,c[1],o,r,u,a),c[2]&&fu(n,c[2],e,a,o,i),c[3]&&fu(n,c[3],o,a,u,i)}}function hu(n,t,e,r,u,i,o){var a,c=1/0;return function l(n,s,f,h,g){if(!(s>i||f>o||r>h||u>g)){if(p=n.point){var p,v=t-n.x,d=e-n.y,m=v*v+d*d;if(c>m){var y=Math.sqrt(c=m);r=t-y,u=e-y,i=t+y,o=e+y,a=p}}for(var M=n.nodes,x=.5*(s+h),b=.5*(f+g),_=t>=x,w=e>=b,S=w<<1|_,k=S+4;k>S;++S)if(n=M[3&S])switch(3&S){case 0:l(n,s,f,x,b);break;case 1:l(n,x,f,h,b);break;case 2:l(n,s,b,x,g);break;case 3:l(n,x,b,h,g)}}}(n,r,u,i,o),a}function gu(n,t){n=ta.rgb(n),t=ta.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,o=t.g-r,a=t.b-u;return function(n){return"#"+xt(Math.round(e+i*n))+xt(Math.round(r+o*n))+xt(Math.round(u+a*n))}}function pu(n,t){var e,r={},u={};for(e in n)e in t?r[e]=mu(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function vu(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function du(n,t){var e,r,u,i=il.lastIndex=ol.lastIndex=0,o=-1,a=[],c=[];for(n+="",t+="";(e=il.exec(n))&&(r=ol.exec(t));)(u=r.index)>i&&(u=t.slice(i,u),a[o]?a[o]+=u:a[++o]=u),(e=e[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,c.push({i:o,x:vu(e,r)})),i=ol.lastIndex;return i<t.length&&(u=t.slice(i),a[o]?a[o]+=u:a[++o]=u),a.length<2?c[0]?(t=c[0].x,function(n){return t(n)+""}):function(){return t}:(t=c.length,function(n){for(var e,r=0;t>r;++r)a[(e=c[r]).i]=e.x(n);return a.join("")})}function mu(n,t){for(var e,r=ta.interpolators.length;--r>=0&&!(e=ta.interpolators[r](n,t)););return e}function yu(n,t){var e,r=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(mu(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;o>e;++e)u[e]=t[e];return function(n){for(e=0;a>e;++e)u[e]=r[e](n);return u}}function Mu(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function xu(n){return function(t){return 1-n(1-t)}}function bu(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function _u(n){return n*n}function wu(n){return n*n*n}function Su(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function ku(n){return function(t){return Math.pow(t,n)}}function Eu(n){return 1-Math.cos(n*Ra)}function Au(n){return Math.pow(2,10*(n-1))}function Nu(n){return 1-Math.sqrt(1-n*n)}function Cu(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/La*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*La/t)}}function zu(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function qu(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Lu(n,t){n=ta.hcl(n),t=ta.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,o=t.c-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return st(e+i*n,r+o*n,u+a*n)+""}}function Tu(n,t){n=ta.hsl(n),t=ta.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,o=t.s-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return ct(e+i*n,r+o*n,u+a*n)+""}}function Ru(n,t){n=ta.lab(n),t=ta.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,o=t.a-r,a=t.b-u;return function(n){return ht(e+i*n,r+o*n,u+a*n)+""}}function Du(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Pu(n){var t=[n.a,n.b],e=[n.c,n.d],r=ju(t),u=Uu(t,e),i=ju(Fu(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Pa,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Pa:0}function Uu(n,t){return n[0]*t[0]+n[1]*t[1]}function ju(n){var t=Math.sqrt(Uu(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Fu(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Hu(n,t){var e,r=[],u=[],i=ta.transform(n),o=ta.transform(t),a=i.translate,c=o.translate,l=i.rotate,s=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:vu(a[0],c[0])},{i:3,x:vu(a[1],c[1])})):r.push(c[0]||c[1]?"translate("+c+")":""),l!=s?(l-s>180?s+=360:s-l>180&&(l+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:vu(l,s)})):s&&r.push(r.pop()+"rotate("+s+")"),f!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:vu(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:vu(g[0],p[0])},{i:e-2,x:vu(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function Ou(n,t){return t=(t-=n=+n)||1/t,function(e){return(e-n)/t}}function Iu(n,t){return t=(t-=n=+n)||1/t,function(e){return Math.max(0,Math.min(1,(e-n)/t))}}function Yu(n){for(var t=n.source,e=n.target,r=Vu(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function Zu(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Vu(n,t){if(n===t)return n;for(var e=Zu(n),r=Zu(t),u=e.pop(),i=r.pop(),o=null;u===i;)o=u,u=e.pop(),i=r.pop();return o}function Xu(n){n.fixed|=2}function $u(n){n.fixed&=-7}function Bu(n){n.fixed|=4,n.px=n.x,n.py=n.y}function Wu(n){n.fixed&=-5}function Ju(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(Ju(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var l=t*e[n.point.index];n.charge+=n.pointCharge=l,r+=l*n.point.x,u+=l*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function Gu(n,t){return ta.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=ri,n}function Ku(n,t){for(var e=[n];null!=(n=e.pop());)if(t(n),(u=n.children)&&(r=u.length))for(var r,u;--r>=0;)e.push(u[r])}function Qu(n,t){for(var e=[n],r=[];null!=(n=e.pop());)if(r.push(n),(i=n.children)&&(u=i.length))for(var u,i,o=-1;++o<u;)e.push(i[o]);for(;null!=(n=r.pop());)t(n)}function ni(n){return n.children}function ti(n){return n.value}function ei(n,t){return t.value-n.value}function ri(n){return ta.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function ui(n){return n.x}function ii(n){return n.y}function oi(n,t,e){n.y0=t,n.y=e}function ai(n){return ta.range(n.length)}function ci(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function li(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function si(n){return n.reduce(fi,0)}function fi(n,t){return n+t[1]}function hi(n,t){return gi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function gi(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function pi(n){return[ta.min(n),ta.max(n)]}function vi(n,t){return n.value-t.value}function di(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function mi(n,t){n._pack_next=t,t._pack_prev=n}function yi(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>e*e+r*r}function Mi(n){function t(n){s=Math.min(n.x-n.r,s),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(l=e.length)){var e,r,u,i,o,a,c,l,s=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(xi),r=e[0],r.x=-r.r,r.y=0,t(r),l>1&&(u=e[1],u.x=u.r,u.y=0,t(u),l>2))for(i=e[2],wi(r,u,i),t(i),di(r,i),r._pack_prev=i,di(i,u),u=r._pack_next,o=3;l>o;o++){wi(r,u,i=e[o]);var p=0,v=1,d=1;for(a=u._pack_next;a!==u;a=a._pack_next,v++)if(yi(a,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==a._pack_prev&&!yi(c,i);c=c._pack_prev,d++);p?(d>v||v==d&&u.r<r.r?mi(r,u=a):mi(r=c,u),o--):(di(r,i),u=i,t(i))}var m=(s+f)/2,y=(h+g)/2,M=0;for(o=0;l>o;o++)i=e[o],i.x-=m,i.y-=y,M=Math.max(M,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=M,e.forEach(bi)}}function xi(n){n._pack_next=n._pack_prev=n}function bi(n){delete n._pack_next,delete n._pack_prev}function _i(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,o=u.length;++i<o;)_i(u[i],t,e,r)}function wi(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var o=t.r+e.r,a=u*u+i*i;o*=o,r*=r;var c=.5+(r-o)/(2*a),l=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+c*u+l*i,e.y=n.y+c*i-l*u}else e.x=n.x+r,e.y=n.y}function Si(n,t){return n.parent==t.parent?1:2}function ki(n){var t=n.children;return t.length?t[0]:n.t}function Ei(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t}function Ai(n,t,e){var r=e/(t.i-n.i);t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e}function Ni(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i],t.z+=e,t.m+=e,e+=t.s+(r+=t.c)}function Ci(n,t,e){return n.a.parent===t.parent?n.a:e}function zi(n){return 1+ta.max(n,function(n){return n.y})}function qi(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Li(n){var t=n.children;return t&&t.length?Li(t[0]):n}function Ti(n){var t,e=n.children;return e&&(t=e.length)?Ti(e[t-1]):n}function Ri(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Di(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function Pi(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Ui(n){return n.rangeExtent?n.rangeExtent():Pi(n.range())}function ji(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function Fi(n,t){var e,r=0,u=n.length-1,i=n[r],o=n[u];return i>o&&(e=r,r=u,u=e,e=i,i=o,o=e),n[r]=t.floor(i),n[u]=t.ceil(o),n}function Hi(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:ml}function Oi(n,t,e,r){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(e(n[o-1],n[o])),i.push(r(t[o-1],t[o]));return function(t){var e=ta.bisect(n,t,1,a)-1;return i[e](u[e](t))}}function Ii(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Oi:ji,c=r?Iu:Ou;return o=u(n,t,c,e),a=u(t,n,c,mu),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Du)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return Xi(n,t)},i.tickFormat=function(t,e){return $i(n,t,e)},i.nice=function(t){return Zi(n,t),u()},i.copy=function(){return Ii(n,t,e,r)},u()}function Yi(n,t){return ta.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Zi(n,t){return Fi(n,Hi(Vi(n,t)[2]))}function Vi(n,t){null==t&&(t=10);var e=Pi(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function Xi(n,t){return ta.range.apply(ta,Vi(n,t))}function $i(n,t,e){var r=Vi(n,t);if(e){var u=ic.exec(e);if(u.shift(),"s"===u[8]){var i=ta.formatPrefix(Math.max(ga(r[0]),ga(r[1])));return u[7]||(u[7]="."+Bi(i.scale(r[2]))),u[8]="f",e=ta.format(u.join("")),function(n){return e(i.scale(n))+i.symbol}}u[7]||(u[7]="."+Wi(u[8],r)),e=u.join("")}else e=",."+Bi(r[2])+"f";return ta.format(e)}function Bi(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function Wi(n,t){var e=Bi(t[2]);return n in yl?Math.abs(e-Bi(Math.max(ga(t[0]),ga(t[1]))))+ +("e"!==n):e-2*("%"===n)}function Ji(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),o):t},o.nice=function(){var t=Fi(r.map(u),e?Math:xl);return n.domain(t),r=t.map(i),o},o.ticks=function(){var n=Pi(r),o=[],a=n[0],c=n[1],l=Math.floor(u(a)),s=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(s-l)){if(e){for(;s>l;l++)for(var h=1;f>h;h++)o.push(i(l)*h);o.push(i(l))}else for(o.push(i(l));l++<s;)for(var h=f-1;h>0;h--)o.push(i(l)*h);for(l=0;o[l]<a;l++);for(s=o.length;o[s-1]>c;s--);o=o.slice(l,s)}return o},o.tickFormat=function(n,t){if(!arguments.length)return Ml;arguments.length<2?t=Ml:"function"!=typeof t&&(t=ta.format(t));var r,a=Math.max(.1,n/o.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+r))<=a?t(n):""}},o.copy=function(){return Ji(n.copy(),t,e,r)},Yi(o,n)}function Gi(n,t,e){function r(t){return n(u(t))}var u=Ki(t),i=Ki(1/t);return r.invert=function(t){return i(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e},r.ticks=function(n){return Xi(e,n)},r.tickFormat=function(n,t){return $i(e,n,t)},r.nice=function(n){return r.domain(Zi(e,n))},r.exponent=function(o){return arguments.length?(u=Ki(t=o),i=Ki(1/t),n.domain(e.map(u)),r):t},r.copy=function(){return Gi(n.copy(),t,e)},Yi(r,n)}function Ki(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function Qi(n,t){function e(e){return i[((u.get(e)||("range"===t.t?u.set(e,n.push(e)):0/0))-1)%i.length]}function r(t,e){return ta.range(n.length).map(function(n){return t+e*n})}var u,i,o;return e.domain=function(r){if(!arguments.length)return n;n=[],u=new l;for(var i,o=-1,a=r.length;++o<a;)u.has(i=r[o])||u.set(i,n.push(i));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(i=n,o=0,t={t:"range",a:arguments},e):i},e.rangePoints=function(u,a){arguments.length<2&&(a=0);var c=u[0],l=u[1],s=n.length<2?(c=(c+l)/2,0):(l-c)/(n.length-1+a);return i=r(c+s*a/2,s),o=0,t={t:"rangePoints",a:arguments},e},e.rangeRoundPoints=function(u,a){arguments.length<2&&(a=0);var c=u[0],l=u[1],s=n.length<2?(c=l=Math.round((c+l)/2),0):(l-c)/(n.length-1+a)|0;return i=r(c+Math.round(s*a/2+(l-c-(n.length-1+a)*s)/2),s),o=0,t={t:"rangeRoundPoints",a:arguments},e},e.rangeBands=function(u,a,c){arguments.length<2&&(a=0),arguments.length<3&&(c=a);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=(f-s)/(n.length-a+2*c);return i=r(s+h*c,h),l&&i.reverse(),o=h*(1-a),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,a,c){arguments.length<2&&(a=0),arguments.length<3&&(c=a);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=Math.floor((f-s)/(n.length-a+2*c));return i=r(s+Math.round((f-s-(n.length-a)*h)/2),h),l&&i.reverse(),o=Math.round(h*(1-a)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return Pi(t.a[0])},e.copy=function(){return Qi(n,t)},e.domain(n)}function no(n,t){function i(){var e=0,r=t.length;for(a=[];++e<r;)a[e-1]=ta.quantile(n,e/r);return o}function o(n){return isNaN(n=+n)?void 0:t[ta.bisect(a,n)]}var a;return o.domain=function(t){return arguments.length?(n=t.map(r).filter(u).sort(e),i()):n},o.range=function(n){return arguments.length?(t=n,i()):t},o.quantiles=function(){return a},o.invertExtent=function(e){return e=t.indexOf(e),0>e?[0/0,0/0]:[e>0?a[e-1]:n[0],e<a.length?a[e]:n[n.length-1]]},o.copy=function(){return no(n,t)},i()}function to(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),o=e.length-1,r}var i,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},r.copy=function(){return to(n,t,e)},u()}function eo(n,t){function e(e){return e>=e?t[ta.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return eo(n,t)},e}function ro(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Xi(n,t)},t.tickFormat=function(t,e){return $i(n,t,e)},t.copy=function(){return ro(n)},t}function uo(){return 0}function io(n){return n.innerRadius}function oo(n){return n.outerRadius}function ao(n){return n.startAngle}function co(n){return n.endAngle}function lo(n){return n&&n.padAngle}function so(n,t,e,r){return(n-e)*t-(t-r)*n>0?0:1}function fo(n,t,e,r,u){var i=n[0]-t[0],o=n[1]-t[1],a=(u?r:-r)/Math.sqrt(i*i+o*o),c=a*o,l=-a*i,s=n[0]+c,f=n[1]+l,h=t[0]+c,g=t[1]+l,p=(s+h)/2,v=(f+g)/2,d=h-s,m=g-f,y=d*d+m*m,M=e-r,x=s*g-h*f,b=(0>m?-1:1)*Math.sqrt(M*M*y-x*x),_=(x*m-d*b)/y,w=(-x*d-m*b)/y,S=(x*m+d*b)/y,k=(-x*d+m*b)/y,E=_-p,A=w-v,N=S-p,C=k-v;return E*E+A*A>N*N+C*C&&(_=S,w=k),[[_-c,w-l],[_*e/M,w*e/M]]}function ho(n){function t(t){function o(){l.push("M",i(n(s),a))}for(var c,l=[],s=[],f=-1,h=t.length,g=Et(e),p=Et(r);++f<h;)u.call(this,c=t[f],f)?s.push([+g.call(this,c,f),+p.call(this,c,f)]):s.length&&(o(),s=[]);return s.length&&o(),l.length?l.join(""):null}var e=Ar,r=Nr,u=Ne,i=go,o=i.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=El.get(n)||go).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function go(n){return n.join("L")}function po(n){return go(n)+"Z"}function vo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&u.push("H",r[0]),u.join("")}function mo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function yo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function Mo(n,t){return n.length<4?go(n):n[1]+_o(n.slice(1,-1),wo(n,t))}function xo(n,t){return n.length<3?go(n):n[0]+_o((n.push(n[0]),n),wo([n[n.length-2]].concat(n,[n[1]]),t))}function bo(n,t){return n.length<3?go(n):n[0]+_o(n,wo(n,t))}function _o(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return go(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(e&&(r+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,r+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var l=2;l<t.length;l++,c++)i=n[c],a=t[l],r+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(e){var s=n[c];r+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+s[0]+","+s[1]}return r}function wo(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)e=i,i=o,o=n[a],r.push([u*(o[0]-e[0]),u*(o[1]-e[1])]);return r}function So(n){if(n.length<3)return go(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],o=[u,u,u,(r=n[1])[0]],a=[i,i,i,r[1]],c=[u,",",i,"L",No(Cl,o),",",No(Cl,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),Co(c,o,a);return n.pop(),c.push("L",r),c.join("")}function ko(n){if(n.length<4)return go(n);for(var t,e=[],r=-1,u=n.length,i=[0],o=[0];++r<3;)t=n[r],i.push(t[0]),o.push(t[1]);for(e.push(No(Cl,i)+","+No(Cl,o)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),Co(e,i,o);return e.join("")}function Eo(n){for(var t,e,r=-1,u=n.length,i=u+4,o=[],a=[];++r<4;)e=n[r%u],o.push(e[0]),a.push(e[1]);for(t=[No(Cl,o),",",No(Cl,a)],--r;++r<i;)e=n[r%u],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Co(t,o,a);return t.join("")}function Ao(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],o=n[0][1],a=n[e][0]-i,c=n[e][1]-o,l=-1;++l<=e;)r=n[l],u=l/e,r[0]=t*r[0]+(1-t)*(i+u*a),r[1]=t*r[1]+(1-t)*(o+u*c);return So(n)}function No(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Co(n,t,e){n.push("C",No(Al,t),",",No(Al,e),",",No(Nl,t),",",No(Nl,e),",",No(Cl,t),",",No(Cl,e))}function zo(n,t){return(t[1]-n[1])/(t[0]-n[0])}function qo(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],o=r[0]=zo(u,i);++t<e;)r[t]=(o+(o=zo(u=i,i=n[t+1])))/2;return r[t]=o,r}function Lo(n){for(var t,e,r,u,i=[],o=qo(n),a=-1,c=n.length-1;++a<c;)t=zo(n[a],n[a+1]),ga(t)<Ca?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*e,o[a+1]=u*r));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function To(n){return n.length<3?go(n):n[0]+_o(n,Lo(n))}function Ro(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]-Ra,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Do(n){function t(t){function c(){v.push("M",a(n(m),f),s,l(n(d.reverse()),f),"Z")}for(var h,g,p,v=[],d=[],m=[],y=-1,M=t.length,x=Et(e),b=Et(u),_=e===r?function(){return g}:Et(r),w=u===i?function(){return p}:Et(i);++y<M;)o.call(this,h=t[y],y)?(d.push([g=+x.call(this,h,y),p=+b.call(this,h,y)]),m.push([+_.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],m=[]);return d.length&&c(),v.length?v.join(""):null}var e=Ar,r=Ar,u=0,i=Nr,o=Ne,a=go,c=a.key,l=a,s="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r
},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=El.get(n)||go).key,l=a.reverse||a,s=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Po(n){return n.radius}function Uo(n){return[n.x,n.y]}function jo(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]-Ra;return[e*Math.cos(r),e*Math.sin(r)]}}function Fo(){return 64}function Ho(){return"circle"}function Oo(n){var t=Math.sqrt(n/qa);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Io(n){return function(){var t,e;(t=this[n])&&(e=t[t.active])&&(--t.count?delete t[t.active]:delete this[n],t.active+=.5,e.event&&e.event.interrupt.call(this,this.__data__,e.index))}}function Yo(n,t,e){return ya(n,Pl),n.namespace=t,n.id=e,n}function Zo(n,t,e,r){var u=n.id,i=n.namespace;return Y(n,"function"==typeof e?function(n,o,a){n[i][u].tween.set(t,r(e.call(n,n.__data__,o,a)))}:(e=r(e),function(n){n[i][u].tween.set(t,e)}))}function Vo(n){return null==n&&(n=""),function(){this.textContent=n}}function Xo(n){return null==n?"__transition__":"__transition_"+n+"__"}function $o(n,t,e,r,u){var i=n[e]||(n[e]={active:0,count:0}),o=i[r];if(!o){var a=u.time;o=i[r]={tween:new l,time:a,delay:u.delay,duration:u.duration,ease:u.ease,index:t},u=null,++i.count,ta.timer(function(u){function c(e){if(i.active>r)return s();var u=i[i.active];u&&(--i.count,delete i[i.active],u.event&&u.event.interrupt.call(n,n.__data__,u.index)),i.active=r,o.event&&o.event.start.call(n,n.__data__,t),o.tween.forEach(function(e,r){(r=r.call(n,n.__data__,t))&&v.push(r)}),h=o.ease,f=o.duration,ta.timer(function(){return p.c=l(e||1)?Ne:l,1},0,a)}function l(e){if(i.active!==r)return 1;for(var u=e/f,a=h(u),c=v.length;c>0;)v[--c].call(n,a);return u>=1?(o.event&&o.event.end.call(n,n.__data__,t),s()):void 0}function s(){return--i.count?delete i[r]:delete n[e],1}var f,h,g=o.delay,p=ec,v=[];return p.t=g+a,u>=g?c(u-g):void(p.c=c)},0,a)}}function Bo(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"})}function Wo(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"})}function Jo(n){return n.toISOString()}function Go(n,t,e){function r(t){return n(t)}function u(n,e){var r=n[1]-n[0],u=r/e,i=ta.bisect(Vl,u);return i==Vl.length?[t.year,Vi(n.map(function(n){return n/31536e6}),e)[2]]:i?t[u/Vl[i-1]<Vl[i]/u?i-1:i]:[Bl,Vi(n,e)[2]]}return r.invert=function(t){return Ko(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(Ko)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,Ko(+e+1),t).length}var i=r.domain(),o=Pi(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),r.domain(Fi(i,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=Ko(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=Ko(+t+1);return t}}:n))},r.ticks=function(n,t){var e=Pi(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(e[0],Ko(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return Go(n.copy(),t,e)},Yi(r,n)}function Ko(n){return new Date(n)}function Qo(n){return JSON.parse(n.responseText)}function na(n){var t=ua.createRange();return t.selectNode(ua.body),t.createContextualFragment(n.responseText)}var ta={version:"3.5.5"},ea=[].slice,ra=function(n){return ea.call(n)},ua=this.document;if(ua)try{ra(ua.documentElement.childNodes)[0].nodeType}catch(ia){ra=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}if(Date.now||(Date.now=function(){return+new Date}),ua)try{ua.createElement("DIV").style.setProperty("opacity",0,"")}catch(oa){var aa=this.Element.prototype,ca=aa.setAttribute,la=aa.setAttributeNS,sa=this.CSSStyleDeclaration.prototype,fa=sa.setProperty;aa.setAttribute=function(n,t){ca.call(this,n,t+"")},aa.setAttributeNS=function(n,t,e){la.call(this,n,t,e+"")},sa.setProperty=function(n,t,e){fa.call(this,n,t+"",e)}}ta.ascending=e,ta.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},ta.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i;)if(null!=(r=n[u])&&r>=r){e=r;break}for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i;)if(null!=(r=t.call(n,n[u],u))&&r>=r){e=r;break}for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},ta.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i;)if(null!=(r=n[u])&&r>=r){e=r;break}for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i;)if(null!=(r=t.call(n,n[u],u))&&r>=r){e=r;break}for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},ta.extent=function(n,t){var e,r,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=n[i])&&r>=r){e=u=r;break}for(;++i<o;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<o;)if(null!=(r=t.call(n,n[i],i))&&r>=r){e=u=r;break}for(;++i<o;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},ta.sum=function(n,t){var e,r=0,i=n.length,o=-1;if(1===arguments.length)for(;++o<i;)u(e=+n[o])&&(r+=e);else for(;++o<i;)u(e=+t.call(n,n[o],o))&&(r+=e);return r},ta.mean=function(n,t){var e,i=0,o=n.length,a=-1,c=o;if(1===arguments.length)for(;++a<o;)u(e=r(n[a]))?i+=e:--c;else for(;++a<o;)u(e=r(t.call(n,n[a],a)))?i+=e:--c;return c?i/c:void 0},ta.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;return i?u+i*(n[r]-u):u},ta.median=function(n,t){var i,o=[],a=n.length,c=-1;if(1===arguments.length)for(;++c<a;)u(i=r(n[c]))&&o.push(i);else for(;++c<a;)u(i=r(t.call(n,n[c],c)))&&o.push(i);return o.length?ta.quantile(o.sort(e),.5):void 0},ta.variance=function(n,t){var e,i,o=n.length,a=0,c=0,l=-1,s=0;if(1===arguments.length)for(;++l<o;)u(e=r(n[l]))&&(i=e-a,a+=i/++s,c+=i*(e-a));else for(;++l<o;)u(e=r(t.call(n,n[l],l)))&&(i=e-a,a+=i/++s,c+=i*(e-a));return s>1?c/(s-1):void 0},ta.deviation=function(){var n=ta.variance.apply(this,arguments);return n?Math.sqrt(n):n};var ha=i(e);ta.bisectLeft=ha.left,ta.bisect=ta.bisectRight=ha.right,ta.bisector=function(n){return i(1===n.length?function(t,r){return e(n(t),r)}:n)},ta.shuffle=function(n,t,e){(i=arguments.length)<3&&(e=n.length,2>i&&(t=0));for(var r,u,i=e-t;i;)u=Math.random()*i--|0,r=n[i+t],n[i+t]=n[u+t],n[u+t]=r;return n},ta.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},ta.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);r>e;)i[e]=[t=u,u=n[++e]];return i},ta.zip=function(){if(!(r=arguments.length))return[];for(var n=-1,t=ta.min(arguments,o),e=new Array(t);++n<t;)for(var r,u=-1,i=e[n]=new Array(r);++u<r;)i[u]=arguments[u][n];return e},ta.transpose=function(n){return ta.zip.apply(ta,n)},ta.keys=function(n){var t=[];for(var e in n)t.push(e);return t},ta.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},ta.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},ta.merge=function(n){for(var t,e,r,u=n.length,i=-1,o=0;++i<u;)o+=n[i].length;for(e=new Array(o);--u>=0;)for(r=n[u],t=r.length;--t>=0;)e[--o]=r[t];return e};var ga=Math.abs;ta.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),(t-n)/e===1/0)throw new Error("infinite range");var r,u=[],i=a(ga(e)),o=-1;if(n*=i,t*=i,e*=i,0>e)for(;(r=n+e*++o)>t;)u.push(r/i);else for(;(r=n+e*++o)<t;)u.push(r/i);return u},ta.map=function(n,t){var e=new l;if(n instanceof l)n.forEach(function(n,t){e.set(n,t)});else if(Array.isArray(n)){var r,u=-1,i=n.length;if(1===arguments.length)for(;++u<i;)e.set(u,n[u]);else for(;++u<i;)e.set(t.call(n,r=n[u],u),r)}else for(var o in n)e.set(o,n[o]);return e};var pa="__proto__",va="\x00";c(l,{has:h,get:function(n){return this._[s(n)]},set:function(n,t){return this._[s(n)]=t},remove:g,keys:p,values:function(){var n=[];for(var t in this._)n.push(this._[t]);return n},entries:function(){var n=[];for(var t in this._)n.push({key:f(t),value:this._[t]});return n},size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,f(t),this._[t])}}),ta.nest=function(){function n(t,o,a){if(a>=i.length)return r?r.call(u,o):e?o.sort(e):o;for(var c,s,f,h,g=-1,p=o.length,v=i[a++],d=new l;++g<p;)(h=d.get(c=v(s=o[g])))?h.push(s):d.set(c,[s]);return t?(s=t(),f=function(e,r){s.set(e,n(t,r,a))}):(s={},f=function(e,r){s[e]=n(t,r,a)}),d.forEach(f),s}function t(n,e){if(e>=i.length)return n;var r=[],u=o[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,u={},i=[],o=[];return u.map=function(t,e){return n(e,t,0)},u.entries=function(e){return t(n(ta.map,e,0),0)},u.key=function(n){return i.push(n),u},u.sortKeys=function(n){return o[i.length-1]=n,u},u.sortValues=function(n){return e=n,u},u.rollup=function(n){return r=n,u},u},ta.set=function(n){var t=new m;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},c(m,{has:h,add:function(n){return this._[s(n+="")]=!0,n},remove:g,values:p,size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,f(t))}}),ta.behavior={},ta.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=M(n,t,t[e]);return n};var da=["webkit","ms","moz","Moz","o","O"];ta.dispatch=function(){for(var n=new _,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=w(n);return n},_.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.slice(e+1),n=n.slice(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},ta.event=null,ta.requote=function(n){return n.replace(ma,"\\$&")};var ma=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ya={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},Ma=function(n,t){return t.querySelector(n)},xa=function(n,t){return t.querySelectorAll(n)},ba=function(n,t){var e=n.matches||n[x(n,"matchesSelector")];return(ba=function(n,t){return e.call(n,t)})(n,t)};"function"==typeof Sizzle&&(Ma=function(n,t){return Sizzle(n,t)[0]||null},xa=Sizzle,ba=Sizzle.matchesSelector),ta.selection=function(){return ta.select(ua.documentElement)};var _a=ta.selection.prototype=[];_a.select=function(n){var t,e,r,u,i=[];n=N(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var c=-1,l=r.length;++c<l;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c,o)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return A(i)},_a.selectAll=function(n){var t,e,r=[];n=C(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(e=o[a])&&(r.push(t=ra(n.call(e,e.__data__,a,u))),t.parentNode=e);return A(r)};var wa={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ta.ns={prefix:wa,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.slice(0,t),n=n.slice(t+1)),wa.hasOwnProperty(e)?{space:wa[e],local:n}:n}},_a.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=ta.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(z(t,n[t]));return this}return this.each(z(n,t))},_a.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=T(n)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!L(n[u]).test(t))return!1;return!0}for(t in n)this.each(R(t,n[t]));return this}return this.each(R(n,t))},_a.style=function(n,e,r){var u=arguments.length;if(3>u){if("string"!=typeof n){2>u&&(e="");for(r in n)this.each(P(r,n[r],e));return this}if(2>u){var i=this.node();return t(i).getComputedStyle(i,null).getPropertyValue(n)}r=""}return this.each(P(n,e,r))},_a.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(U(t,n[t]));return this}return this.each(U(n,t))},_a.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},_a.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},_a.append=function(n){return n=j(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},_a.insert=function(n,t){return n=j(n),t=N(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},_a.remove=function(){return this.each(F)},_a.data=function(n,t){function e(n,e){var r,u,i,o=n.length,f=e.length,h=Math.min(o,f),g=new Array(f),p=new Array(f),v=new Array(o);if(t){var d,m=new l,y=new Array(o);for(r=-1;++r<o;)m.has(d=t.call(u=n[r],u.__data__,r))?v[r]=u:m.set(d,u),y[r]=d;for(r=-1;++r<f;)(u=m.get(d=t.call(e,i=e[r],r)))?u!==!0&&(g[r]=u,u.__data__=i):p[r]=H(i),m.set(d,!0);for(r=-1;++r<o;)m.get(y[r])!==!0&&(v[r]=n[r])}else{for(r=-1;++r<h;)u=n[r],i=e[r],u?(u.__data__=i,g[r]=u):p[r]=H(i);for(;f>r;++r)p[r]=H(e[r]);for(;o>r;++r)v[r]=n[r]}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,a.push(p),c.push(g),s.push(v)}var r,u,i=-1,o=this.length;if(!arguments.length){for(n=new Array(o=(r=this[0]).length);++i<o;)(u=r[i])&&(n[i]=u.__data__);return n}var a=Z([]),c=A([]),s=A([]);if("function"==typeof n)for(;++i<o;)e(r=this[i],n.call(r,r.parentNode.__data__,i));else for(;++i<o;)e(r=this[i],n);return c.enter=function(){return a},c.exit=function(){return s},c},_a.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},_a.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=O(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return A(u)},_a.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},_a.sort=function(n){n=I.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},_a.each=function(n){return Y(this,function(t,e,r){n.call(t,t.__data__,e,r)})},_a.call=function(n){var t=ra(arguments);return n.apply(t[0]=this,t),this},_a.empty=function(){return!this.node()},_a.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null},_a.size=function(){var n=0;return Y(this,function(){++n}),n};var Sa=[];ta.selection.enter=Z,ta.selection.enter.prototype=Sa,Sa.append=_a.append,Sa.empty=_a.empty,Sa.node=_a.node,Sa.call=_a.call,Sa.size=_a.size,Sa.select=function(n){for(var t,e,r,u,i,o=[],a=-1,c=this.length;++a<c;){r=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var l=-1,s=u.length;++l<s;)(i=u[l])?(t.push(r[l]=e=n.call(u.parentNode,i.__data__,l,a)),e.__data__=i.__data__):t.push(null)}return A(o)},Sa.insert=function(n,t){return arguments.length<2&&(t=V(this)),_a.insert.call(this,n,t)},ta.select=function(t){var e;return"string"==typeof t?(e=[Ma(t,ua)],e.parentNode=ua.documentElement):(e=[t],e.parentNode=n(t)),A([e])},ta.selectAll=function(n){var t;return"string"==typeof n?(t=ra(xa(n,ua)),t.parentNode=ua.documentElement):(t=n,t.parentNode=null),A([t])},_a.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(X(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(X(n,t,e))};var ka=ta.map({mouseenter:"mouseover",mouseleave:"mouseout"});ua&&ka.forEach(function(n){"on"+n in ua&&ka.remove(n)});var Ea,Aa=0;ta.mouse=function(n){return J(n,k())};var Na=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ta.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=k().changedTouches),t)for(var r,u=0,i=t.length;i>u;++u)if((r=t[u]).identifier===e)return J(n,r)},ta.behavior.drag=function(){function n(){this.on("mousedown.drag",i).on("touchstart.drag",o)}function e(n,t,e,i,o){return function(){function a(){var n,e,r=t(h,v);r&&(n=r[0]-M[0],e=r[1]-M[1],p|=n|e,M=r,g({type:"drag",x:r[0]+l[0],y:r[1]+l[1],dx:n,dy:e}))}function c(){t(h,v)&&(m.on(i+d,null).on(o+d,null),y(p&&ta.event.target===f),g({type:"dragend"}))}var l,s=this,f=ta.event.target,h=s.parentNode,g=r.of(s,arguments),p=0,v=n(),d=".drag"+(null==v?"":"-"+v),m=ta.select(e(f)).on(i+d,a).on(o+d,c),y=W(f),M=t(h,v);u?(l=u.apply(s,arguments),l=[l.x-M[0],l.y-M[1]]):l=[0,0],g({type:"dragstart"})}}var r=E(n,"drag","dragstart","dragend"),u=null,i=e(b,ta.mouse,t,"mousemove","mouseup"),o=e(G,ta.touch,y,"touchmove","touchend");return n.origin=function(t){return arguments.length?(u=t,n):u},ta.rebind(n,r,"on")},ta.touches=function(n,t){return arguments.length<2&&(t=k().touches),t?ra(t).map(function(t){var e=J(n,t);return e.identifier=t.identifier,e}):[]};var Ca=1e-6,za=Ca*Ca,qa=Math.PI,La=2*qa,Ta=La-Ca,Ra=qa/2,Da=qa/180,Pa=180/qa,Ua=Math.SQRT2,ja=2,Fa=4;ta.interpolateZoom=function(n,t){function e(n){var t=n*y;if(m){var e=rt(v),o=i/(ja*h)*(e*ut(Ua*t+v)-et(v));return[r+o*l,u+o*s,i*e/rt(Ua*t+v)]}return[r+n*l,u+n*s,i*Math.exp(Ua*t)]}var r=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],l=o-r,s=a-u,f=l*l+s*s,h=Math.sqrt(f),g=(c*c-i*i+Fa*f)/(2*i*ja*h),p=(c*c-i*i-Fa*f)/(2*c*ja*h),v=Math.log(Math.sqrt(g*g+1)-g),d=Math.log(Math.sqrt(p*p+1)-p),m=d-v,y=(m||Math.log(c/i))/Ua;return e.duration=1e3*y,e},ta.behavior.zoom=function(){function n(n){n.on(q,f).on(Oa+".zoom",g).on("dblclick.zoom",p).on(R,h)}function e(n){return[(n[0]-k.x)/k.k,(n[1]-k.y)/k.k]}function r(n){return[n[0]*k.k+k.x,n[1]*k.k+k.y]}function u(n){k.k=Math.max(N[0],Math.min(N[1],n))}function i(n,t){t=r(t),k.x+=n[0]-t[0],k.y+=n[1]-t[1]}function o(t,e,r,o){t.__chart__={x:k.x,y:k.y,k:k.k},u(Math.pow(2,o)),i(d=e,r),t=ta.select(t),C>0&&(t=t.transition().duration(C)),t.call(n.event)}function a(){b&&b.domain(x.range().map(function(n){return(n-k.x)/k.k}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-k.y)/k.k}).map(_.invert))}function c(n){z++||n({type:"zoomstart"})}function l(n){a(),n({type:"zoom",scale:k.k,translate:[k.x,k.y]})}function s(n){--z||n({type:"zoomend"}),d=null}function f(){function n(){f=1,i(ta.mouse(u),g),l(a)}function r(){h.on(L,null).on(T,null),p(f&&ta.event.target===o),s(a)}var u=this,o=ta.event.target,a=D.of(u,arguments),f=0,h=ta.select(t(u)).on(L,n).on(T,r),g=e(ta.mouse(u)),p=W(u);Dl.call(u),c(a)}function h(){function n(){var n=ta.touches(p);return g=k.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=e(n))}),n}function t(){var t=ta.event.target;ta.select(t).on(x,r).on(b,a),_.push(t);for(var e=ta.event.changedTouches,u=0,i=e.length;i>u;++u)d[e[u].identifier]=null;var c=n(),l=Date.now();if(1===c.length){if(500>l-M){var s=c[0];o(p,s,d[s.identifier],Math.floor(Math.log(k.k)/Math.LN2)+1),S()}M=l}else if(c.length>1){var s=c[0],f=c[1],h=s[0]-f[0],g=s[1]-f[1];m=h*h+g*g}}function r(){var n,t,e,r,o=ta.touches(p);Dl.call(p);for(var a=0,c=o.length;c>a;++a,r=null)if(e=o[a],r=d[e.identifier]){if(t)break;n=e,t=r}if(r){var s=(s=e[0]-n[0])*s+(s=e[1]-n[1])*s,f=m&&Math.sqrt(s/m);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+r[0])/2,(t[1]+r[1])/2],u(f*g)}M=null,i(n,t),l(v)}function a(){if(ta.event.touches.length){for(var t=ta.event.changedTouches,e=0,r=t.length;r>e;++e)delete d[t[e].identifier];for(var u in d)return void n()}ta.selectAll(_).on(y,null),w.on(q,f).on(R,h),E(),s(v)}var g,p=this,v=D.of(p,arguments),d={},m=0,y=".zoom-"+ta.event.changedTouches[0].identifier,x="touchmove"+y,b="touchend"+y,_=[],w=ta.select(p),E=W(p);t(),c(v),w.on(q,null).on(R,t)}function g(){var n=D.of(this,arguments);y?clearTimeout(y):(v=e(d=m||ta.mouse(this)),Dl.call(this),c(n)),y=setTimeout(function(){y=null,s(n)},50),S(),u(Math.pow(2,.002*Ha())*k.k),i(d,v),l(n)}function p(){var n=ta.mouse(this),t=Math.log(k.k)/Math.LN2;o(this,n,e(n),ta.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}var v,d,m,y,M,x,b,_,w,k={x:0,y:0,k:1},A=[960,500],N=Ia,C=250,z=0,q="mousedown.zoom",L="mousemove.zoom",T="mouseup.zoom",R="touchstart.zoom",D=E(n,"zoomstart","zoom","zoomend");return Oa||(Oa="onwheel"in ua?(Ha=function(){return-ta.event.deltaY*(ta.event.deltaMode?120:1)},"wheel"):"onmousewheel"in ua?(Ha=function(){return ta.event.wheelDelta},"mousewheel"):(Ha=function(){return-ta.event.detail},"MozMousePixelScroll")),n.event=function(n){n.each(function(){var n=D.of(this,arguments),t=k;Tl?ta.select(this).transition().each("start.zoom",function(){k=this.__chart__||{x:0,y:0,k:1},c(n)}).tween("zoom:zoom",function(){var e=A[0],r=A[1],u=d?d[0]:e/2,i=d?d[1]:r/2,o=ta.interpolateZoom([(u-k.x)/k.k,(i-k.y)/k.k,e/k.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);return function(t){var r=o(t),a=e/r[2];this.__chart__=k={x:u-r[0]*a,y:i-r[1]*a,k:a},l(n)}}).each("interrupt.zoom",function(){s(n)}).each("end.zoom",function(){s(n)}):(this.__chart__=k,c(n),l(n),s(n))})},n.translate=function(t){return arguments.length?(k={x:+t[0],y:+t[1],k:k.k},a(),n):[k.x,k.y]},n.scale=function(t){return arguments.length?(k={x:k.x,y:k.y,k:+t},a(),n):k.k},n.scaleExtent=function(t){return arguments.length?(N=null==t?Ia:[+t[0],+t[1]],n):N},n.center=function(t){return arguments.length?(m=t&&[+t[0],+t[1]],n):m},n.size=function(t){return arguments.length?(A=t&&[+t[0],+t[1]],n):A},n.duration=function(t){return arguments.length?(C=+t,n):C},n.x=function(t){return arguments.length?(b=t,x=t.copy(),k={x:0,y:0,k:1},n):b},n.y=function(t){return arguments.length?(w=t,_=t.copy(),k={x:0,y:0,k:1},n):w},ta.rebind(n,D,"on")};var Ha,Oa,Ia=[0,1/0];ta.color=ot,ot.prototype.toString=function(){return this.rgb()+""},ta.hsl=at;var Ya=at.prototype=new ot;Ya.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new at(this.h,this.s,this.l/n)},Ya.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new at(this.h,this.s,n*this.l)},Ya.rgb=function(){return ct(this.h,this.s,this.l)},ta.hcl=lt;var Za=lt.prototype=new ot;Za.brighter=function(n){return new lt(this.h,this.c,Math.min(100,this.l+Va*(arguments.length?n:1)))},Za.darker=function(n){return new lt(this.h,this.c,Math.max(0,this.l-Va*(arguments.length?n:1)))},Za.rgb=function(){return st(this.h,this.c,this.l).rgb()},ta.lab=ft;var Va=18,Xa=.95047,$a=1,Ba=1.08883,Wa=ft.prototype=new ot;Wa.brighter=function(n){return new ft(Math.min(100,this.l+Va*(arguments.length?n:1)),this.a,this.b)},Wa.darker=function(n){return new ft(Math.max(0,this.l-Va*(arguments.length?n:1)),this.a,this.b)},Wa.rgb=function(){return ht(this.l,this.a,this.b)},ta.rgb=mt;var Ja=mt.prototype=new ot;Ja.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),new mt(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new mt(u,u,u)},Ja.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new mt(n*this.r,n*this.g,n*this.b)},Ja.hsl=function(){return _t(this.r,this.g,this.b)},Ja.toString=function(){return"#"+xt(this.r)+xt(this.g)+xt(this.b)};var Ga=ta.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Ga.forEach(function(n,t){Ga.set(n,yt(t))}),ta.functor=Et,ta.xhr=At(y),ta.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var o=Nt(n,t,null==e?r:u(e),i);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:u(n)):e},o}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function i(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(s>=l)return o;if(u)return u=!1,i;var t=s;if(34===n.charCodeAt(t)){for(var e=t;e++<l;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}s=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++s):10===r&&(u=!0),n.slice(t+1,e).replace(/""/g,'"')}for(;l>s;){var r=n.charCodeAt(s++),a=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(s)&&(++s,++a);else if(r!==c)continue;return n.slice(t,s-a)}return n.slice(t)}for(var r,u,i={},o={},a=[],l=n.length,s=0,f=0;(r=e())!==o;){for(var h=[];r!==i&&r!==o;)h.push(r),r=e();t&&null==(h=t(h,f++))||a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new m,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(o).join(n)].concat(t.map(function(t){return u.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(i).join("\n")},e},ta.csv=ta.dsv(",","text/csv"),ta.tsv=ta.dsv("	","text/tab-separated-values");var Ka,Qa,nc,tc,ec,rc=this[x(this,"requestAnimationFrame")]||function(n){setTimeout(n,17)};ta.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u=e+t,i={c:n,t:u,f:!1,n:null};Qa?Qa.n=i:Ka=i,Qa=i,nc||(tc=clearTimeout(tc),nc=1,rc(qt))},ta.timer.flush=function(){Lt(),Tt()},ta.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var uc=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(Dt);ta.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=ta.round(n,Rt(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),uc[8+e/3]};var ic=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,oc=ta.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=ta.round(n,Rt(n,t))).toFixed(Math.max(0,Math.min(20,Rt(n*(1+1e-15),t))))}}),ac=ta.time={},cc=Date;jt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){lc.setUTCDate.apply(this._,arguments)},setDay:function(){lc.setUTCDay.apply(this._,arguments)},setFullYear:function(){lc.setUTCFullYear.apply(this._,arguments)},setHours:function(){lc.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){lc.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){lc.setUTCMinutes.apply(this._,arguments)},setMonth:function(){lc.setUTCMonth.apply(this._,arguments)},setSeconds:function(){lc.setUTCSeconds.apply(this._,arguments)},setTime:function(){lc.setTime.apply(this._,arguments)}};var lc=Date.prototype;ac.year=Ft(function(n){return n=ac.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ac.years=ac.year.range,ac.years.utc=ac.year.utc.range,ac.day=Ft(function(n){var t=new cc(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ac.days=ac.day.range,ac.days.utc=ac.day.utc.range,ac.dayOfYear=function(n){var t=ac.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=ac[n]=Ft(function(n){return(n=ac.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ac.year(n).getDay();return Math.floor((ac.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ac[n+"s"]=e.range,ac[n+"s"].utc=e.utc.range,ac[n+"OfYear"]=function(n){var e=ac.year(n).getDay();return Math.floor((ac.dayOfYear(n)+(e+t)%7)/7)}}),ac.week=ac.sunday,ac.weeks=ac.sunday.range,ac.weeks.utc=ac.sunday.utc.range,ac.weekOfYear=ac.sundayOfYear;var sc={"-":"",_:" ",0:"0"},fc=/^\s*\d+/,hc=/^%/;ta.locale=function(n){return{numberFormat:Pt(n),timeFormat:Ot(n)}};var gc=ta.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ta.format=gc.numberFormat,ta.geo={},ce.prototype={s:0,t:0,add:function(n){le(n,this.t,pc),le(pc.s,this.s,this),this.s?this.t+=pc.t:this.s=pc.t
},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var pc=new ce;ta.geo.stream=function(n,t){n&&vc.hasOwnProperty(n.type)?vc[n.type](n,t):se(n,t)};var vc={Feature:function(n,t){se(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)se(e[r].geometry,t)}},dc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){fe(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)fe(e[r],t,0)},Polygon:function(n,t){he(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)he(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)se(e[r],t)}};ta.geo.area=function(n){return mc=0,ta.geo.stream(n,Mc),mc};var mc,yc=new ce,Mc={sphere:function(){mc+=4*qa},point:b,lineStart:b,lineEnd:b,polygonStart:function(){yc.reset(),Mc.lineStart=ge},polygonEnd:function(){var n=2*yc;mc+=0>n?4*qa+n:n,Mc.lineStart=Mc.lineEnd=Mc.point=b}};ta.geo.bounds=function(){function n(n,t){M.push(x=[s=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=pe([t*Da,e*Da]);if(m){var u=de(m,r),i=[u[1],-u[0],0],o=de(i,u);Me(o),o=xe(o);var c=t-p,l=c>0?1:-1,v=o[0]*Pa*l,d=ga(c)>180;if(d^(v>l*p&&l*t>v)){var y=o[1]*Pa;y>g&&(g=y)}else if(v=(v+360)%360-180,d^(v>l*p&&l*t>v)){var y=-o[1]*Pa;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);d?p>t?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t):h>=s?(s>t&&(s=t),t>h&&(h=t)):t>p?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t)}else n(t,e);m=r,p=t}function e(){b.point=t}function r(){x[0]=s,x[1]=h,b.point=n,m=null}function u(n,e){if(m){var r=n-p;y+=ga(r)>180?r+(r>0?360:-360):r}else v=n,d=e;Mc.point(n,e),t(n,e)}function i(){Mc.lineStart()}function o(){u(v,d),Mc.lineEnd(),ga(y)>Ca&&(s=-(h=180)),x[0]=s,x[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function l(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var s,f,h,g,p,v,d,m,y,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=u,b.lineStart=i,b.lineEnd=o,y=0,Mc.polygonStart()},polygonEnd:function(){Mc.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,0>yc?(s=-(h=180),f=-(g=90)):y>Ca?g=90:-Ca>y&&(f=-90),x[0]=s,x[1]=h}};return function(n){g=h=-(s=f=1/0),M=[],ta.geo.stream(n,b);var t=M.length;if(t){M.sort(c);for(var e,r=1,u=M[0],i=[u];t>r;++r)e=M[r],l(e[0],u)||l(e[1],u)?(a(u[0],e[1])>a(u[0],u[1])&&(u[1]=e[1]),a(e[0],u[1])>a(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);for(var o,e,p=-1/0,t=i.length-1,r=0,u=i[t];t>=r;u=e,++r)e=i[r],(o=a(u[1],e[0]))>p&&(p=o,s=e[0],h=u[1])}return M=x=null,1/0===s||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[s,f],[h,g]]}}(),ta.geo.centroid=function(n){xc=bc=_c=wc=Sc=kc=Ec=Ac=Nc=Cc=zc=0,ta.geo.stream(n,qc);var t=Nc,e=Cc,r=zc,u=t*t+e*e+r*r;return za>u&&(t=kc,e=Ec,r=Ac,Ca>bc&&(t=_c,e=wc,r=Sc),u=t*t+e*e+r*r,za>u)?[0/0,0/0]:[Math.atan2(e,t)*Pa,tt(r/Math.sqrt(u))*Pa]};var xc,bc,_c,wc,Sc,kc,Ec,Ac,Nc,Cc,zc,qc={sphere:b,point:_e,lineStart:Se,lineEnd:ke,polygonStart:function(){qc.lineStart=Ee},polygonEnd:function(){qc.lineStart=Se}},Lc=Le(Ne,Pe,je,[-qa,-qa/2]),Tc=1e9;ta.geo.clipExtent=function(){var n,t,e,r,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=Ie(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(ta.geo.conicEqualArea=function(){return Ye(Ze)}).raw=Ze,ta.geo.albers=function(){return ta.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ta.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,e(i,o),t||(r(i,o),t)||u(i,o),t}var t,e,r,u,i=ta.geo.albers(),o=ta.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=ta.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=.12&&.234>u&&r>=-.425&&-.214>r?o:u>=.166&&.234>u&&r>=-.214&&-.115>r?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var l=i.scale(),s=+t[0],f=+t[1];return e=i.translate(t).clipExtent([[s-.455*l,f-.238*l],[s+.455*l,f+.238*l]]).stream(c).point,r=o.translate([s-.307*l,f+.201*l]).clipExtent([[s-.425*l+Ca,f+.12*l+Ca],[s-.214*l-Ca,f+.234*l-Ca]]).stream(c).point,u=a.translate([s-.205*l,f+.212*l]).clipExtent([[s-.214*l+Ca,f+.166*l+Ca],[s-.115*l-Ca,f+.234*l-Ca]]).stream(c).point,n},n.scale(1070)};var Rc,Dc,Pc,Uc,jc,Fc,Hc={point:b,lineStart:b,lineEnd:b,polygonStart:function(){Dc=0,Hc.lineStart=Ve},polygonEnd:function(){Hc.lineStart=Hc.lineEnd=Hc.point=b,Rc+=ga(Dc/2)}},Oc={point:Xe,lineStart:b,lineEnd:b,polygonStart:b,polygonEnd:b},Ic={point:We,lineStart:Je,lineEnd:Ge,polygonStart:function(){Ic.lineStart=Ke},polygonEnd:function(){Ic.point=We,Ic.lineStart=Je,Ic.lineEnd=Ge}};ta.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),ta.geo.stream(n,o)),i.result()}function t(){return o=null,n}var e,r,u,i,o,a=4.5;return n.area=function(n){return Rc=0,ta.geo.stream(n,u(Hc)),Rc},n.centroid=function(n){return _c=wc=Sc=kc=Ec=Ac=Nc=Cc=zc=0,ta.geo.stream(n,u(Ic)),zc?[Nc/zc,Cc/zc]:Ac?[kc/Ac,Ec/Ac]:Sc?[_c/Sc,wc/Sc]:[0/0,0/0]},n.bounds=function(n){return jc=Fc=-(Pc=Uc=1/0),ta.geo.stream(n,u(Oc)),[[Pc,Uc],[jc,Fc]]},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||tr(n):y,t()):e},n.context=function(n){return arguments.length?(i=null==(r=n)?new $e:new Qe(n),"function"!=typeof a&&i.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection(ta.geo.albersUsa()).context(null)},ta.geo.transform=function(n){return{stream:function(t){var e=new er(t);for(var r in n)e[r]=n[r];return e}}},er.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ta.geo.projection=ur,ta.geo.projectionMutator=ir,(ta.geo.equirectangular=function(){return ur(ar)}).raw=ar.invert=ar,ta.geo.rotation=function(n){function t(t){return t=n(t[0]*Da,t[1]*Da),t[0]*=Pa,t[1]*=Pa,t}return n=lr(n[0]%360*Da,n[1]*Da,n.length>2?n[2]*Da:0),t.invert=function(t){return t=n.invert(t[0]*Da,t[1]*Da),t[0]*=Pa,t[1]*=Pa,t},t},cr.invert=ar,ta.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=lr(-n[0]*Da,-n[1]*Da,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Pa,n[1]*=Pa}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=gr((t=+r)*Da,u*Da),n):t},n.precision=function(r){return arguments.length?(e=gr(t*Da,(u=+r)*Da),n):u},n.angle(90)},ta.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Da,u=n[1]*Da,i=t[1]*Da,o=Math.sin(r),a=Math.cos(r),c=Math.sin(u),l=Math.cos(u),s=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((e=f*o)*e+(e=l*s-c*f*a)*e),c*s+l*f*a)},ta.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return ta.range(Math.ceil(i/d)*d,u,d).map(h).concat(ta.range(Math.ceil(l/m)*m,c,m).map(g)).concat(ta.range(Math.ceil(r/p)*p,e,p).filter(function(n){return ga(n%d)>Ca}).map(s)).concat(ta.range(Math.ceil(a/v)*v,o,v).filter(function(n){return ga(n%m)>Ca}).map(f))}var e,r,u,i,o,a,c,l,s,f,h,g,p=10,v=p,d=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(l).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],l=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),l>c&&(t=l,l=c,c=t),n.precision(y)):[[i,l],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v]},n.precision=function(t){return arguments.length?(y=+t,s=vr(a,o,90),f=dr(r,e,y),h=vr(l,c,90),g=dr(i,u,y),n):y},n.majorExtent([[-180,-90+Ca],[180,90-Ca]]).minorExtent([[-180,-80-Ca],[180,80+Ca]])},ta.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=mr,u=yr;return n.distance=function(){return ta.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},ta.geo.interpolate=function(n,t){return Mr(n[0]*Da,n[1]*Da,t[0]*Da,t[1]*Da)},ta.geo.length=function(n){return Yc=0,ta.geo.stream(n,Zc),Yc};var Yc,Zc={sphere:b,point:b,lineStart:xr,lineEnd:b,polygonStart:b,polygonEnd:b},Vc=br(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(ta.geo.azimuthalEqualArea=function(){return ur(Vc)}).raw=Vc;var Xc=br(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},y);(ta.geo.azimuthalEquidistant=function(){return ur(Xc)}).raw=Xc,(ta.geo.conicConformal=function(){return Ye(_r)}).raw=_r,(ta.geo.conicEquidistant=function(){return Ye(wr)}).raw=wr;var $c=br(function(n){return 1/n},Math.atan);(ta.geo.gnomonic=function(){return ur($c)}).raw=$c,Sr.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Ra]},(ta.geo.mercator=function(){return kr(Sr)}).raw=Sr;var Bc=br(function(){return 1},Math.asin);(ta.geo.orthographic=function(){return ur(Bc)}).raw=Bc;var Wc=br(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(ta.geo.stereographic=function(){return ur(Wc)}).raw=Wc,Er.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Ra]},(ta.geo.transverseMercator=function(){var n=kr(Er),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90])},e([0,0,90])}).raw=Er,ta.geom={},ta.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u=Et(e),i=Et(r),o=n.length,a=[],c=[];for(t=0;o>t;t++)a.push([+u.call(this,n[t],t),+i.call(this,n[t],t),t]);for(a.sort(zr),t=0;o>t;t++)c.push([a[t][0],-a[t][1]]);var l=Cr(a),s=Cr(c),f=s[0]===l[0],h=s[s.length-1]===l[l.length-1],g=[];for(t=l.length-1;t>=0;--t)g.push(n[a[l[t]][2]]);for(t=+f;t<s.length-h;++t)g.push(n[a[s[t]][2]]);return g}var e=Ar,r=Nr;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},ta.geom.polygon=function(n){return ya(n,Jc),n};var Jc=ta.geom.polygon.prototype=[];Jc.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;++t<e;)n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];return.5*u},Jc.centroid=function(n){var t,e,r=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++r<u;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[i*n,o*n]},Jc.clip=function(n){for(var t,e,r,u,i,o,a=Tr(n),c=-1,l=this.length-Tr(this),s=this[l-1];++c<l;){for(t=n.slice(),n.length=0,u=this[c],i=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],qr(o,s,u)?(qr(i,s,u)||n.push(Lr(i,o,s,u)),n.push(o)):qr(i,s,u)&&n.push(Lr(i,o,s,u)),i=o;a&&n.push(n[0]),s=u}return n};var Gc,Kc,Qc,nl,tl,el=[],rl=[];Or.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)n=t[e].edge,n.b&&n.a||t.splice(e,1);return t.sort(Yr),t.length},Qr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},nu.prototype={insert:function(n,t){var e,r,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=uu(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(u=r.R,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.R&&(eu(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ru(this,r))):(u=r.L,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.L&&(ru(this,e),n=e,e=n.U),e.C=!1,r.C=!0,eu(this,r))),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,u=n.U,i=n.L,o=n.R;if(e=i?o?uu(o):i:o,u?u.L===n?u.L=e:u.R=e:this._=e,i&&o?(r=e.C,e.C=n.C,e.L=i,i.U=e,e!==o?(u=e.U,e.U=n.U,n=e.R,u.L=n,e.R=o,o.U=e):(e.U=u,u=e,n=e.R)):(r=n.C,n=e),n&&(n.U=u),!r){if(n&&n.C)return void(n.C=!1);do{if(n===this._)break;if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,eu(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ru(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,eu(this,u),n=this._;break}}else if(t=u.L,t.C&&(t.C=!1,u.C=!0,ru(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,eu(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,ru(this,u),n=this._;break}t.C=!0,n=u,u=u.U}while(!n.C);n&&(n.C=!1)}}},ta.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],u=a[0][1],i=a[1][0],o=a[1][1];return iu(e(n),a).cells.forEach(function(e,a){var c=e.edges,l=e.site,s=t[a]=c.length?c.map(function(n){var t=n.start();return[t.x,t.y]}):l.x>=r&&l.x<=i&&l.y>=u&&l.y<=o?[[r,o],[i,o],[i,u],[r,u]]:[];s.point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Ca)*Ca,y:Math.round(o(n,t)/Ca)*Ca,i:t}})}var r=Ar,u=Nr,i=r,o=u,a=ul;return n?t(n):(t.links=function(n){return iu(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return iu(e(n)).cells.forEach(function(e,r){for(var u,i,o=e.site,a=e.edges.sort(Yr),c=-1,l=a.length,s=a[l-1].edge,f=s.l===o?s.r:s.l;++c<l;)u=s,i=f,s=a[c].edge,f=s.l===o?s.r:s.l,r<i.i&&r<f.i&&au(o,i,f)<0&&t.push([n[r],n[i.i],n[f.i]])}),t},t.x=function(n){return arguments.length?(i=Et(r=n),t):r},t.y=function(n){return arguments.length?(o=Et(u=n),t):u},t.clipExtent=function(n){return arguments.length?(a=null==n?ul:n,t):a===ul?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===ul?null:a&&a[1]},t)};var ul=[[-1e6,-1e6],[1e6,1e6]];ta.geom.delaunay=function(n){return ta.geom.voronoi().triangles(n)},ta.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,s=n.y;if(null!=c)if(ga(c-e)+ga(s-r)<.01)l(n,t,e,r,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,l(n,f,c,s,u,i,o,a),l(n,t,e,r,u,i,o,a)}else n.x=e,n.y=r,n.point=t}else l(n,t,e,r,u,i,o,a)}function l(n,t,e,r,u,o,a,c){var l=.5*(u+a),s=.5*(o+c),f=e>=l,h=r>=s,g=h<<1|f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=su()),f?u=l:a=l,h?o=s:c=s,i(n,t,e,r,u,o,a,c)}var s,f,h,g,p,v,d,m,y,M=Et(a),x=Et(c);if(null!=t)v=t,d=e,m=r,y=u;else if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)s=n[g],s.x<v&&(v=s.x),s.y<d&&(d=s.y),s.x>m&&(m=s.x),s.y>y&&(y=s.y),f.push(s.x),h.push(s.y);else for(g=0;p>g;++g){var b=+M(s=n[g],g),_=+x(s,g);v>b&&(v=b),d>_&&(d=_),b>m&&(m=b),_>y&&(y=_),f.push(b),h.push(_)}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=su();if(k.add=function(n){i(k,n,+M(n,++g),+x(n,g),v,d,m,y)},k.visit=function(n){fu(n,k,v,d,m,y)},k.find=function(n){return hu(k,n[0],n[1],v,d,m,y)},g=-1,null==t){for(;++g<p;)i(k,n[g],f[g],h[g],v,d,m,y);--g}else n.forEach(k.add);return f=h=n=s=null,k}var o,a=Ar,c=Nr;return(o=arguments.length)?(a=cu,c=lu,3===o&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]]},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e]},i)},ta.interpolateRgb=gu,ta.interpolateObject=pu,ta.interpolateNumber=vu,ta.interpolateString=du;var il=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ol=new RegExp(il.source,"g");ta.interpolate=mu,ta.interpolators=[function(n,t){var e=typeof t;return("string"===e?Ga.has(t)||/^(#|rgb\(|hsl\()/.test(t)?gu:du:t instanceof ot?gu:Array.isArray(t)?yu:"object"===e&&isNaN(t)?pu:vu)(n,t)}],ta.interpolateArray=yu;var al=function(){return y},cl=ta.map({linear:al,poly:ku,quad:function(){return _u},cubic:function(){return wu},sin:function(){return Eu},exp:function(){return Au},circle:function(){return Nu},elastic:Cu,back:zu,bounce:function(){return qu}}),ll=ta.map({"in":y,out:xu,"in-out":bu,"out-in":function(n){return bu(xu(n))}});ta.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.slice(0,t):n,r=t>=0?n.slice(t+1):"in";return e=cl.get(e)||al,r=ll.get(r)||y,Mu(r(e.apply(null,ea.call(arguments,1))))},ta.interpolateHcl=Lu,ta.interpolateHsl=Tu,ta.interpolateLab=Ru,ta.interpolateRound=Du,ta.transform=function(n){var t=ua.createElementNS(ta.ns.prefix.svg,"g");return(ta.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Pu(e?e.matrix:sl)})(n)},Pu.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var sl={a:1,b:0,c:0,d:1,e:0,f:0};ta.interpolateTransform=Hu,ta.layout={},ta.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Yu(n[e]));return t}},ta.layout.chord=function(){function n(){var n,l,f,h,g,p={},v=[],d=ta.range(i),m=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(l=0,g=-1;++g<i;)l+=u[h][g];v.push(l),m.push(ta.range(i)),n+=l}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&m.forEach(function(n,t){n.sort(function(n,e){return a(u[t][n],u[t][e])})}),n=(La-s*i)/n,l=0,h=-1;++h<i;){for(f=l,g=-1;++g<i;){var y=d[h],M=m[y][g],x=u[y][M],b=l,_=l+=x*n;p[y+"-"+M]={index:y,subindex:M,startAngle:b,endAngle:_,value:x}}r[y]={index:y,startAngle:f,endAngle:l,value:(l-f)/n},l+=s}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,o,a,c,l={},s=0;return l.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,l):u},l.padding=function(n){return arguments.length?(s=n,e=r=null,l):s},l.sortGroups=function(n){return arguments.length?(o=n,e=r=null,l):o},l.sortSubgroups=function(n){return arguments.length?(a=n,e=null,l):a},l.sortChords=function(n){return arguments.length?(c=n,e&&t(),l):c},l.chords=function(){return e||n(),e},l.groups=function(){return r||n(),r},l},ta.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=u-e,c=i*i+o*o;if(c>a*a/d){if(p>c){var l=t.charge/c;n.px-=i*l,n.py-=o*l}return!0}if(t.point&&c&&p>c){var l=t.pointCharge/c;n.px-=i*l,n.py-=o*l}}return!t.charge}}function t(n){n.px=ta.event.x,n.py=ta.event.y,a.resume()}var e,r,u,i,o,a={},c=ta.dispatch("start","tick","end"),l=[1,1],s=.9,f=fl,h=hl,g=-30,p=gl,v=.1,d=.64,m=[],M=[];return a.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,a,f,h,p,d,y,x,b=m.length,_=M.length;for(e=0;_>e;++e)a=M[e],f=a.source,h=a.target,y=h.x-f.x,x=h.y-f.y,(p=y*y+x*x)&&(p=r*i[e]*((p=Math.sqrt(p))-u[e])/p,y*=p,x*=p,h.x-=y*(d=f.weight/(h.weight+f.weight)),h.y-=x*d,f.x+=y*(d=1-d),f.y+=x*d);if((d=r*v)&&(y=l[0]/2,x=l[1]/2,e=-1,d))for(;++e<b;)a=m[e],a.x+=(y-a.x)*d,a.y+=(x-a.y)*d;if(g)for(Ju(t=ta.geom.quadtree(m),r,o),e=-1;++e<b;)(a=m[e]).fixed||t.visit(n(a));for(e=-1;++e<b;)a=m[e],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*s,a.y-=(a.py-(a.py=a.y))*s);c.tick({type:"tick",alpha:r})},a.nodes=function(n){return arguments.length?(m=n,a):m},a.links=function(n){return arguments.length?(M=n,a):M},a.size=function(n){return arguments.length?(l=n,a):l},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(s=+n,a):s},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.chargeDistance=function(n){return arguments.length?(p=n*n,a):Math.sqrt(p)},a.gravity=function(n){return arguments.length?(v=+n,a):v},a.theta=function(n){return arguments.length?(d=n*n,a):Math.sqrt(d)},a.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),ta.timer(a.tick)),a):r},a.start=function(){function n(n,r){if(!e){for(e=new Array(c),a=0;c>a;++a)e[a]=[];for(a=0;s>a;++a){var u=M[a];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var i,o=e[t],a=-1,l=o.length;++a<l;)if(!isNaN(i=o[a][n]))return i;return Math.random()*r}var t,e,r,c=m.length,s=M.length,p=l[0],v=l[1];for(t=0;c>t;++t)(r=m[t]).index=t,r.weight=0;for(t=0;s>t;++t)r=M[t],"number"==typeof r.source&&(r.source=m[r.source]),"number"==typeof r.target&&(r.target=m[r.target]),++r.source.weight,++r.target.weight;for(t=0;c>t;++t)r=m[t],isNaN(r.x)&&(r.x=n("x",p)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof f)for(t=0;s>t;++t)u[t]=+f.call(this,M[t],t);else for(t=0;s>t;++t)u[t]=f;if(i=[],"function"==typeof h)for(t=0;s>t;++t)i[t]=+h.call(this,M[t],t);else for(t=0;s>t;++t)i[t]=h;if(o=[],"function"==typeof g)for(t=0;c>t;++t)o[t]=+g.call(this,m[t],t);else for(t=0;c>t;++t)o[t]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return e||(e=ta.behavior.drag().origin(y).on("dragstart.force",Xu).on("drag.force",t).on("dragend.force",$u)),arguments.length?void this.on("mouseover.force",Bu).on("mouseout.force",Wu).call(e):e},ta.rebind(a,c,"on")};var fl=20,hl=1,gl=1/0;ta.layout.hierarchy=function(){function n(u){var i,o=[u],a=[];for(u.depth=0;null!=(i=o.pop());)if(a.push(i),(l=e.call(n,i,i.depth))&&(c=l.length)){for(var c,l,s;--c>=0;)o.push(s=l[c]),s.parent=i,s.depth=i.depth+1;r&&(i.value=0),i.children=l}else r&&(i.value=+r.call(n,i,i.depth)||0),delete i.children;return Qu(u,function(n){var e,u;t&&(e=n.children)&&e.sort(t),r&&(u=n.parent)&&(u.value+=n.value)}),a}var t=ei,e=ni,r=ti;return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return r&&(Ku(t,function(n){n.children&&(n.value=0)}),Qu(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},n},ta.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(o=i.length)){var o,a,c,l=-1;for(r=t.value?r/t.value:0;++l<o;)n(a=i[l],e,c=a.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var o=r.call(this,e,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var r=ta.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},Gu(e,r)},ta.layout.pie=function(){function n(o){var a,c=o.length,l=o.map(function(e,r){return+t.call(n,e,r)}),s=+("function"==typeof r?r.apply(this,arguments):r),f=("function"==typeof u?u.apply(this,arguments):u)-s,h=Math.min(Math.abs(f)/c,+("function"==typeof i?i.apply(this,arguments):i)),g=h*(0>f?-1:1),p=(f-c*g)/ta.sum(l),v=ta.range(c),d=[];return null!=e&&v.sort(e===pl?function(n,t){return l[t]-l[n]}:function(n,t){return e(o[n],o[t])}),v.forEach(function(n){d[n]={data:o[n],value:a=l[n],startAngle:s,endAngle:s+=a*p+g,padAngle:h}}),d}var t=Number,e=pl,r=0,u=La,i=0;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n.padAngle=function(t){return arguments.length?(i=t,n):i},n};var pl={};ta.layout.stack=function(){function n(a,c){if(!(h=a.length))return a;var l=a.map(function(e,r){return t.call(n,e,r)}),s=l.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),o.call(n,t,e)]})}),f=e.call(n,s,c);l=ta.permute(l,f),s=ta.permute(s,f);var h,g,p,v,d=r.call(n,s,c),m=l[0].length;for(p=0;m>p;++p)for(u.call(n,l[0][p],v=d[p],s[0][p][1]),g=1;h>g;++g)u.call(n,l[g][p],v+=s[g-1][p][1],s[g][p][1]);return a}var t=y,e=ai,r=ci,u=oi,i=ui,o=ii;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:vl.get(t)||ai,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:dl.get(t)||ci,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var vl=ta.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(li),i=n.map(si),o=ta.range(r).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,l=[],s=[];for(t=0;r>t;++t)e=o[t],c>a?(a+=i[e],l.push(e)):(c+=i[e],s.push(e));return s.reverse().concat(l)},reverse:function(n){return ta.range(n.length).reverse()},"default":ai}),dl=ta.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,o=[],a=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;i>e;++e)c[e]=(a-o[e])/2;return c},wiggle:function(n){var t,e,r,u,i,o,a,c,l,s=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=l=0,e=1;h>e;++e){for(t=0,u=0;s>t;++t)u+=n[t][e][1];for(t=0,i=0,a=f[e][0]-f[e-1][0];s>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;i+=o*n[t][e][1]}g[e]=c-=u?i/u*a:0,l>c&&(l=c)}for(e=0;h>e;++e)g[e]-=l;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,o=1/u,a=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=o}for(e=0;i>e;++e)a[e]=0;return a},zero:ci});ta.layout.histogram=function(){function n(n,i){for(var o,a,c=[],l=n.map(e,this),s=r.call(this,l,i),f=u.call(this,s,l,i),i=-1,h=l.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=l[i],a>=s[0]&&a<=s[1]&&(o=c[ta.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,e=Number,r=pi,u=hi;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=Et(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return gi(n,t)}:Et(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},ta.layout.pack=function(){function n(n,i){var o=e.call(this,n,i),a=o[0],c=u[0],l=u[1],s=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,Qu(a,function(n){n.r=+s(n.value)}),Qu(a,Mi),r){var f=r*(t?1:Math.max(2*a.r/c,2*a.r/l))/2;Qu(a,function(n){n.r+=f}),Qu(a,Mi),Qu(a,function(n){n.r-=f})}return _i(a,c/2,l/2,t?1:1/Math.max(2*a.r/c,2*a.r/l)),o}var t,e=ta.layout.hierarchy().sort(vi),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},Gu(n,e)},ta.layout.tree=function(){function n(n,u){var s=o.call(this,n,u),f=s[0],h=t(f);if(Qu(h,e),h.parent.m=-h.z,Ku(h,r),l)Ku(f,i);else{var g=f,p=f,v=f;Ku(f,function(n){n.x<g.x&&(g=n),n.x>p.x&&(p=n),n.depth>v.depth&&(v=n)});var d=a(g,p)/2-g.x,m=c[0]/(p.x+a(p,g)/2+d),y=c[1]/(v.depth||1);Ku(f,function(n){n.x=(n.x+d)*m,n.y=n.depth*y})}return s}function t(n){for(var t,e={A:null,children:[n]},r=[e];null!=(t=r.pop());)for(var u,i=t.children,o=0,a=i.length;a>o;++o)r.push((i[o]=u={_:i[o],parent:t,children:(u=i[o].children)&&u.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=u);return e.children[0]}function e(n){var t=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;if(t.length){Ni(n);var i=(t[0].z+t[t.length-1].z)/2;r?(n.z=r.z+a(n._,r._),n.m=n.z-i):n.z=i}else r&&(n.z=r.z+a(n._,r._));n.parent.A=u(n,r,n.parent.A||e[0])}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function u(n,t,e){if(t){for(var r,u=n,i=n,o=t,c=u.parent.children[0],l=u.m,s=i.m,f=o.m,h=c.m;o=Ei(o),u=ki(u),o&&u;)c=ki(c),i=Ei(i),i.a=n,r=o.z+f-u.z-l+a(o._,u._),r>0&&(Ai(Ci(o,n,e),n,r),l+=r,s+=r),f+=o.m,l+=u.m,h+=c.m,s+=i.m;o&&!Ei(i)&&(i.t=o,i.m+=f-s),u&&!ki(c)&&(c.t=u,c.m+=l-h,e=n)}return e}function i(n){n.x*=c[0],n.y=n.depth*c[1]}var o=ta.layout.hierarchy().sort(null).value(null),a=Si,c=[1,1],l=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(l=null==(c=t)?i:null,n):l?null:c},n.nodeSize=function(t){return arguments.length?(l=null==(c=t)?null:i,n):l?c:null},Gu(n,o)},ta.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],l=0;Qu(c,function(n){var t=n.children;t&&t.length?(n.x=qi(t),n.y=zi(t)):(n.x=o?l+=e(n,o):0,n.y=0,o=n)});var s=Li(c),f=Ti(c),h=s.x-e(s,f)/2,g=f.x+e(f,s)/2;return Qu(c,u?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),a}var t=ta.layout.hierarchy().sort(null).value(null),e=Si,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},Gu(n,t)},ta.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var o,a,c,l=f(e),s=[],h=i.slice(),p=1/0,v="slice"===g?l.dx:"dice"===g?l.dy:"slice-dice"===g?1&e.depth?l.dy:l.dx:Math.min(l.dx,l.dy);for(n(h,l.dx*l.dy/e.value),s.area=0;(c=h.length)>0;)s.push(o=h[c-1]),s.area+=o.area,"squarify"!==g||(a=r(s,v))<=p?(h.pop(),p=a):(s.area-=s.pop().area,u(s,v,l,!1),v=Math.min(l.dx,l.dy),s.length=s.area=0,p=1/0);s.length&&(u(s,v,l,!0),s.length=s.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,o=f(t),a=r.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,o=n.length,a=e.x,l=e.y,s=t?c(n.area/t):0;if(t==e.dx){for((r||s>e.dy)&&(s=e.dy);++i<o;)u=n[i],u.x=a,u.y=l,u.dy=s,a+=u.dx=Math.min(e.x+e.dx-a,s?c(u.area/s):0);u.z=!0,u.dx+=e.x+e.dx-a,e.y+=s,e.dy-=s}else{for((r||s>e.dx)&&(s=e.dx);++i<o;)u=n[i],u.x=a,u.y=l,u.dx=s,l+=u.dy=Math.min(e.y+e.dy-l,s?c(u.area/s):0);u.z=!1,u.dy+=e.y+e.dy-l,e.x+=s,e.dx-=s}}function i(r){var u=o||a(r),i=u[0];return i.x=0,i.y=0,i.dx=l[0],i.dy=l[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?e:t)(i),h&&(o=u),u}var o,a=ta.layout.hierarchy(),c=Math.round,l=[1,1],s=null,f=Ri,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));
return i.size=function(n){return arguments.length?(l=n,i):l},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?Ri(t):Di(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Di(t,n)}if(!arguments.length)return s;var r;return f=null==(s=n)?Ri:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},Gu(i,a)},ta.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=ta.random.normal.apply(ta,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=ta.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t}}},ta.scale={};var ml={floor:y,ceil:y};ta.scale.linear=function(){return Ii([0,1],[0,1],mu,!1)};var yl={s:1,g:1,p:1,r:1,e:1};ta.scale.log=function(){return Ji(ta.scale.linear().domain([0,1]),10,!0,[1,10])};var Ml=ta.format(".0e"),xl={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};ta.scale.pow=function(){return Gi(ta.scale.linear(),1,[0,1])},ta.scale.sqrt=function(){return ta.scale.pow().exponent(.5)},ta.scale.ordinal=function(){return Qi([],{t:"range",a:[[]]})},ta.scale.category10=function(){return ta.scale.ordinal().range(bl)},ta.scale.category20=function(){return ta.scale.ordinal().range(_l)},ta.scale.category20b=function(){return ta.scale.ordinal().range(wl)},ta.scale.category20c=function(){return ta.scale.ordinal().range(Sl)};var bl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Mt),_l=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Mt),wl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Mt),Sl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Mt);ta.scale.quantile=function(){return no([],[])},ta.scale.quantize=function(){return to(0,1,[0,1])},ta.scale.threshold=function(){return eo([.5],[0,1])},ta.scale.identity=function(){return ro([0,1])},ta.svg={},ta.svg.arc=function(){function n(){var n=Math.max(0,+e.apply(this,arguments)),l=Math.max(0,+r.apply(this,arguments)),s=o.apply(this,arguments)-Ra,f=a.apply(this,arguments)-Ra,h=Math.abs(f-s),g=s>f?0:1;if(n>l&&(p=l,l=n,n=p),h>=Ta)return t(l,g)+(n?t(n,1-g):"")+"Z";var p,v,d,m,y,M,x,b,_,w,S,k,E=0,A=0,N=[];if((m=(+c.apply(this,arguments)||0)/2)&&(d=i===kl?Math.sqrt(n*n+l*l):+i.apply(this,arguments),g||(A*=-1),l&&(A=tt(d/l*Math.sin(m))),n&&(E=tt(d/n*Math.sin(m)))),l){y=l*Math.cos(s+A),M=l*Math.sin(s+A),x=l*Math.cos(f-A),b=l*Math.sin(f-A);var C=Math.abs(f-s-2*A)<=qa?0:1;if(A&&so(y,M,x,b)===g^C){var z=(s+f)/2;y=l*Math.cos(z),M=l*Math.sin(z),x=b=null}}else y=M=0;if(n){_=n*Math.cos(f-E),w=n*Math.sin(f-E),S=n*Math.cos(s+E),k=n*Math.sin(s+E);var q=Math.abs(s-f+2*E)<=qa?0:1;if(E&&so(_,w,S,k)===1-g^q){var L=(s+f)/2;_=n*Math.cos(L),w=n*Math.sin(L),S=k=null}}else _=w=0;if((p=Math.min(Math.abs(l-n)/2,+u.apply(this,arguments)))>.001){v=l>n^g?0:1;var T=null==S?[_,w]:null==x?[y,M]:Lr([y,M],[S,k],[x,b],[_,w]),R=y-T[0],D=M-T[1],P=x-T[0],U=b-T[1],j=1/Math.sin(Math.acos((R*P+D*U)/(Math.sqrt(R*R+D*D)*Math.sqrt(P*P+U*U)))/2),F=Math.sqrt(T[0]*T[0]+T[1]*T[1]);if(null!=x){var H=Math.min(p,(l-F)/(j+1)),O=fo(null==S?[_,w]:[S,k],[y,M],l,H,g),I=fo([x,b],[_,w],l,H,g);p===H?N.push("M",O[0],"A",H,",",H," 0 0,",v," ",O[1],"A",l,",",l," 0 ",1-g^so(O[1][0],O[1][1],I[1][0],I[1][1]),",",g," ",I[1],"A",H,",",H," 0 0,",v," ",I[0]):N.push("M",O[0],"A",H,",",H," 0 1,",v," ",I[0])}else N.push("M",y,",",M);if(null!=S){var Y=Math.min(p,(n-F)/(j-1)),Z=fo([y,M],[S,k],n,-Y,g),V=fo([_,w],null==x?[y,M]:[x,b],n,-Y,g);p===Y?N.push("L",V[0],"A",Y,",",Y," 0 0,",v," ",V[1],"A",n,",",n," 0 ",g^so(V[1][0],V[1][1],Z[1][0],Z[1][1]),",",1-g," ",Z[1],"A",Y,",",Y," 0 0,",v," ",Z[0]):N.push("L",V[0],"A",Y,",",Y," 0 0,",v," ",Z[0])}else N.push("L",_,",",w)}else N.push("M",y,",",M),null!=x&&N.push("A",l,",",l," 0 ",C,",",g," ",x,",",b),N.push("L",_,",",w),null!=S&&N.push("A",n,",",n," 0 ",q,",",1-g," ",S,",",k);return N.push("Z"),N.join("")}function t(n,t){return"M0,"+n+"A"+n+","+n+" 0 1,"+t+" 0,"+-n+"A"+n+","+n+" 0 1,"+t+" 0,"+n}var e=io,r=oo,u=uo,i=kl,o=ao,a=co,c=lo;return n.innerRadius=function(t){return arguments.length?(e=Et(t),n):e},n.outerRadius=function(t){return arguments.length?(r=Et(t),n):r},n.cornerRadius=function(t){return arguments.length?(u=Et(t),n):u},n.padRadius=function(t){return arguments.length?(i=t==kl?kl:Et(t),n):i},n.startAngle=function(t){return arguments.length?(o=Et(t),n):o},n.endAngle=function(t){return arguments.length?(a=Et(t),n):a},n.padAngle=function(t){return arguments.length?(c=Et(t),n):c},n.centroid=function(){var n=(+e.apply(this,arguments)+ +r.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Ra;return[Math.cos(t)*n,Math.sin(t)*n]},n};var kl="auto";ta.svg.line=function(){return ho(y)};var El=ta.map({linear:go,"linear-closed":po,step:vo,"step-before":mo,"step-after":yo,basis:So,"basis-open":ko,"basis-closed":Eo,bundle:Ao,cardinal:bo,"cardinal-open":Mo,"cardinal-closed":xo,monotone:To});El.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var Al=[0,2/3,1/3,0],Nl=[0,1/3,2/3,0],Cl=[0,1/6,2/3,1/6];ta.svg.line.radial=function(){var n=ho(Ro);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},mo.reverse=yo,yo.reverse=mo,ta.svg.area=function(){return Do(y)},ta.svg.area.radial=function(){var n=Do(Ro);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},ta.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),l=t(this,o,n,a);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,l)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+r(l.r,l.p1,l.a1-l.a0)+u(l.r,l.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=a.call(n,u,r),o=c.call(n,u,r)-Ra,s=l.call(n,u,r)-Ra;return{r:i,a0:o,a1:s,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(s),i*Math.sin(s)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>qa)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=mr,o=yr,a=Po,c=ao,l=co;return n.radius=function(t){return arguments.length?(a=Et(t),n):a},n.source=function(t){return arguments.length?(i=Et(t),n):i},n.target=function(t){return arguments.length?(o=Et(t),n):o},n.startAngle=function(t){return arguments.length?(c=Et(t),n):c},n.endAngle=function(t){return arguments.length?(l=Et(t),n):l},n},ta.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=e.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=mr,e=yr,r=Uo;return n.source=function(e){return arguments.length?(t=Et(e),n):t},n.target=function(t){return arguments.length?(e=Et(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},ta.svg.diagonal.radial=function(){var n=ta.svg.diagonal(),t=Uo,e=n.projection;return n.projection=function(n){return arguments.length?e(jo(t=n)):t},n},ta.svg.symbol=function(){function n(n,r){return(zl.get(t.call(this,n,r))||Oo)(e.call(this,n,r))}var t=Ho,e=Fo;return n.type=function(e){return arguments.length?(t=Et(e),n):t},n.size=function(t){return arguments.length?(e=Et(t),n):e},n};var zl=ta.map({circle:Oo,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Ll)),e=t*Ll;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/ql),e=t*ql/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/ql),e=t*ql/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});ta.svg.symbolTypes=zl.keys();var ql=Math.sqrt(3),Ll=Math.tan(30*Da);_a.transition=function(n){for(var t,e,r=Tl||++Ul,u=Xo(n),i=[],o=Rl||{time:Date.now(),ease:Su,delay:0,duration:250},a=-1,c=this.length;++a<c;){i.push(t=[]);for(var l=this[a],s=-1,f=l.length;++s<f;)(e=l[s])&&$o(e,s,u,r,o),t.push(e)}return Yo(i,u,r)},_a.interrupt=function(n){return this.each(null==n?Dl:Io(Xo(n)))};var Tl,Rl,Dl=Io(Xo()),Pl=[],Ul=0;Pl.call=_a.call,Pl.empty=_a.empty,Pl.node=_a.node,Pl.size=_a.size,ta.transition=function(n,t){return n&&n.transition?Tl?n.transition(t):n:ta.selection().transition(n)},ta.transition.prototype=Pl,Pl.select=function(n){var t,e,r,u=this.id,i=this.namespace,o=[];n=N(n);for(var a=-1,c=this.length;++a<c;){o.push(t=[]);for(var l=this[a],s=-1,f=l.length;++s<f;)(r=l[s])&&(e=n.call(r,r.__data__,s,a))?("__data__"in r&&(e.__data__=r.__data__),$o(e,s,i,u,r[i][u]),t.push(e)):t.push(null)}return Yo(o,i,u)},Pl.selectAll=function(n){var t,e,r,u,i,o=this.id,a=this.namespace,c=[];n=C(n);for(var l=-1,s=this.length;++l<s;)for(var f=this[l],h=-1,g=f.length;++h<g;)if(r=f[h]){i=r[a][o],e=n.call(r,r.__data__,h,l),c.push(t=[]);for(var p=-1,v=e.length;++p<v;)(u=e[p])&&$o(u,p,a,o,i),t.push(u)}return Yo(c,a,o)},Pl.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=O(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var e=this[i],a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return Yo(u,this.namespace,this.id)},Pl.tween=function(n,t){var e=this.id,r=this.namespace;return arguments.length<2?this.node()[r][e].tween.get(n):Y(this,null==t?function(t){t[r][e].tween.remove(n)}:function(u){u[r][e].tween.set(n,t)})},Pl.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?Hu:mu,a=ta.ns.qualify(n);return Zo(this,"attr."+n,t,a.local?i:u)},Pl.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=ta.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},Pl.style=function(n,e,r){function u(){this.style.removeProperty(n)}function i(e){return null==e?u:(e+="",function(){var u,i=t(this).getComputedStyle(this,null).getPropertyValue(n);return i!==e&&(u=mu(i,e),function(t){this.style.setProperty(n,u(t),r)})})}var o=arguments.length;if(3>o){if("string"!=typeof n){2>o&&(e="");for(r in n)this.style(r,n[r],e);return this}r=""}return Zo(this,"style."+n,e,i)},Pl.styleTween=function(n,e,r){function u(u,i){var o=e.call(this,u,i,t(this).getComputedStyle(this,null).getPropertyValue(n));return o&&function(t){this.style.setProperty(n,o(t),r)}}return arguments.length<3&&(r=""),this.tween("style."+n,u)},Pl.text=function(n){return Zo(this,"text",n,Vo)},Pl.remove=function(){var n=this.namespace;return this.each("end.transition",function(){var t;this[n].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Pl.ease=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].ease:("function"!=typeof n&&(n=ta.ease.apply(ta,arguments)),Y(this,function(r){r[e][t].ease=n}))},Pl.delay=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].delay:Y(this,"function"==typeof n?function(r,u,i){r[e][t].delay=+n.call(r,r.__data__,u,i)}:(n=+n,function(r){r[e][t].delay=n}))},Pl.duration=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].duration:Y(this,"function"==typeof n?function(r,u,i){r[e][t].duration=Math.max(1,n.call(r,r.__data__,u,i))}:(n=Math.max(1,n),function(r){r[e][t].duration=n}))},Pl.each=function(n,t){var e=this.id,r=this.namespace;if(arguments.length<2){var u=Rl,i=Tl;try{Tl=e,Y(this,function(t,u,i){Rl=t[r][e],n.call(t,t.__data__,u,i)})}finally{Rl=u,Tl=i}}else Y(this,function(u){var i=u[r][e];(i.event||(i.event=ta.dispatch("start","end","interrupt"))).on(n,t)});return this},Pl.transition=function(){for(var n,t,e,r,u=this.id,i=++Ul,o=this.namespace,a=[],c=0,l=this.length;l>c;c++){a.push(n=[]);for(var t=this[c],s=0,f=t.length;f>s;s++)(e=t[s])&&(r=e[o][u],$o(e,s,o,i,{time:r.time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration})),n.push(e)}return Yo(a,o,i)},ta.svg.axis=function(){function n(n){n.each(function(){var n,l=ta.select(this),s=this.__chart__||e,f=this.__chart__=e.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):y:t,p=l.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ca),d=ta.transition(p.exit()).style("opacity",Ca).remove(),m=ta.transition(p.order()).style("opacity",1),M=Math.max(u,0)+o,x=Ui(f),b=l.selectAll(".domain").data([0]),_=(b.enter().append("path").attr("class","domain"),ta.transition(b));v.append("line"),v.append("text");var w,S,k,E,A=v.select("line"),N=m.select("line"),C=p.select("text").text(g),z=v.select("text"),q=m.select("text"),L="top"===r||"left"===r?-1:1;if("bottom"===r||"top"===r?(n=Bo,w="x",k="y",S="x2",E="y2",C.attr("dy",0>L?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+x[0]+","+L*i+"V0H"+x[1]+"V"+L*i)):(n=Wo,w="y",k="x",S="y2",E="x2",C.attr("dy",".32em").style("text-anchor",0>L?"end":"start"),_.attr("d","M"+L*i+","+x[0]+"H0V"+x[1]+"H"+L*i)),A.attr(E,L*u),z.attr(k,L*M),N.attr(S,0).attr(E,L*u),q.attr(w,0).attr(k,L*M),f.rangeBand){var T=f,R=T.rangeBand()/2;s=f=function(n){return T(n)+R}}else s.rangeBand?s=f:d.call(n,f,s);v.call(n,s,f),m.call(n,f,f)})}var t,e=ta.scale.linear(),r=jl,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Fl?t+"":jl,n):r},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(u=+t,i=+arguments[e-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var jl="bottom",Fl={top:1,right:1,bottom:1,left:1};ta.svg.brush=function(){function n(t){t.each(function(){var t=ta.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),o=t.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=t.selectAll(".resize").data(v,y);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return Hl[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var c,f=ta.transition(t),h=ta.transition(o);l&&(c=Ui(l),h.attr("x",c[0]).attr("width",c[1]-c[0]),r(f)),s&&(c=Ui(s),h.attr("y",c[0]).attr("height",c[1]-c[0]),u(f)),e(f)})}function e(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+f[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function r(n){n.select(".extent").attr("x",f[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",f[1]-f[0])}function u(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function i(){function i(){32==ta.event.keyCode&&(C||(M=null,q[0]-=f[1],q[1]-=h[1],C=2),S())}function v(){32==ta.event.keyCode&&2==C&&(q[0]+=f[1],q[1]+=h[1],C=0,S())}function d(){var n=ta.mouse(b),t=!1;x&&(n[0]+=x[0],n[1]+=x[1]),C||(ta.event.altKey?(M||(M=[(f[0]+f[1])/2,(h[0]+h[1])/2]),q[0]=f[+(n[0]<M[0])],q[1]=h[+(n[1]<M[1])]):M=null),A&&m(n,l,0)&&(r(k),t=!0),N&&m(n,s,1)&&(u(k),t=!0),t&&(e(k),w({type:"brush",mode:C?"move":"resize"}))}function m(n,t,e){var r,u,i=Ui(t),c=i[0],l=i[1],s=q[e],v=e?h:f,d=v[1]-v[0];return C&&(c-=s,l-=d+s),r=(e?p:g)?Math.max(c,Math.min(l,n[e])):n[e],C?u=(r+=s)+d:(M&&(s=Math.max(c,Math.min(l,2*M[e]-r))),r>s?(u=r,r=s):u=s),v[0]!=r||v[1]!=u?(e?a=null:o=null,v[0]=r,v[1]=u,!0):void 0}function y(){d(),k.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),ta.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),z(),w({type:"brushend"})}var M,x,b=this,_=ta.select(ta.event.target),w=c.of(b,arguments),k=ta.select(b),E=_.datum(),A=!/^(n|s)$/.test(E)&&l,N=!/^(e|w)$/.test(E)&&s,C=_.classed("extent"),z=W(b),q=ta.mouse(b),L=ta.select(t(b)).on("keydown.brush",i).on("keyup.brush",v);if(ta.event.changedTouches?L.on("touchmove.brush",d).on("touchend.brush",y):L.on("mousemove.brush",d).on("mouseup.brush",y),k.interrupt().selectAll("*").interrupt(),C)q[0]=f[0]-q[0],q[1]=h[0]-q[1];else if(E){var T=+/w$/.test(E),R=+/^n/.test(E);x=[f[1-T]-q[0],h[1-R]-q[1]],q[0]=f[T],q[1]=h[R]}else ta.event.altKey&&(M=q.slice());k.style("pointer-events","none").selectAll(".resize").style("display",null),ta.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),d()}var o,a,c=E(n,"brushstart","brush","brushend"),l=null,s=null,f=[0,0],h=[0,0],g=!0,p=!0,v=Ol[0];return n.event=function(n){n.each(function(){var n=c.of(this,arguments),t={x:f,y:h,i:o,j:a},e=this.__chart__||t;this.__chart__=t,Tl?ta.select(this).transition().each("start.brush",function(){o=e.i,a=e.j,f=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=yu(f,t.x),r=yu(h,t.y);return o=a=null,function(u){f=t.x=e(u),h=t.y=r(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=t.i,a=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(l=t,v=Ol[!l<<1|!s],n):l},n.y=function(t){return arguments.length?(s=t,v=Ol[!l<<1|!s],n):s},n.clamp=function(t){return arguments.length?(l&&s?(g=!!t[0],p=!!t[1]):l?g=!!t:s&&(p=!!t),n):l&&s?[g,p]:l?g:s?p:null},n.extent=function(t){var e,r,u,i,c;return arguments.length?(l&&(e=t[0],r=t[1],s&&(e=e[0],r=r[0]),o=[e,r],l.invert&&(e=l(e),r=l(r)),e>r&&(c=e,e=r,r=c),(e!=f[0]||r!=f[1])&&(f=[e,r])),s&&(u=t[0],i=t[1],l&&(u=u[1],i=i[1]),a=[u,i],s.invert&&(u=s(u),i=s(i)),u>i&&(c=u,u=i,i=c),(u!=h[0]||i!=h[1])&&(h=[u,i])),n):(l&&(o?(e=o[0],r=o[1]):(e=f[0],r=f[1],l.invert&&(e=l.invert(e),r=l.invert(r)),e>r&&(c=e,e=r,r=c))),s&&(a?(u=a[0],i=a[1]):(u=h[0],i=h[1],s.invert&&(u=s.invert(u),i=s.invert(i)),u>i&&(c=u,u=i,i=c))),l&&s?[[e,u],[r,i]]:l?[e,r]:s&&[u,i])},n.clear=function(){return n.empty()||(f=[0,0],h=[0,0],o=a=null),n},n.empty=function(){return!!l&&f[0]==f[1]||!!s&&h[0]==h[1]},ta.rebind(n,c,"on")};var Hl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Ol=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Il=ac.format=gc.timeFormat,Yl=Il.utc,Zl=Yl("%Y-%m-%dT%H:%M:%S.%LZ");Il.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Jo:Zl,Jo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},Jo.toString=Zl.toString,ac.second=Ft(function(n){return new cc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ac.seconds=ac.second.range,ac.seconds.utc=ac.second.utc.range,ac.minute=Ft(function(n){return new cc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ac.minutes=ac.minute.range,ac.minutes.utc=ac.minute.utc.range,ac.hour=Ft(function(n){var t=n.getTimezoneOffset()/60;return new cc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ac.hours=ac.hour.range,ac.hours.utc=ac.hour.utc.range,ac.month=Ft(function(n){return n=ac.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ac.months=ac.month.range,ac.months.utc=ac.month.utc.range;var Vl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Xl=[[ac.second,1],[ac.second,5],[ac.second,15],[ac.second,30],[ac.minute,1],[ac.minute,5],[ac.minute,15],[ac.minute,30],[ac.hour,1],[ac.hour,3],[ac.hour,6],[ac.hour,12],[ac.day,1],[ac.day,2],[ac.week,1],[ac.month,1],[ac.month,3],[ac.year,1]],$l=Il.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",Ne]]),Bl={range:function(n,t,e){return ta.range(Math.ceil(n/e)*e,+t,e).map(Ko)},floor:y,ceil:y};Xl.year=ac.year,ac.scale=function(){return Go(ta.scale.linear(),Xl,$l)};var Wl=Xl.map(function(n){return[n[0].utc,n[1]]}),Jl=Yl.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",Ne]]);Wl.year=ac.year.utc,ac.scale.utc=function(){return Go(ta.scale.linear(),Wl,Jl)},ta.text=At(function(n){return n.responseText}),ta.json=function(n,t){return Nt(n,"application/json",Qo,t)},ta.html=function(n,t){return Nt(n,"text/html",na,t)},ta.xml=At(function(n){return n.responseXML}),"function"==typeof define&&define.amd?define(ta):"object"==typeof module&&module.exports&&(module.exports=ta),this.d3=ta}();
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.2.1
 */

(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){G=t}function r(t){Q=t}function o(){return function(){process.nextTick(a)}}function i(){return function(){B(a)}}function s(){var t=0,e=new X(a),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=a,function(){t.port2.postMessage(0)}}function c(){return function(){setTimeout(a,1)}}function a(){for(var t=0;J>t;t+=2){var e=tt[t],n=tt[t+1];e(n),tt[t]=void 0,tt[t+1]=void 0}J=0}function f(){try{var t=require,e=t("vertx");return B=e.runOnLoop||e.runOnContext,i()}catch(n){return c()}}function l(t,e){var n=this,r=new this.constructor(p);void 0===r[rt]&&k(r);var o=n._state;if(o){var i=arguments[o-1];Q(function(){x(o,r,i,n._result)})}else E(n,r,t,e);return r}function h(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return g(n,t),n}function p(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(e){return ut.error=e,ut}}function y(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function m(t,e,n){Q(function(t){var r=!1,o=y(n,e,function(n){r||(r=!0,e!==n?g(t,n):S(t,n))},function(e){r||(r=!0,j(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,j(t,o))},t)}function b(t,e){e._state===it?S(t,e._result):e._state===st?j(t,e._result):E(e,void 0,function(e){g(t,e)},function(e){j(t,e)})}function w(t,n,r){n.constructor===t.constructor&&r===et&&constructor.resolve===nt?b(t,n):r===ut?j(t,ut.error):void 0===r?S(t,n):e(r)?m(t,n,r):S(t,n)}function g(e,n){e===n?j(e,_()):t(n)?w(e,n,v(n)):S(e,n)}function A(t){t._onerror&&t._onerror(t._result),T(t)}function S(t,e){t._state===ot&&(t._result=e,t._state=it,0!==t._subscribers.length&&Q(T,t))}function j(t,e){t._state===ot&&(t._state=st,t._result=e,Q(A,t))}function E(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+it]=n,o[i+st]=r,0===i&&t._state&&Q(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?x(n,r,o,i):o(i);t._subscribers.length=0}}function M(){this.error=null}function P(t,e){try{return t(e)}catch(n){return ct.error=n,ct}}function x(t,n,r,o){var i,s,u,c,a=e(r);if(a){if(i=P(r,o),i===ct?(c=!0,s=i.error,i=null):u=!0,n===i)return void j(n,d())}else i=o,u=!0;n._state!==ot||(a&&u?g(n,i):c?j(n,s):t===it?S(n,i):t===st&&j(n,i))}function C(t,e){try{e(function(e){g(t,e)},function(e){j(t,e)})}catch(n){j(t,n)}}function O(){return at++}function k(t){t[rt]=at++,t._state=void 0,t._result=void 0,t._subscribers=[]}function Y(t){return new _t(this,t).promise}function q(t){var e=this;return new e(I(t)?function(n,r){for(var o=t.length,i=0;o>i;i++)e.resolve(t[i]).then(n,r)}:function(t,e){e(new TypeError("You must pass an array to race."))})}function F(t){var e=this,n=new e(p);return j(n,t),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function K(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(t){this[rt]=O(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&D(),this instanceof L?C(this,t):K())}function N(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[rt]||k(this.promise),Array.isArray(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):j(this.promise,U())}function U(){return new Error("Array Methods must be provided an Array")}function W(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=pt)}var z;z=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var B,G,H,I=z,J=0,Q=function(t,e){tt[J]=t,tt[J+1]=e,J+=2,2===J&&(G?G(a):H())},R="undefined"!=typeof window?window:void 0,V=R||{},X=V.MutationObserver||V.WebKitMutationObserver,Z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,tt=new Array(1e3);H=Z?o():X?s():$?u():void 0===R&&"function"==typeof require?f():c();var et=l,nt=h,rt=Math.random().toString(36).substring(16),ot=void 0,it=1,st=2,ut=new M,ct=new M,at=0,ft=Y,lt=q,ht=F,pt=L;L.all=ft,L.race=lt,L.resolve=nt,L.reject=ht,L._setScheduler=n,L._setAsap=r,L._asap=Q,L.prototype={constructor:L,then:et,"catch":function(t){return this.then(null,t)}};var _t=N;N.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===ot&&t>n;n++)this._eachEntry(e[n],n)},N.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===nt){var o=v(t);if(o===et&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===pt){var i=new n(p);w(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){e(t)}),e)}else this._willSettleAt(r(t),e)},N.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===ot&&(this._remaining--,t===st?j(r,n):this._result[e]=n),0===this._remaining&&S(r,this._result)},N.prototype._willSettleAt=function(t,e){var n=this;E(t,void 0,function(t){n._settledAt(it,e,t)},function(t){n._settledAt(st,e,t)})};var dt=W,vt={Promise:pt,polyfill:dt};"function"==typeof define&&define.amd?define(function(){return vt}):"undefined"!=typeof module&&module.exports?module.exports=vt:"undefined"!=typeof this&&(this.ES6Promise=vt),dt()}).call(this);
if (typeof Object.assign != 'function') {
	Object.assign = function (target, varArgs) { // .length of function is 2
		'use strict';
		if (target == null) { // TypeError if undefined or null
			throw new TypeError('Cannot convert undefined or null to object');
		}

		var to = Object(target);

		for (var index = 1; index < arguments.length; index++) {
			var nextSource = arguments[index];

			if (nextSource != null) { // Skip over if undefined or null
				for (var nextKey in nextSource) {
					// Avoid bugs when hasOwnProperty is shadowed
					if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
						to[nextKey] = nextSource[nextKey];
					}
				}
			}
		}
		return to;
	};
}

!function(n){"use strict";function t(n,t){var r=(65535&n)+(65535&t),e=(n>>16)+(t>>16)+(r>>16);return e<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[(r+64>>>9<<4)+14]=r;var e,i,a,h,d,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,h=v,d=m,l=o(l,g,v,m,n[e],7,-680876936),m=o(m,l,g,v,n[e+1],12,-389564586),v=o(v,m,l,g,n[e+2],17,606105819),g=o(g,v,m,l,n[e+3],22,-1044525330),l=o(l,g,v,m,n[e+4],7,-176418897),m=o(m,l,g,v,n[e+5],12,1200080426),v=o(v,m,l,g,n[e+6],17,-1473231341),g=o(g,v,m,l,n[e+7],22,-45705983),l=o(l,g,v,m,n[e+8],7,1770035416),m=o(m,l,g,v,n[e+9],12,-1958414417),v=o(v,m,l,g,n[e+10],17,-42063),g=o(g,v,m,l,n[e+11],22,-1990404162),l=o(l,g,v,m,n[e+12],7,1804603682),m=o(m,l,g,v,n[e+13],12,-40341101),v=o(v,m,l,g,n[e+14],17,-1502002290),g=o(g,v,m,l,n[e+15],22,1236535329),l=u(l,g,v,m,n[e+1],5,-165796510),m=u(m,l,g,v,n[e+6],9,-1069501632),v=u(v,m,l,g,n[e+11],14,643717713),g=u(g,v,m,l,n[e],20,-373897302),l=u(l,g,v,m,n[e+5],5,-701558691),m=u(m,l,g,v,n[e+10],9,38016083),v=u(v,m,l,g,n[e+15],14,-660478335),g=u(g,v,m,l,n[e+4],20,-405537848),l=u(l,g,v,m,n[e+9],5,568446438),m=u(m,l,g,v,n[e+14],9,-1019803690),v=u(v,m,l,g,n[e+3],14,-187363961),g=u(g,v,m,l,n[e+8],20,1163531501),l=u(l,g,v,m,n[e+13],5,-1444681467),m=u(m,l,g,v,n[e+2],9,-51403784),v=u(v,m,l,g,n[e+7],14,1735328473),g=u(g,v,m,l,n[e+12],20,-1926607734),l=c(l,g,v,m,n[e+5],4,-378558),m=c(m,l,g,v,n[e+8],11,-2022574463),v=c(v,m,l,g,n[e+11],16,1839030562),g=c(g,v,m,l,n[e+14],23,-35309556),l=c(l,g,v,m,n[e+1],4,-1530992060),m=c(m,l,g,v,n[e+4],11,1272893353),v=c(v,m,l,g,n[e+7],16,-155497632),g=c(g,v,m,l,n[e+10],23,-1094730640),l=c(l,g,v,m,n[e+13],4,681279174),m=c(m,l,g,v,n[e],11,-358537222),v=c(v,m,l,g,n[e+3],16,-722521979),g=c(g,v,m,l,n[e+6],23,76029189),l=c(l,g,v,m,n[e+9],4,-640364487),m=c(m,l,g,v,n[e+12],11,-421815835),v=c(v,m,l,g,n[e+15],16,530742520),g=c(g,v,m,l,n[e+2],23,-995338651),l=f(l,g,v,m,n[e],6,-198630844),m=f(m,l,g,v,n[e+7],10,1126891415),v=f(v,m,l,g,n[e+14],15,-1416354905),g=f(g,v,m,l,n[e+5],21,-57434055),l=f(l,g,v,m,n[e+12],6,1700485571),m=f(m,l,g,v,n[e+3],10,-1894986606),v=f(v,m,l,g,n[e+10],15,-1051523),g=f(g,v,m,l,n[e+1],21,-2054922799),l=f(l,g,v,m,n[e+8],6,1873313359),m=f(m,l,g,v,n[e+15],10,-30611744),v=f(v,m,l,g,n[e+6],15,-1560198380),g=f(g,v,m,l,n[e+13],21,1309151649),l=f(l,g,v,m,n[e+4],6,-145523070),m=f(m,l,g,v,n[e+11],10,-1120210379),v=f(v,m,l,g,n[e+2],15,718787259),g=f(g,v,m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,h),m=t(m,d);return[l,g,v,m]}function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function h(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function d(n){return a(i(h(n),8*n.length))}function l(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="0123456789abcdef",o="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),o+=e.charAt(t>>>4&15)+e.charAt(15&t);return o}function v(n){return unescape(encodeURIComponent(n))}function m(n){return d(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define(function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);

/*
	To-do:
		add sched/color mapping to options
		course.sections should have 'schd' instead of using no[0]
		xscale should adjust if there are sa/su courses. (MCM 0901Q, TAPS 1370)
*/
var _calColors = void 0;

function setupCalendarColors() {
	_calColors = {
		groups: [],
		colors: []
	};

	foseConfig.calendarColors.forEach(function (colors) {
		_calColors.colors.push(colors.split(','));
	});

	_calColors.groups = foseConfig.calendarGroups.split(',');
	_calColors.groups.push('other');
}

/**
* Update the order that elements appear in the dom to match the order of the selection
*
* @param {Selection} sectg selection of elements in the dom
*/
function updateDomOrder(sectg) {
	sectg.each(function() {
		var curFocus = (document.activeElement === this);
		var parent = sectg[0].parentNode;
		var removed = d3.select(this).remove();
		parent.append(removed.node());
		if(curFocus) {
			this.focus();
		}
	});
}

/**
* Expand the abbreviation of days into the full names
*
* @param {string} mptime time formatted like 'MWF 11am-1:30pm'
* @returns {string} time with full name of days
*/
function expandMptime(mptime) {
	var daymaps = {M:"Monday", T:"Tuesday", W:"Wednesday", Th:"Thursday", F:"Friday", Sa:"Saturday", Su:"Sunday"};
	var out = "";
	var days = [];
	var timeGroups = mptime.match(/([MTWFShua]+) ([0-9:]+[apm]*)-([0-9:]+[apm]*)/);
	if(timeGroups && timeGroups.length >= 4) {
		timeGroups[1].match(/(M|T(?!h)|W|Th|F|Sa|Su)/g).forEach(function(day) {
			days.push(daymaps[day]);
		})
	}
	if(days.length) {
		if(days.length === 1) {
			out = days[0] + " from " + timeGroups[2] + " to " + timeGroups[3];
		} else {
			for(var j = 0; j < days.length - 1; j++) {
				out += days[j] + ", ";
			}
			out += "and " + days[j] + " from " + timeGroups[2] + " to " + timeGroups[3];
		}
	}
	return out;
}

/**
*	Given "MWF 11am-1:30pm", return: [
*		{key:crn.0, day:"Mon", start:1100, end:1350},
*		{key:crn.1, day:"Wed", start:1100, end:1350},
*		{key:crn.2, day:"Fri", start:1100, end:1350}
*	];
*
* @param {string} mp time formatted like 'MWF 11am-1:30pm'
* @param {string} crn
* @param {number} semipart
*/
function flattenMP(mp, crn, semipart) {
	var mptime = mp.match(
			/([MTWFShua]+) ([0-9:]+)([apm]*)-([0-9:]+)([apm]*)/);
	if (!mptime)
		return [];
	var start = milTime(mptime[2], mptime[3] ? mptime[3] : mptime[5]);
	var end = milTime(mptime[4], mptime[5]);
	// Handle 9-12p
	if (!mptime[3] && start > 1200 && start > end)
		start -= 1200;

	var ret = [];
	var daymaps = {
		M:"Mon", T:"Tue", W:"Wed", Th:"Thu", F:"Fri", Sa:"Sat", Su:"Sun" };
	var partno = 0;
	mptime[1].match(/(M|T(?!h)|W|Th|F|Sa|Su)/g).forEach(function(day) {
		ret.push({key:crn + "." + partno++ + (semipart ? "." + semipart : ""),
			 day:daymaps[day], start:start, end:end});
	});
	return ret;
}

/**
* Expand the abbreviation of days into the full names in a set of a set of times
*
* @param {string} mp time formatted like 'MWF 11am-1:30pm;SaTh 2pm-2:30pm'
* @returns {string} time with full name of days
*/
function expandDays(mp) {
	var out = "";
	if(mp == null) {
		return out;
	}
	var mptimes = mp.match(/([MTWFShua]+) ([0-9:]+[apm]*-[0-9:]+[apm]*)/g);
	if(mptimes) {
		for(var i = 0; i < mptimes.length -1; i++) {
			mptime = mptimes[i];
			out += expandMptime(mptime) + ', ';
		}
		if(i > 0) {
			out += "and ";
		}
		return out + expandMptime(mptimes[i]) + '.';
	}
	return out;
}

/**
* Convert 12 hour time into  time represented as a number
*
*ex: given: str=="1:30" and mod=='pm' return: 1350
*
* @param {string} time formatted as hour:min (ex: 9:20) or hour (ex: 9) on a 12 hour clock
* @param {string} mod 'am' or 'pm'
* @return {number} time represented as a number (ex: 1:30pm is represented ad 1350)
*/
function milTime(str, mod) {
	var base;
	if (str.match(/(\d+):(\d+)/)) {
		base = Math.floor(((RegExp.$1 * 100) + (RegExp.$2 * 10 / 6)));
	} else {
		base = (str * 100);
	}
	if (base < 1200 && mod && /p/.test(mod))
		return base + 1200;
	return base;
}

/**
* Formats time on the our with am and pm
*
* @param {number} d time formatted on the hour in 24 hour time (ex: 2300 stands for 11:00pm)
* @returns {string} houly formatted time with am and pm
*/
function formatTime(d) {
	if (d == 1200)
		return 'noon';
	if (d > 1200)
		return (d - 1200)/100 + 'pm';
	else
		return d/100 + 'am';
}

function dateToText(date) {
	var monthMaps = {0:"January", 1:"February", 2:"March", 3:"April", 4:"May", 5:"June", 6:"July", 7:"August", 8:"September", 9:"October", 10:"November", 11:"December"};
	var month = monthMaps[date.getUTCMonth()];
	var day = date.getUTCDate();
	var year = date.getFullYear();
	return month + " " + day + ", " + year;
}

/**
* Picks a color that best contrasts the given color
*
* @param {Object} in_col color to be contrasted against
* @returns {string} best contrasting color
*/
function contrast(in_col) {
	var col = d3.rgb(in_col);
	if (d3.mean([col.r, col.b, col.g]) > 128)
		return "black";
	else
		return "white";
}

function switchFocus(prev, next) {
	var nextNode = d3.select(next).attr("tabindex", 0).attr('focusable', true);
	if(isIe()) {
		//focus svg element hack from: https://allyjs.io/tutorials/focusing-in-svg.html
		var focusFacade = nextNode.append("foreignObject")
			.attr("class", "focus-facade");

		//uses jquery because d3 doesn't append the element with the HTMLElement prototype that has the focus() function.
		var input = $(".focus-facade").append('<input id="focus-facade-input"/>');
		document.getElementById("focus-facade-input").focus.apply(document.getElementById("focus-facade-input"));
		focusFacade.select("#focus-facade-input").attr("disabled", true);
		focusFacade.remove();
	} else {
		next.focus();
	}
	d3.select(prev).attr("tabindex", -1).attr('focusable', false);
}

/**
* Check if a browser is ie or edge.
*
* @return true if current browser is ie or edge.
*/
function isIe() {
	var ua = window.navigator.userAgent;
	var msie = ua.indexOf("MSIE ");
	if(msie != -1 || /Edge/.test(navigator.userAgent) || navigator.userAgent.match(/Trident/)) {
		return true;
	}
	return false;
}


/**
 * Draw a Calendar of courses over a term
 *
 * @param {Object} in_svg SVG element to draw in
 * @param {Array} sections Array of objects, each representing a section
 * @param {Object} options
 */
 function drawTermCalendar(in_svg, sections, options) {
	if (!options)
		options = {};

	if(in_svg === null) {
		return;
	}
	if(!_calColors) {
		setupCalendarColors();
	}

	var scheds = initScheds(_calColors.groups);
	var calSections = initSectionDomain(sections, scheds);
	if(!calSections.length) {
		return;
	}
	var minDate = d3.min(calSections, function(sec) {var day = parseDate(sec.start_date); day.setUTCDate(day.getUTCDate()); return day;});
	var maxDate = d3.max(calSections, function(sec) {var day = parseDate(sec.end_date); day.setUTCDate(day.getUTCDate()); return day;});
	var numDays = diffDays(minDate, maxDate) + 1;
	var termCalObj = initTermCalObj(in_svg, calSections, options, numDays);
	var colors = initColors(scheds);
	var redraw = options.calobj ? true : false;

	d3.select(in_svg)
		.attr("height", termCalObj.height + termCalObj.margin.top + termCalObj.margin.bottom)
		.attr("width", termCalObj.width + termCalObj.margin.left + termCalObj.margin.right);

	if(!redraw) {
		d3.select(in_svg).append("clipPath")
			.attr("id", "externalclip")
			.append("rect")
			.attr("width", termCalObj.width + termCalObj.margin.right + termCalObj.margin.left)
			.attr("height", termCalObj.height + termCalObj.margin.top + termCalObj.margin.bottom);

		var external = d3.select(in_svg).append("g")
			.attr("id", "external")
			.attr("clip-path", "url(#externalclip)");

		d3.select(in_svg).append("clipPath")
			.attr("id", "internalclip")
			.append("rect")
			.attr("width", termCalObj.width)
			.attr("height", termCalObj.height);

		var internal = d3.select(in_svg).selectAll("#internal")
			.data([{x:0, y:0}])
			.enter().append("g")
			.attr("transform", function() { return "translate(" + termCalObj.margin.left + ", " + termCalObj.margin.top +")";})
			.attr("clip-path", "url(#internalclip)")
			.append("g")
			.attr("id", "internal");

		internal.append("rect")
			.attr("id", "internalbackground")
			.attr("fill", "transparent")
			.attr("height", termCalObj.barHeight * calSections.length)
			.attr("width", termCalObj.internalWidth);

		internal.append('g')
			.attr("class", "axis weekdaygrid")
			.attr("aria-hidden", "true");

		internal.append('g')
			.attr("class", "axis weekgrid")
			.attr("aria-hidden", "true");

		external.append('g')
			.attr("class", "axis weeks")
			.attr("aria-hidden", "true");

		external.append('g')
			.attr("class", "axis days")
			.attr("aria-hidden", "true");

		var yscroll = d3.select(in_svg).append("g")
			.attr("transform", function() {return "translate("+ (termCalObj.margin.left + termCalObj.width) + ", " +  termCalObj.margin.top + ")";});

		yscroll.append("rect")
			.attr("id", "yscroll")
			.attr("width", termCalObj.scrollWidth)
			.attr("height", termCalObj.height * (termCalObj.height/termCalObj.internalHeight))
			.attr("fill", "#adadad")
			.attr("rx", 5)
			.attr("ry", 5);
	}

	d3.select(in_svg).select("#yscroll")
		.attr("height", termCalObj.height * (termCalObj.height/termCalObj.internalHeight))
		.attr("visibility", function() {
			if(termCalObj.height < termCalObj.internalHeight) {
				return "visible";
			} else {
				return "hidden";
			}
		})
		.attr("transform", function() {return "translate(" + 0 + ", " + 0 + ")";});

	var drag = d3.behavior.drag()
		.origin(function(d) {var el = d3.select(this); return {x:d3.transform(el.attr("transform")).translate[0], y:d3.transform(el.attr("transform")).translate[1]};})
		.on('drag', dragmove)
		.on('dragend', function() {
			d3.select(this).attr("class", "");
		});

	d3.select(in_svg).selectAll("#internal")
		.call(drag)
		.attr("transform", function() { return "translate(" + 0 + ", " + 0 +")"});

	var barDrag = d3.behavior.drag()
		.origin(function() {var el = d3.select(this); return {x:d3.transform(el.attr("transform")).translate[0], y:d3.transform(el.attr("transform")).translate[1]};})
		.on('drag', barDragmove);

	d3.select(in_svg).selectAll('#yscroll')
		.call(barDrag);

	var xScale = d3.time.scale.utc()
		.domain([minDate, maxDate.setDate(maxDate.getDate()+1)])
		.range([0, termCalObj.internalWidth])
		.nice(d3.time.day.utc);

	var termDays = calSections.map(function(d) {var day = parseDate(d.start_date); day.setUTCDate(day.getUTCDate()); return day;})
		.concat(calSections.map(function(d) {var day = parseDate(d.end_date); day.setUTCDate(day.getUTCDate()); return day;}));

	var weeks = d3.svg.axis();
	var days = d3.svg.axis();
	var weekdayGrid = d3.svg.axis();
	var weekGrid = d3.svg.axis();

	weeks.scale(xScale)
		.orient("top")
		.ticks(d3.time.week.utc, 1)
		.tickSize(6)
		.tickFormat(d3.time.format.utc("%b %_d"));

	days.scale(xScale)
		.orient("bottom")
		.tickValues(termDays)
		.tickSize(6)
		.tickFormat(d3.time.format.utc("%_m/%d"));

	weekdayGrid.scale(xScale)
		.orient("top")
		.ticks(d3.time.day.utc, 1)
		.tickSize(-termCalObj.internalHeight)
		.tickFormat("");

	weekGrid.scale(xScale)
		.orient("top")
		.ticks(d3.time.week.utc, 1)
		.tickSize(-termCalObj.internalHeight)
		.tickFormat("");

	d3.select(".weeks")
		.call(weeks)
		.attr("transform","translate(" + termCalObj.barWidth*.5 + "," + termCalObj.margin.top + ")")
		.selectAll('text')
		.attr("dx", "20")
		.attr("dy", "5")
		.attr("transform", function(d) {return "rotate(-30)";});

	d3.select(".days")
		.call(days)
		.attr("transform","translate(" + termCalObj.barWidth*.5 + "," + (termCalObj.margin.top + termCalObj.height) + ")")
		.selectAll('text')
		.attr("text-anchor", "end")
		.attr("dx", "-20")
		.attr("dy", "-.5em")
		.attr("transform", function(d) {return "rotate(-90)";});

	d3.select(".weekdaygrid")
		.call(weekdayGrid);

	d3.select(".weekgrid")
		.call(weekGrid);

	var yRange = getYRange(calSections.length, termCalObj.barHeight);
	var yDomain = getYDomain(calSections.length);
	var yScale = d3.scale.ordinal()
		.domain(yDomain)
		.range(yRange);

	var sectionBars = d3.select("#internal").selectAll(".section")
		.data(calSections, function(d) {return d.crn;});

	sectionBars.attr("transform", function(d, i) {return "translate(" + 0 + ", " + yScale(i) + ")";});

	sectionBars.enter().append('g')
		.attr("class", "section")
		.attr("transform", function(d, i) {return "translate(0, " + yScale(i) + ")";})
		.attr("fill", function(d,i) {return d.color;})
		.on('keydown', function(data) {
			if((d3.event.keyCode === 13 || d3.event.keyCode === 32) && data.onclick) {
				data.onclick.call(this, data);
			}
			if(d3.event.keyCode === 83 || d3.event.keyCode === 40) { //down
				d3.event.preventDefault();
				var next = data.next;
				if(next === null) {
					next = data.head;
					//message("Bottom of list, jumping to top.")
				}
				if(next !== null) {
					var next = sectionBars.filter(function(d) {return d.crn === next.crn;}).node();
					switchFocus(this, next)
				}
			}
			if(d3.event.keyCode === 87 || d3.event.keyCode === 38) { //up
				d3.event.preventDefault();
				var prev = data.prev;
				if(prev === null) {
					prev = data.tail;
					//message("Top of list, jumping to bottom.")
				}
				if(prev !== null) {
					var prev = sectionBars.filter(function(d) {return d.crn === prev.crn;}).node();
					switchFocus(this, prev)
				}
			}
		})
		.on('mouseover', function(data) {
			d3.event.stopPropagation();
			if (options.mouseover)
				options.mouseover.call(this, data);
			var section = d3.select(this);
			displaySectMessage(section);
		})
		.on('mouseout', function(data) {
			if (options.mouseout)
				options.mouseout.call(this, data);
			if(options.clearMessage) {
				options.clearMessage.call(this);
			}
		})
		.on('click', function(data) {
			if (options.onclick) {
				options.onclick.call(this, data);
			}
		})
		.on('mousedown', function(data) {
			d3.event.preventDefault();
		})
		.on('focusin', function(data) {
			if (options.focusin)
				options.focusin.call(this, data);
			var section = d3.select(this);
			displaySectMessage(section);
			focusTermCalendar();
		})
		.on('focusout', function(data) {
			if (options.mouseout)
				options.mouseout.call(this, data);
			if(options.clearMessage) {
				options.clearMessage.call(this);
			}
			removeCalendarFocus();
		})
		.append("text")
		.text(function(d) {
			var text = d.code + ' ' + d.no + " offered ";
			for(var i = 0; i < d.schedules.length - 1; i++) {
				schedule = d.schedules[i];
				text += expandMptime(schedule.pattern)  + ", " + dateToText(schedule.start_date) + " to " + dateToText(schedule.end_date) + ", ";
			}
			schedule = d.schedules[i];
			if(i > 0) {
				text += "and ";
			}
			text += expandMptime(schedule.pattern)  + " from " + dateToText(schedule.start_date) + " to " + dateToText(schedule.end_date) + ".";
			return  text;
		})
		.attr("font-size", ".01px")
		.attr("class", "sr-only-text");

	sectionBars.exit()
		.remove();

	sectionBars.each(function(d, i) {
		var sect = d3.select(this);
		if(i === 0) {
			sect.attr("tabindex", 0).attr('focusable', true);
		} else {
			sect.attr("tabindex", -1).attr('focusable', false);
		}
	});

	var schedules = sectionBars.selectAll(".schedule")
		.data(function(d) {return d.schedules;})

	schedules.enter().append("g")
		.attr("class", "schedule")
		.append("rect")
			.attr("class", "times")
			.attr("transform", function(d) {return "translate(" + (xScale(d.start_date)+1) + ", " + 0 + ")";})
			.attr("aria-hidden", "true")
			.append("title")
			.text(function(d) {return d.start_date.toUTCString().match(/[\w]+,\s[\d\d]+\s[\w]+\s\d\d\d\d/)[0] + " - " + d.end_date.toUTCString().match(/[\w]+,\s[\d\d]+\s[\w]+\s\d\d\d\d/)[0];});

	schedules.selectAll(".times")
		.attr("height", termCalObj.barHeight-4)
		.attr("width", function(d) {var end = new Date(d.end_date.getTime()).setUTCDate(d.end_date.getUTCDate()+1); return xScale(end)-xScale(d.start_date)-2;})
		.attr("transform", function(d) {return "translate(" + (xScale(d.start_date)+1) + ", " + 0 + ")";});

	schedules.exit().remove();

	return termCalObj;

	/**
	* Create an empty shedule counter.
	*
	* @param {Array} colorGroups Available groups of courses associated with each color.
	* @return zeroed schedule counter.
	*/
	function initScheds(colorGroups) {
		var scheds = {};
		colorGroups.forEach(function (group) {
			scheds[group] = 0;
		});
		return scheds;
	}

	/**
	* Get the domain of sections.
	*
	* @param {Object} sections
	* @return {array} course sections in oder by earliest start time.
	*/
	function initSectionDomain(sections, scheds) {
		var calSections = [];
		sections.forEach(function(section) {
			var head = null;
			var prev = null;
			if(calSections.length) {
				head = calSections[0];
				prev = calSections[calSections.length-1];
			}
			if(prev === null || section.crn !== prev.crn) {
				var nextSect = buildSection(section, scheds);
				if(nextSect) {
					nextSect.next = null;
					nextSect.prev = prev;
					nextSect.head = head;
					nextSect.tail = null;
					if(prev) {
						prev.next = nextSect;
					}
					calSections.push(nextSect);
				}
			}
		});

		calSections.forEach(function(section) {
			section.tail = calSections[calSections.length-1];
		});

		return calSections;

		function buildSection(section, scheds) {
			var nextSect = {};

			// Do not display cancelled or non-meeting sections
			if (section.isCancelled || section.stat === 'C' || section.mpkey == '1')
				return null;

			section.schedcount = getSchedCount(section, scheds);
			section.schedules = [];
			if(section.start_date && section.end_date && section.meets) {
				section.schedules.push(buildSchedule(section.meets, section.start_date, section.end_date));
			}
			if(section.schedules.length === 0) {
				return null;
			}

			return section;
		}

		function getSchedCount(section, scheds) {
			if (typeof scheds[section.schd] != "undefined") {
				return scheds[section.schd]++;
			} else {
				return scheds.other++;
			}
		}

		function buildSchedule(meets, start_date, end_date) {
			var nextSched = {};
			var scheduleDays = getDayValues(meets);
			nextSched.pattern = meets;
			nextSched.start_date = parseDate(start_date);
			nextSched.start_date.setUTCDate(nextSched.start_date.getUTCDate());
			nextSched.end_date = parseDate(end_date);
			nextSched.end_date.setUTCDate(nextSched.end_date.getUTCDate());
			nextSched.dates = [];
			var curDate = parseDate(start_date);
			while(curDate <= nextSched.end_date) {
				if(scheduleDays.indexOf(curDate.getUTCDay()) >= 0) {
					var nextDate = new Date();
					nextDate.setTime(curDate.getTime());
					nextSched.dates.push(nextDate);
				}
				curDate.setUTCDate(curDate.getUTCDate() + 1);
			}
			return  nextSched;
		}

		function getDayValues(pattern) {
			var dayValues = [];
			var map = {"Su":0, "M":1, "T":2, "W":3, "Th":4, "F":5, "Sa":6};
			var days = pattern.match(/(M|T(?!h)|W|Th|F|Sa|Su)/g);
			for(var i = 0; i < days.length; i++) {
				dayValues.push(map[days[i]]);
			}
			return dayValues;
		}
	}

	function diffDays(start, end) {
		if(!start || !end) {
			return 0;
		}
		var MS_PER_DAY = 86400000;
		return Math.floor((end.getTime() - start.getTime())/MS_PER_DAY);
	}

	function initTermCalObj(in_svg, calSections, options, numDays) {
		var retObj = {};
		retObj.margin = {
				top: options.topmargin ? options.topmargin : 20,
				right: options.rightmargin ? options.rightmargin : 10,
				bottom: options.bottommargin ? options.bottommargin : 0,
				left: options.leftmargin ? options.leftmargin  : 0
			};
		retObj.height = options.height ? options.height : 75;
		retObj.width = (options.width ? options.width : 682) - retObj.margin.left - retObj.margin.right;
		retObj.TRANSITION_DURATION = options.transitionDuration ? options.transitionDuration : 1250;
		retObj.EMPH_BAR_OFFSET = 4;
		retObj.scrollWidth = options.scrollWidth ? options.scrollWidth : 7;
		retObj.barHeight = Math.max(10, retObj.height/calSections.length);
		retObj.barWidth = retObj.width/numDays;
		retObj.internalWidth = retObj.barWidth * numDays;
		retObj.internalHeight = retObj.barHeight * calSections.length;
		retObj.svg = in_svg;

		return retObj;
	}

	function getYRange(length, barHeight) {
		var range = [];
		for(var i = 0; i < length; i++) {
			range.push(i*barHeight);
		}
		return range;
	}

	function getYDomain(length) {
		var domain = [];
		for(var i = 0; i < length; i++) {
			domain.push(i);
		}
		return domain;
	}

	function dragmove(d) {
		d.y = getY();
		var internal = d3.select(this);
		internal.attr('class', 'grabbed');
		internal.attr("transform", function() { return "translate(" + 0 + ", " + d.y +")";});
		d3.select(in_svg).select("#yscroll").attr("transform", function() {return "translate(" + 0 + ", " + termCalObj.height*(-d.y/termCalObj.internalHeight) + ")";});

		function getY() {
			if(d3.event.y > 0) {
				return 0;
			} else if(d3.event.y < -termCalObj.internalHeight + termCalObj.height) {
				return -termCalObj.internalHeight + termCalObj.height;
			} else {
				return d3.event.y;
			}
		}
	}

	function barDragmove(d) {
		var y = getY();
		var yscroll = d3.select(this);
		d3.select(in_svg).select("#internal").attr("transform", function() { return "translate(" + 0 + ", " + -termCalObj.internalHeight*(y/termCalObj.height) +")";});
		yscroll.attr("transform", function() {return "translate(" + 0 + ", " + y + ")";});

		function getY() {
			if(d3.event.y < 0) {
				return 0;
			} else if(d3.event.y > termCalObj.height-termCalObj.height*(termCalObj.height/termCalObj.internalHeight)) {
				return termCalObj.height-termCalObj.height*(termCalObj.height/termCalObj.internalHeight)
			} else {
				return d3.event.y;
			}
		}
	}

	/**
	 * Get the minimum date in a set of section
	 *
	 * @param {Object} sections
	 * @return {Object} minimum start date
	 */
	function getMinDate(sections) {
		var minDate = new Date(8640000000000000); //set to maximum possible date value
		sections.forEach(function(section) {
			section.schedules.forEach(function(schedule) {
				var date = parseDate(schedule.start_date);
				if(date < minDate) {
					minDate = date;
				}
			});
		});
		return minDate;
	}

	/**
	 * Get the maximum date in a set of section
	 *
	 * @param {Object} section
	 * @return {Object} maximum start date
	 */
	function getMaxDate(sections) {
		var maxDate = new Date(-8640000000000000); //set to minimum possible date value
		sections.forEach(function(section) {
			section.schedules.forEach(function(schedule) {
				var date = parseDate(schedule.end_date);
				if(date > maxDate) {
					maxDate = date;
				}
			});
		});
		return maxDate;
	}

	/**
	* Parse a date from form YYYY-MM-DD to a Date object
	*
	* @param {string} dateString
	* @return {Date}
	*/
	function parseDate(dateString) {
		var tFormat = d3.time.format.utc("%Y-%m-%d");

		return tFormat.parse(dateString);
	}

	function initColors(scheds) {
		var colors = {};

		for (var i = 0; i < _calColors.groups.length; i++) {
			var group = _calColors.groups[i];

			colors[group] = d3.scale.linear()
				.domain([0, scheds[group] - 1])
				.range(_calColors.colors[i]);
		}
		return colors;
	}

	/**
	* Display section information in the infobar.
	*
	* @param {Object} section Section d3 selection.
	*/
	function displaySectMessage(section) {
		if(options.updateMessage) {
			options.updateMessage.call(this, section.datum().code + " " + section.datum().no + " | " + section.datum().title + " | " + section.datum().instr);
		}
	}

	function getStartHours(schedules) {
		var startHours = [];
		if(schedules) {
			schedules.forEach(function(schedule) {
				var mptime = schedule.pattern.match(/([MTWFShua]+ [0-9:]+[apm]*-[0-9:]+[apm]*)/g);
				if(mptime){
					mptime.forEach(function(time) {
						var parsedTime = time.match(/[MTWFShua]+ ([0-9:]+)([apm]*)-([0-9:]+)([apm]*)/);
						if(parsedTime[1] == null || parsedTime[2] == null) {
							return;
						}
						startHours.push(milTime(parsedTime[1], parsedTime[2]));
					});
				}
			});
		}
		return startHours.sort();
	}
}




/**
 * Draw a Calendar of courses to an SVG
 *
 * @param {Object} in_svg SVG element to draw in
 * @param {Array} courses Array of objects, each representing a course
 * @param {Object} options
 */
function drawCalendar(in_svg, courses, options) {
	if (!_calColors) {
		setupCalendarColors();
	}

	var sections = [];
	var colors = {};
	if (!options)
		options = {};

	var timeinfo = buildCourseInfo(courses, sections, colors);
	var redraw = options.calobj ? true : false;
	var calobj = options.calobj ? options.calobj : initCalobj(in_svg, timeinfo, options);
	calobj.yScale.domain([timeinfo.minstart < 800 ? timeinfo.minstart : 800, timeinfo.maxend > 1700 ? timeinfo.maxend : 1700]);

	if (redraw) {
		var days = ["Mon", "Tue", "Wed", "Thu", "Fri"];
		if (timeinfo.days.Sat)
			days.push("Sat");
		if (timeinfo.days.Sun)
			days.unshift("Sun");
		calobj.xScale.domain(days);
		days.unshift("");
		days.push("");
		calobj.xTickScale.domain(days);

		d3.select(".x.axis").transition().duration(1750).call(calobj.xAxis)
			.selectAll("text")
			.attr("x", -calobj.xScale.rangeBand()/2)
			.attr("aria-hidden", "true")
			.style("text-anchor", "start");

		d3.select(".y.axis").transition().duration(1750).call(calobj.yAxis)
			.selectAll("text")
			.attr("aria-hidden", "true");

		//Indicate calendar changes to non-sighted users
		var selectedSectionData = d3.select(document.activeElement).data()[0];
		if(selectedSectionData != null) {
			d3.select("#calUpdateNote")
				.text("Calendar area has been updated to show sections related to " + selectedSectionData.code + " " + selectedSectionData.no + ".");
		} else {
			d3.select("#calUpdateNote")
				.text("Calendar area has been updated.");
		}

	} else {
		d3.select(".y.axis").call(calobj.yAxis)
			.selectAll("text")
			.attr("aria-hidden", "true");

		d3.select(in_svg)
			.append("text")
			.attr("id", "calUpdateNote")
			.attr("aria-live", "polite")
			.attr("aria-atomic", "true")
			.attr("transform", "translate(0,-100)");
	}
	var barWidth = calobj.xScale.rangeBand() - 1;
	if (options.cartcourses)
		barWidth -= 5;

	calobj.svg.append("clipPath")
	.attr("id", "text-bounds")
	.append("rect")
		.attr("width", (barWidth / timeinfo.maxlanes)-4)
		.attr("height", 775);

	var sectg = calobj.svg.selectAll(".section")
			.data(sections, function(d) { return d.crn });

	var sectionsEnter = sectg.enter().append("g").attr("class", "section")
			.attr("fill", function(d, i) {return d.color;})
			.on('keydown', function(data) {
				if ((d3.event.keyCode === 13 || d3.event.keyCode === 32) && data.onclick) {
					data.onclick.call(this, data);
				}
				if(d3.event.keyCode === 83 || d3.event.keyCode === 40) { //down
					d3.event.preventDefault();
					var next = data.next;
					if(next === null) {
						next = data.head;
						//message("Bottom of list, jumping to top.")
					}
					if(next !== null) {
						var next = sectg.filter(function(d) {return d.crn === next.crn;}).node();
						switchFocus(this, next)
					}
				}
				if(d3.event.keyCode === 87 || d3.event.keyCode === 38) { //up
					d3.event.preventDefault();
					var prev = data.prev;
					if(prev === null) {
						prev = data.tail;
						//message("Top of list, jumping to bottom.")
					}
					if(prev !== null) {
						var prev = sectg.filter(function(d) {return d.crn === prev.crn;}).node();
						switchFocus(this, prev)
					}
				}
			})
			.on('mouseover', function(data) {
				var section = d3.select(this)
					.attr('class', 'section active');
				displaySectMessage(section);
				if (data.mouseover)
					data.mouseover.call(this, data);

			})
			.on('mouseout', function(data) {
				if (data.mouseout)
					data.mouseout.call(this, data);
				if(options.clearMessage) {
					options.clearMessage.call(this);
				}
			})
			.on('click', function(data) {
				if (data.onclick) {
					data.onclick.call(this, data);
				}
			})
			.on('focusin', function(data) {
				var section = d3.select(this)
					.attr('class', 'section active');
					displaySectMessage(section);
				if (data.mouseover)
					data.mouseover.call(this, data);
				focusCalendar();
			})
			.on('focusout', function(data) {
				if (data.mouseout)
					data.mouseout.call(this, data);
				if(options.clearMessage) {
					options.clearMessage.call(this);
				}
				removeCalendarFocus();
			})
			.on("touchstart", function(data) {
				//disable context menu (copy, paste, etc.) when there is a long press.
				window.oncontextmenu = function () {return false;}
				touchMove();
			})
			.on("touchmove", function() {
				touchMove();
			})
			.on("touchend", function () {
				touchEnd();
				//re-enable context menu (copy, paste, etc.) when there is a long press.
				window.oncontextmenu = function () {return true;}
			});

	sectionsEnter.each(function(d) {
		if(d.times.length) {
			d3.select(this).append("text")
				.text(function(d) {
					return d.code + ' ' + d.no + ' ' + "offered: " + expandDays(d.meets) + ".";
				})
				.attr("font-size", ".01px")
				.attr("x", function(d) {
					if(d.times.length){
						return xLoc(d.times[0], barWidth, timeinfo.maxlanes)+1;
					}
				})
				.attr("y", function(d) { return calobj.yScale(d.times[0].start)+10; });
		}
	});

	sectg.each(function(d, i) {
		var sect = d3.select(this);
		if(i === 0) {
			sect.attr("tabindex", 0).attr('focusable', true);
		} else {
			sect.attr("tabindex", -1).attr('focusable', false);
		}
	});

	var bars = sectg.selectAll(".time")
			.data(function(d) { return d.times; }, function(d) { return d.key })
			.attr("aria-hidden", "true");;

	var groups = bars.enter().append("g")
		.attr("class", "time")
		.attr("transform", function(d, i) {
			return "translate(" + calobj.xScale(d.day) + ",0)"; });

	groups.append("rect")
		.attr("class", "timeblock");

	if (options.labels) {
		bars.filter(function(d) {
				return !(d.sect.iscart);
			})
			.append("text")
			.attr("transform", function(d, i) {
				return "translate(" + (xLoc(d, barWidth, timeinfo.maxlanes)+3) + ",10)";
			})
			.attr("style", function(d) {
				fill = contrast(d.color);
				return "fill:" + fill;
			})
			.attr("y", function(d) { return calobj.yScale(d.start); })
			.attr("clip-path", "url(#text-bounds)")
			.attr("pointer-events", "none")
			.text(function(d) {
				return d.sect.code + ' ' + d.sect.no;
			});

		bars.filter(function(d) {
				return !(d.sect.iscart);
			})
			.append("text")
			.attr("transform", function(d, i) {
				return "translate(" + (xLoc(d, barWidth, timeinfo.maxlanes)+3) + ",20)";
			})
			.attr("style", function(d) {
				fill = contrast(d.color);
				return "fill:" + fill;
			})
			.attr("y", function(d) { return calobj.yScale(d.start); })
			.attr("clip-path", "url(#text-bounds)")
			.attr("pointer-events", "none")
			.text(function(d) { return d.sect.title; });
	}

	bars.transition().duration(1750)
		.attr("transform", function(d, i) {
			return "translate(" +
					calobj.xScale(d.day) + ",0)"; })
		.select("rect")
			.attr("width", function(d) {
				return d.sect.iscart ? 5 : barWidth / timeinfo.maxlanes; })
			.attr("x", function(d) {
				return xLoc(d, barWidth, timeinfo.maxlanes)+1 })
			.attr("y", function(d) { return calobj.yScale(d.start); })
			.attr("height", function(d) {
				return calobj.yScale(d.end) - calobj.yScale(d.start); });

	sectg.exit().transition().duration(1750)
		.style("fill-opacity", 0)
		.remove();

	bars.attr("width", function(d) { return barWidth / timeinfo.maxlanes; });

	var ua = window.navigator.userAgent;
	var msie = ua.indexOf("MSIE ");
	if (!(msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))) { // Check if not running on ie. removing d3 elements and appending them to the dom not supported on ie.
		 updateDomOrder(sectg);
	}

	return calobj;

	/**
	* Builds data in the times, sections, and colors parameter based on courses
	*
	* @param {Array} courses Array of objects, each representing a course
	* @param {Array} times
	* @param {Array} sections
	* @param {Array} colors
	* @returns {Object} time and date maximums and minimums
	*/
	function buildCourseInfo(courses, sections, colors) {
		var times = [];
		var scheds = {};

		_calColors.groups.forEach(function (group) {
			scheds[group] = 0;
		});

		courses.forEach(function(sect) {
			if (!sect.schd)
				sect.schd = sect.no[0];
			if (sect.schd in scheds) {
				sect.schedcount = scheds[sect.schd]++;
			} else {
				sect.schedcount = scheds.other++;
			}
			// Do not display cancelled or non-meeting sections
			if (sect.isCancelled || sect.stat === 'C' || sect.mpkey == '1')
				return;
			//remove duplicates
			if(sections.length > 0 && sect.crn === sections[sections.length-1].crn)
				return;
			sections.push(sect);
			sect.times = [];

			sect.meets.split(/\; /g).forEach(function(mp, index) {
				sect.times = sect.times.concat(flattenMP(mp, sect.crn, index));
			});
			sect.times.forEach(function(time) {
				time.sect = sect;
			});
			times = times.concat(sect.times);
			if (!sect.iscart)
				sect.onclick = options.sectionclick;
			sect.mouseover = options.mouseover;
			sect.mouseout = options.mouseout;
		});

		for(var i = 0; i < sections.length; i++) {
			var sect = sections[i];
			sect.head = sections[0];
			sect.tail = sections[sections.length-1];

			if(i === 0) {
				sect.prev = sect.tail;
			} else {
				sect.prev = sections[i-1];
			}

			if(i === sections.length-1) {
				sect.next = sect.head;
			} else {
				sect.next = sections[i+1];
			}
		}

		for (var i = 0; i < _calColors.groups.length; i++) {
			var group = _calColors.groups[i];

			colors[group] = d3.scale.linear()
				.domain([0, scheds[group] - 1])
				.range(_calColors.colors[i]);
		}

		return calcTimes(times);
	}

	/**
	* Builds and intitial calendar object with external parts of the graphic defined
	*
	* @param {Object} in_svg SVG element to draw in
	* @param {Object} timeinfo time and date maximums and minimums
	* @param {Object} options
	* @returns {Object} External calendar graphic parts and data(scales, axes, svg, etc.)
	*/
	function initCalobj(in_svg, timeinfo, options) {
		var retobj = {};
		var margin = {
				top: options.topmargin ? options.topmargin : 20,
				right: options.rightmargin ? options.rightmargin : 30,
				bottom: options.bottommargin ? options.bottommargin: 30,
				left: options.leftmargin ? options.leftmargin : 40
			};

		retobj.height = (options.height ? options.height : 500) -
				margin.top - margin.bottom,
		retobj.width = (options.width ? options.width : 960) -
				margin.left - margin.right,

		retobj.svg = d3.select(in_svg)
			.attr("width", retobj.width + margin.left + margin.right)
			.attr("height", retobj.height + margin.top + margin.bottom)
			.attr("lang", "en")
			.on("touchmove", function() {
				touchMove();
			})
			.on("touchend", function() {
				touchEnd();
			})
			.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		// Y scale/axis
		retobj.yScale = d3.scale.linear()
			.domain([800, 1700]).range([0, retobj.height]);

		retobj.yAxis = d3.svg.axis();
		retobj.yAxis.scale(retobj.yScale)
			.tickSize(-retobj.width)
			.tickFormat(formatTime)
			.orient("left");
		var gy = retobj.svg.append("g")
			.attr("class", "y axis")
			.call(retobj.yAxis);
		gy.selectAll("text")
			.attr("x", -25)
			.style("text-anchor", "start")
			.attr("dy", 5)
			.attr("aria-hidden", "true");

		// X scale/axis
		var days = ["Mon", "Tue", "Wed", "Thu", "Fri"];
		if (timeinfo.days.Sat)
			days.push("Sat");
		if (timeinfo.days.Sun)
			days.unshift("Sun");
		retobj.xScale = d3.scale.ordinal()
			.domain(days)
			.rangeBands([0,retobj.width]);

		// Ticks are done with rangePoints instead of rangeBands to get open/close
		days.push("");
		days.unshift("");
		retobj.xTickScale = d3.scale.ordinal()
			.domain(days)
			.rangePoints([0,retobj.width]);

		retobj.xAxis = d3.svg.axis()
			.scale(retobj.xTickScale)
			.tickSize(-retobj.height)
			.orient("top");

		retobj.svg.append("g")
			.attr("class", "x axis")
			.call(retobj.xAxis)
			.selectAll("text")
			.attr("x", -retobj.xScale.rangeBand()/2)
			.attr("aria-hidden", "true")
			.style("text-anchor", "start");

		retobj.barWidth = retobj.xScale.rangeBand() - 1;

		return retobj;
	}

	/**
	* Display section information in the infobar.
	*
	* @param {Object} section Section d3 selection.
	*/
	function displaySectMessage(section) {
		if(options.updateMessage) {
			options.updateMessage.call(this, section.datum().code + " " + section.datum().no + " | " + section.datum().title + " | " + section.datum().instr);
		}
	}

	/**
	* Emphasize the section being touched on a touch move event.
	*/
	function touchMove() {
		var touch = d3.event.touches[0];
		var el = document.elementFromPoint(touch.clientX, touch.clientY);
		if(el && "timeblock" === d3.select(el).attr("class")) {
			d3.select(in_svg).selectAll('.section.active').attr("class", "section");
			var selection = d3.select(el.parentNode.parentNode);
			if("section" === selection.attr("class")) {
				selection.attr('class', 'section active');
				displaySectMessage(selection);
				if(selection.datum()) {
					d3.select("#calUpdateNote")
						.text(selection.datum().code + ' ' + selection.datum().no + ' ' + "offered: " + expandDays(selection.datum().meets));
				}
			}
		} else {
			if(options.clearMessage) {
				options.clearMessage.call(this);
			}
			d3.select(in_svg).selectAll('.section.active').attr("class", "section");
		}
	}

	/**
	* Select the section being touched on a touch move event.
	*/
	function touchEnd() {
		d3.selectAll('.section.active').attr("class", "section");
		var touch = d3.event.changedTouches[0];
		var el = document.elementFromPoint(touch.clientX, touch.clientY);
		if(el && "timeblock" === d3.select(el).attr("class")) {
			var selection = d3.select(el.parentNode.parentNode);
			if("section" === selection.attr("class") || "section active" === selection.attr("class")) {
				if (selection.datum() && selection.datum().onclick) {
					d3.event.preventDefault();
					d3.event.stopPropagation();
					selection.datum().onclick.call(selection, selection.datum());
					d3.select("#calUpdateNote")
						.text(selection.datum().code + ' ' + selection.datum().no + ' ' + "offered: " + expandDays(selection.datum().meets) + ".");
				}
				selection.attr('class', 'section');
			}
		}
		if(options.clearMessage) {
			options.clearMessage.call(this);
		}
	}

	/**
	* Calculates the x location for an element in a bar
	*
	* @param {Object} meet a meeting
	* @param {number} barWidth
	* @param {number} maxlanes maximum number of lanes in a bar
	*/
	function xLoc(meet, barWidth, maxlanes) {
		function xLane(lane, count) {
			var mid = Math.ceil(count / 2);
			if (lane % 2)
				return mid - Math.ceil((lane - 1) / 2);
			else
				return mid + Math.ceil((lane - 1) / 2);
		}
		if (meet.sect.iscart)
			return 0;
		return ((xLane(meet.lane, maxlanes)-1) * barWidth / maxlanes) +
			(options.cartcourses ? 5 : 0);
	}

	/**
	* Calcualte limits of a list of times
	*
	* @param {Array} times An arry of event times
	* @returns {Object} time and date maximums and minimums
	*/
	function calcTimes(times) {
		// sort the times (NOTE: order of the days is unimportant)
		times.sort(function(a,b) {
			if (a.day != b.day)
				return a.day < b.day ? -1 : 1;
			if (a.start != b.start)
				return a.start - b.start;
			return a.end - b.end;
		});
		var maxlanes = 0;
		var activelanes = [];
		for (var i=0; i < times.length; i++) {
			// Cart courses get their own lane
			if (times[i].sect.iscart)
				continue;
			var curr = times[i];
			if (activelanes.length && curr.day != activelanes[0].day)
				activelanes = [];
			var taken_lanes = {};
			for (var j=0; j < activelanes.length; j++) {
				if (activelanes[j].end <= curr.start) {
					activelanes.splice(j--, 1);
					continue;
				}
				if (!activelanes[j].lane)
					activelanes[j].lane = 1;
				taken_lanes[activelanes[j].lane] = true;
			}
			curr.lane = 1;
			if (activelanes.length) {
				// Assign the lowest unused lane number
				while (taken_lanes[curr.lane])
					curr.lane++;
			}
			activelanes.push(curr);
			curr.totlanes = activelanes.length;
			curr.overlaps = [];
			activelanes.forEach(function(lane) {
				if (lane.key != curr.key)
					curr.overlaps.push(lane);
				if (!lane.totlanes || lane.totlanes < activelanes.length) {
					lane.totlanes = activelanes.length;
					/* When you have times where a lane is assinged as "3 of 5" and
						becomes "3 of 7", the starting point is incorrectly far to the
						left; all overlapping times (and the times overlapping those,
						and so on) need to now be 7 */
					addLane(lane.overlaps, activelanes.length);
				}
			});
		}
		var ret = { maxlanes:1, minstart:2399, maxend: 0, days:{} };
		times.forEach(function(time) {
			if (time.lane && time.lane > ret.maxlanes)
				ret.maxlanes = time.lane;
			if (time.start < ret.minstart)
				ret.minstart = time.start;
			if (time.end > ret.maxend)
				ret.maxend = time.end;
			ret.days[time.day] = true;
		});
		return ret;

		function addLane(overlaps, totlanes) {
			overlaps.forEach(function(lane) {
				if (lane.totlanes < totlanes) {
					lane.totlanes = activelanes.length;
					addLane(lane.overlaps, totlanes);
				}
			});
		}
	}
}

function emphasizeCalendar(svg, crn) {
	d3.select(svg).selectAll('.section').each(function(d) {
		var section = d3.select(this);
		if(section.datum().crn === crn) {
			section.attr("class", "section active");
		}
	});
};

function demphasizeCalendar(svg) {
	d3.select(svg).selectAll('.section').attr("class", "section");
}

function emphasizeTermCalendar(svg, crn) {
	d3.select(svg).selectAll('.section').each(function(d) {
		var section = d3.select(this);
		if(section.datum().crn === crn) {
			section.attr("class", "section active");
		}
	});
}

function demphasizeTermCalendar(svg) {
	d3.select(svg).selectAll('.section').attr("class", "section");
}

function setTermCalViewing(termCalObj, crn, transitionDuration) {
	var y = null;

	d3.select(termCalObj.svg).selectAll('.section').each(function(d) {
		var section = d3.select(this);
		if(section.datum().crn === crn) {
			y = d3.transform(section.attr("transform")).translate[1];
		}
	});

	if(y !== null && termCalObj) {
		var changeY = 0 - y + (termCalObj.EMPH_BAR_OFFSET * termCalObj.barHeight);
		if(changeY > 0) {
			changeY = 0;
		}
		if(changeY < -termCalObj.internalHeight + termCalObj.height) {
			changeY = -termCalObj.internalHeight + termCalObj.height;
		}
		d3.select(termCalObj.svg).selectAll('#internal').transition().duration(transitionDuration)
			.attr("transform", function() { return "translate(" + 0 + ", " + changeY + ")";});
		d3.select(termCalObj.svg).select("#yscroll").transition().duration(transitionDuration)
			.attr("transform", function() {return "translate(" + 0 + ", " + termCalObj.height*(-changeY/termCalObj.internalHeight) + ")";});
	}
}

function stopTermCalViewing(termCalObj) {
	if(termCalObj) {
		var internal = d3.select(termCalObj.svg).selectAll('#internal');
		var yscroll = d3.select(termCalObj.svg).select("#yscroll");
		var internalY = d3.transform(internal.attr("transform")).translate[1];
		var yscrollY = d3.transform(yscroll.attr("transform")).translate[1];
		internal.transition().duration(0)
			.attr("transform", function() { return "translate(" + 0 + ", " + internalY + ")";});
		yscroll.transition().duration(0)
			.attr("transform", function() {return "translate(" + 0 + ", " + yscrollY + ")";});
	}
}

function resetTermCalViewing(termCalObj) {
	if(termCalObj) {
		var internal = d3.select(termCalObj.svg).selectAll('#internal');
		var yscroll = d3.select(termCalObj.svg).select("#yscroll");
		internal.transition().duration(0).attr("transform", function() { return "translate(" + 0 + ", " + 0 + ")";});
		yscroll.transition().duration(0).attr("transform", function() {return "translate(" + 0 + ", " + 0 + ")";});
	}
}

function focusCalendar() {
	d3.select('.calfocus').attr("class", "");
	d3.select('#calendar').attr("class", "calfocus");
}

function focusTermCalendar() {
	d3.select('.calfocus').attr("class", "");
	d3.select('#termcalendar').attr("class", "calfocus");
}

function removeCalendarFocus() {
	d3.select('.calfocus').attr("class", "");
}

function prepareSections(sections, options) {
	if (!options)
		options = {};

	if (!_calColors) {
		setupCalendarColors();
	}

	if (options.cartcourses) {
		options.cartcourses = JSON.parse(JSON.stringify(options.cartcourses));
		options.cartcourses.forEach(function(crse) {
			crse.iscart = true;
			crse.crn += '.crt';
		});
		sections = sections.concat(options.cartcourses);
	}

	var scheds = {};
	var colors = {};

	_calColors.groups.forEach(function(group) {
		scheds[group] = 0;
	});

	sections.forEach(function(sect) {
		if (!sect.schd)
			sect.schd = sect.no[0];
		if (sect.schd in scheds) {
			sect.schedcount = scheds[sect.schd]++;
		} else {
			sect.schedcount = scheds.other++;
		}
	});

	for (var i = 0; i < _calColors.groups.length; i++) {
		var group = _calColors.groups[i];

		colors[group] = d3.scale.linear()
			.domain([0, scheds[group] - 1])
			.range(_calColors.colors[i]);
	}

	sections.forEach(function(sect) {
		if(sect.iscart) {
			sect.color = "red";
		} else if(colors[sect.schd]) {
			sect.color = colors[sect.schd](sect.schedcount);
		} else {
			sect.color = colors.other(sect.schedcount);
		}
	});

	return sections;
}

var stache = (function unpack(modules, global) {
	var __pack_require__ = global.require;

	if (typeof __pack_require__ !== 'function') {
		__pack_require__ = function __pack_require__(moduleId) {
			if (__pack_require__.installed[moduleId]) {
				return __pack_require__.installed[moduleId].exports;
			}

			if (!__pack_require__.modules[moduleId]) {
				throw new Error('Could not load module "' + moduleId + '"');
			}

			var module = __pack_require__.installed[moduleId] = {
				exports: {},
				id: moduleId,
				loaded: false
			};

			__pack_require__.modules[moduleId].call(
				module.exports,
				module,
				module.exports,
				global,
				__pack_require__
			);

			module.loaded = true;

			return module.exports;
		};

		__pack_require__.modules = {};
		__pack_require__.installed = {};

		global.require = __pack_require__;
	}

	for (var moduleId in modules) {
		__pack_require__.modules[moduleId] = modules[moduleId];
	}

	return __pack_require__('stache/compiler');
})
({'stache/token': function(module, exports, global, __pack_require__) {
'use strict';
var Token = (function () {
    function Token(line, column) {
        this.type = null;
        this.value = null;
        this.line = line;
        this.column = column;
    }
    Token.prototype.setToken = function (type, value) {
        this.type = type;
        this.value = value;
        return this;
    };
    return Token;
})();
exports.Token = Token;

},
'stache/token-collection': function(module, exports, global, __pack_require__) {
'use strict';
var TokenCollection = (function () {
    function TokenCollection(tokens) {
        this.index = 0;
        this.lastIndex = tokens.length - 1;
        this.length = tokens.length;
        this.tokens = tokens;
    }
    TokenCollection.prototype.isFinished = function () {
        return this.index > this.lastIndex;
    };
    TokenCollection.prototype.current = function () {
        if (this.isFinished()) {
            return null;
        }
        return this.tokens[this.index];
    };
    TokenCollection.prototype.next = function () {
        if (this.index < this.lastIndex) {
            return this.tokens[this.index + 1];
        }
        return null;
    };
    TokenCollection.prototype.previous = function () {
        if (this.index > 0) {
            return this.tokens[this.index - 1];
        }
        return null;
    };
    TokenCollection.prototype.forward = function () {
        this.index++;
    };
    TokenCollection.prototype.back = function () {
        this.index = Math.max(this.index - 1, 0);
    };
    return TokenCollection;
})();
exports.TokenCollection = TokenCollection;

},
'stache/tokenizer': function(module, exports, global, __pack_require__) {
'use strict';
var token_1 = __pack_require__('stache/token');
exports.CHAR_NO_TRIM = '+';
exports.CHAR_LEFT_BRACKET = '[';
exports.CHAR_RIGHT_BRACKET = ']';
exports.CHAR_DOT = '.';
exports.CHAR_END_OF_LINE = '\n';
exports.CHAR_ESCAPE = '\\';
exports.CHAR_START = '{';
exports.CHARS_INTEGER = '0123456789';
exports.CHARS_OPERATOR = '!<>=.%*+-/&^|~';
exports.CHARS_SPECIAL = '()[]{}%*-+/#,:|.<>=!&';
exports.CHARS_WHITESPACE = ' \r\t\n';
exports.BLOCK_START = '{%';
exports.BLOCK_END = '%}';
exports.BLOCK_START_NO_TRIM = '{%+';
exports.BLOCK_END_NO_TRIM = '+%}';
exports.VARIABLE_START = '{{';
exports.VARIABLE_END = '}}';
exports.COMMENT_START = '{#';
exports.COMMENT_END = '#}';
exports.TOKEN_STRING = 'string';
exports.TOKEN_WHITESPACE = 'whitespace';
exports.TOKEN_DATA = 'data';
exports.TOKEN_BLOCK_START = 'block-start';
exports.TOKEN_BLOCK_END = 'block-end';
exports.TOKEN_VARIABLE_START = 'variable-start';
exports.TOKEN_VARIABLE_END = 'variable-end';
exports.TOKEN_COMMENT = 'comment';
exports.TOKEN_LEFT_PAREN = 'left-paren';
exports.TOKEN_RIGHT_PAREN = 'right-paren';
exports.TOKEN_LEFT_BRACKET = 'left-bracket';
exports.TOKEN_RIGHT_BRACKET = 'right-bracket';
exports.TOKEN_LEFT_CURLY = 'left-curly';
exports.TOKEN_RIGHT_CURLY = 'right-curly';
exports.TOKEN_OPERATOR = 'operator';
exports.TOKEN_COMMA = 'comma';
exports.TOKEN_DOT = 'dot';
exports.TOKEN_COLON = 'colon';
exports.TOKEN_PIPE = 'pipe';
exports.TOKEN_INTEGER = 'integer';
exports.TOKEN_FLOAT = 'float';
exports.TOKEN_BOOLEAN = 'boolean';
exports.TOKEN_SYMBOL = 'symbol';
exports.TOKEN_NULL = 'null';
exports.REGEX_INTEGER = /^[-+]?[0-9]+$/;
var Tokenizer = (function () {
    function Tokenizer(str) {
        this.str = str;
        this.index = 0;
        this.length = str.length;
        this.line = 1;
        this.column = 0;
        this.inCode = false;
        this.inVariable = false;
    }
    Tokenizer.isSpecial = function (char) {
        switch (char) {
            case '(':
            case ')':
            case '[':
            case ']':
            case '{':
            case '}':
            case '%':
            case '*':
            case '-':
            case '+':
            case '/':
            case '#':
            case ',':
            case ':':
            case '|':
            case '.':
            case '<':
            case '>':
            case '=':
            case '!':
            case '&':
                return true;
        }
        return false;
    };
    Tokenizer.prototype.nextToken = function () {
        if (this.isFinished()) {
            return null;
        }
        var cur = this.current();
        var tok = new token_1.Token(this.line, this.column);
        var slice;
        if (this.inCode) {
            if (cur === '"' || cur === '\'') {
                return tok.setToken(exports.TOKEN_STRING, this._extractString(cur));
            }
            else if ((slice = this._extractChars(exports.CHARS_WHITESPACE)) !== null) {
                return tok.setToken(exports.TOKEN_WHITESPACE, slice);
            }
            else if ((slice = this._extract(exports.BLOCK_END)) !== null) {
                this.inCode = false;
                return tok.setToken(exports.TOKEN_BLOCK_END, slice);
            }
            else if ((slice = this._extract(exports.BLOCK_END_NO_TRIM)) !== null) {
                this.inCode = false;
                return tok.setToken(exports.TOKEN_BLOCK_END, slice);
            }
            else if ((slice = this._extract(exports.VARIABLE_END)) !== null) {
                this.inCode = false;
                this.inVariable = false;
                return tok.setToken(exports.TOKEN_VARIABLE_END, slice);
            }
            else if (Tokenizer.isSpecial(cur)) {
                var type = null;
                switch (cur) {
                    case '(':
                        type = exports.TOKEN_LEFT_PAREN;
                        break;
                    case ')':
                        type = exports.TOKEN_RIGHT_PAREN;
                        break;
                    case '[':
                        type = exports.TOKEN_LEFT_BRACKET;
                        break;
                    case ']':
                        type = exports.TOKEN_RIGHT_BRACKET;
                        break;
                    case '{':
                        type = exports.TOKEN_LEFT_CURLY;
                        break;
                    case '}':
                        type = exports.TOKEN_RIGHT_CURLY;
                        break;
                    case ',':
                        type = exports.TOKEN_COMMA;
                        break;
                    case ':':
                        type = exports.TOKEN_COLON;
                        break;
                    case '.':
                        type = exports.TOKEN_DOT;
                        break;
                    case '|':
                        type = this.inVariable ? exports.TOKEN_PIPE : exports.TOKEN_OPERATOR;
                        break;
                    default:
                        type = exports.TOKEN_OPERATOR;
                }
                if (type === exports.TOKEN_OPERATOR) {
                    cur = this._extractChars(exports.CHARS_OPERATOR);
                }
                else {
                    this.forward();
                }
                return tok.setToken(type, cur);
            }
            else {
                slice = this._extractNotChars(exports.CHARS_WHITESPACE + exports.CHARS_SPECIAL);
                switch (slice) {
                    case 'true':
                    case 'false':
                        return tok.setToken(exports.TOKEN_BOOLEAN, slice);
                    case 'null':
                        return tok.setToken(exports.TOKEN_NULL, slice);
                }
                if (exports.REGEX_INTEGER.exec(slice) !== null) {
                    if (this.current() === exports.CHAR_DOT) {
                        this.forward();
                        slice += exports.CHAR_DOT + this._extractChars(exports.CHARS_INTEGER);
                        return tok.setToken(exports.TOKEN_FLOAT, slice);
                    }
                    return tok.setToken(exports.TOKEN_INTEGER, slice);
                }
                return tok.setToken(exports.TOKEN_SYMBOL, slice);
            }
        }
        else {
            if ((slice = this._extract(exports.BLOCK_START_NO_TRIM)) !== null) {
                this.inCode = true;
                return tok.setToken(exports.TOKEN_BLOCK_START, slice);
            }
            else if ((slice = this._extract(exports.BLOCK_START)) !== null) {
                this.inCode = true;
                return tok.setToken(exports.TOKEN_BLOCK_START, slice);
            }
            else if ((slice = this._extract(exports.VARIABLE_START)) !== null) {
                this.inCode = true;
                this.inVariable = true;
                return tok.setToken(exports.TOKEN_VARIABLE_START, slice);
            }
            else if (this._extract(exports.COMMENT_START) !== null) {
                var comment = this._extractUntil(exports.COMMENT_END);
                this._extract(exports.COMMENT_END);
                return tok.setToken(exports.TOKEN_COMMENT, exports.COMMENT_START + comment + exports.COMMENT_END);
            }
            else {
                var data = '';
                var dataPiece;
                while ((dataPiece = this._extractNotChars(exports.CHAR_START)) !== null) {
                    data += dataPiece;
                    var isStartToken = this.matches(exports.BLOCK_START) ||
                        this.matches(exports.VARIABLE_START) ||
                        this.matches(exports.COMMENT_START);
                    if (isStartToken) {
                        break;
                    }
                    else {
                        data += this.current();
                        this.forward();
                    }
                }
                return tok.setToken(exports.TOKEN_DATA, data);
            }
        }
    };
    Tokenizer.prototype.matches = function (str) {
        if (this.index + str.length > this.length) {
            return false;
        }
        var slice = this.str.slice(this.index, this.index + str.length);
        return slice === str;
    };
    Tokenizer.prototype._extract = function (str) {
        var slice = this.str.slice(this.index, this.index + str.length);
        if (slice === str) {
            this.index += str.length;
            this.column += str.length;
            return str;
        }
        return null;
    };
    Tokenizer.prototype._extractChars = function (chars) {
        var extracted = null;
        while (chars.indexOf(this.current()) !== -1) {
            if (extracted === null) {
                extracted = '';
            }
            extracted += this.current();
            this.forward();
        }
        return extracted;
    };
    Tokenizer.prototype._extractNotChars = function (chars) {
        var extracted = null;
        while (chars.indexOf(this.current()) === -1) {
            if (extracted === null) {
                extracted = '';
            }
            extracted += this.current();
            this.forward();
        }
        return extracted;
    };
    Tokenizer.prototype._extractUntil = function (str) {
        var extracted = '';
        while (!this.matches(str)) {
            extracted += this.current();
            this.forward();
            if (this.isFinished()) {
                throw new Error('Unexpected end of input');
            }
        }
        return extracted;
    };
    Tokenizer.prototype._extractString = function (delimiter) {
        this.forward();
        var str = '';
        var cur;
        while ((cur = this.current()) !== delimiter) {
            str += cur;
            if (cur === exports.CHAR_ESCAPE) {
                this.forward();
                str += this.current();
            }
            this.forward();
            if (this.isFinished()) {
                throw new Error('Unexpected end of input');
            }
        }
        this.forward();
        return delimiter + str + delimiter;
    };
    Tokenizer.prototype.isFinished = function () {
        return this.index >= this.length;
    };
    Tokenizer.prototype.forward = function (n) {
        if (n) {
            for (var i = 0; i < n; i++) {
                this.forward();
            }
        }
        else {
            this.index++;
            if (this.previous() === exports.CHAR_END_OF_LINE) {
                this.line++;
                this.column = 0;
            }
            else {
                this.column++;
            }
        }
    };
    Tokenizer.prototype.current = function () {
        return this.str.charAt(this.index);
    };
    Tokenizer.prototype.previous = function () {
        return this.str.charAt(this.index - 1);
    };
    return Tokenizer;
})();
exports.Tokenizer = Tokenizer;

},
'stache/runtime': function(module, exports, global, __pack_require__) {
'use strict';
global.stacheCompiled = global.stacheCompiled || {};
exports.FILTER_RANGE = 'range';
exports.FILTER_RAW = 'raw';
exports.FILTER_SAFE = 'safe';
exports.FILTER_ESCHTML = 'eschtml';
exports.FILTER_ESCATTR = 'escattr';
exports.FILTER_ESCXML = 'escxml';
exports.FILTER_ESCURL = 'escurl';
exports.FILTER_ESCCSS = 'esccss';
exports.FILTER_PERCENT = 'percent';
exports.FILTER_DEFAULT = 'default';
var REGEX_BAD_CHARS = /[&<>"'`]/g;
var REPLACEMENTS = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    '\'': '&#x27;',
    '`': '&#x60;'
};
function replaceChar(char) {
    return REPLACEMENTS[char] || char;
}
function defaultValue(val, def) {
    if (typeof val === 'undefined' || val === '' || val === null) {
        return def;
    }
    return val;
}
function percent(part, whole, precision) {
    precision = parseInt(precision, 10);
    if (isNaN(precision)) {
        precision = 1;
    }
    part = parseFloat(part);
    whole = parseFloat(whole);
    if (isNaN(whole) || isNaN(part) || whole === 0) {
        return '0%';
    }
    var pct = (part / whole) * 100;
    return pct.toFixed(precision).toString() + '%';
}
function escHtml(str) {
    return typeof str === 'string' ? str.replace(REGEX_BAD_CHARS, replaceChar) : str;
}
function escAttr(str) {
    return typeof str === 'string' ? str.replace(REGEX_BAD_CHARS, replaceChar) : str;
}
function escUrl(str) {
    return str;
}
function escXml(str) {
    return typeof str === 'string' ? str.replace(REGEX_BAD_CHARS, replaceChar) : str;
}
function escCss(str) {
    return str;
}
var runtime = {
    lookup: function lookup() {
        var value = arguments[0];
        for (var i = 1; i < arguments.length; i++) {
            if (value && typeof value === 'object') {
                value = value[arguments[i]];
            }
            else {
                value = void 0;
                break;
            }
        }
        return typeof value === 'undefined' ? '' : value;
    },
    Iterable: function Iterable(obj) {
        var idx = 0;
        if (arguments.length === 2) {
            var range = [];
            for (var i = arguments[0]; i <= arguments[1]; i++) {
                range.push(i);
            }
            obj = range;
        }
        if (Array.isArray(obj)) {
            this.length = obj.length;
            this.end = this.length - 1;
            this.next = function next() {
                this.first = idx === 0;
                this.last = idx === this.end;
                if (idx > this.end) {
                    return null;
                }
                var val = obj[idx];
                idx++;
                return val;
            };
            this.index = function index() {
                return idx - 1;
            };
        }
        else if (Object.prototype.toString.call(obj) === '[object Object]') {
            this.keys = Object.keys(obj);
            this.length = this.keys.length;
            this.end = this.length - 1;
            this.next = function next() {
                this.first = idx === 0;
                this.last = idx === this.end;
                if (idx > this.end) {
                    return null;
                }
                var val = obj[this.keys[idx]];
                idx++;
                return val;
            };
            this.index = function index() {
                return this.keys[idx - 1];
            };
        }
        else {
            this.next = function next() { return null; };
            this.index = function index() { return idx; };
            this.first = false;
            this.last = false;
            this.length = 0;
        }
    },
    filter: function addFilter(name, func) {
        this.filters[name] = func;
    },
    filters: (_a = {},
        _a[exports.FILTER_DEFAULT] = defaultValue,
        _a[exports.FILTER_PERCENT] = percent,
        _a[exports.FILTER_SAFE] = escHtml,
        _a[exports.FILTER_ESCHTML] = escHtml,
        _a[exports.FILTER_ESCATTR] = escAttr,
        _a[exports.FILTER_ESCURL] = escUrl,
        _a[exports.FILTER_ESCXML] = escXml,
        _a[exports.FILTER_ESCCSS] = escCss,
        _a
    )
};
function filter(name, func) {
    runtime.filter(name, func);
}
exports.filter = filter;
function register(name, func) {
    global.stacheCompiled[name] = func;
}
exports.register = register;
function render(name, data) {
    return global.stacheCompiled[name](data, runtime);
}
exports.render = render;
var _a;

},
'stache/compiler': function(module, exports, global, __pack_require__) {
'use strict';
var token_collection_1 = __pack_require__('stache/token-collection');
var tokenizer = __pack_require__('stache/tokenizer');
var rt = __pack_require__('stache/runtime');
global.stacheCompiled = global.stacheCompiled || {};
var KEYWORD_IF = 'if';
var KEYWORD_IN = 'in';
var KEYWORD_ELIF = 'elif';
var KEYWORD_ELSE = 'else';
var KEYWORD_ENDIF = 'endif';
var KEYWORD_FOR = 'for';
var KEYWORD_ENDFOR = 'endfor';
var KEYWORD_TYPEOF = 'typeof';
var KEYWORD_INSTANCEOF = 'instanceof';
var RUNTIME_VAR = '_RT_';
var DATA_VAR = '_D_';
var OUT_VAR = '_O_';
var Compiler = (function () {
    function Compiler(tokens, args) {
        this.tokens = tokens;
        this.blockStack = [];
        this.blockStackTop = -1;
        this.loopCounter = 0;
        this.declared = {};
        this.scope = [];
        this.currentScope = null;
        this.inScope = {};
        args = args || { escape: true };
        this.escape = args.escape !== false;
    }
    ;
    Compiler.fail = function (message, token) {
        throw new Error(message + ': line ' + token.line + ' column ' + token.column);
    };
    ;
    Compiler.safeVar = function (variable) {
        var safe = variable;
        if (variable.charAt(0) !== '_') {
            safe = '_' + variable;
        }
        return {
            orig: variable,
            safe: safe
        };
    };
    ;
    Compiler.isJsKeyword = function (str) {
        switch (str) {
            case KEYWORD_TYPEOF:
            case KEYWORD_INSTANCEOF:
                return true;
        }
        return false;
    };
    ;
    Compiler.prototype.nextToken = function () {
        this.tokens.forward();
        return this.tokens.current();
    };
    ;
    Compiler.prototype.nextRealToken = function () {
        var token;
        do {
            this.tokens.forward();
            token = this.tokens.current();
        } while (token && token.type === tokenizer.TOKEN_WHITESPACE);
        return token;
    };
    ;
    Compiler.prototype.shouldTrimLeft = function () {
        var prev = this.tokens.previous();
        return prev !== null &&
            prev.type === tokenizer.TOKEN_BLOCK_END &&
            prev.value.charAt(0) !== tokenizer.CHAR_NO_TRIM;
    };
    ;
    Compiler.prototype.shouldTrimRight = function () {
        var next = this.tokens.next();
        return next !== null &&
            next.type === tokenizer.TOKEN_BLOCK_START &&
            next.value.charAt(next.value.length - 1) !== tokenizer.CHAR_NO_TRIM;
    };
    ;
    Compiler.prototype.enterScope = function () {
        this.currentScope = [];
        this.scope.push(this.currentScope);
    };
    ;
    Compiler.prototype.addScopeVar = function (variable, safeName) {
        this.currentScope.push({ name: variable, safe: safeName });
        this.inScope[variable] = safeName;
    };
    ;
    Compiler.prototype.exitScope = function () {
        var scopeVars = this.scope.pop();
        for (var i = 0; i < scopeVars.length; i++) {
            var scopeVar = scopeVars[i];
            delete this.inScope[scopeVar.name];
        }
        this.currentScope = this.scope[this.scope.length - 1] || [];
        for (var j = 0; j < this.currentScope.length; j++) {
            var curScopeVar = this.currentScope[j];
            this.inScope[curScopeVar.name] = curScopeVar.safe;
        }
    };
    ;
    Compiler.prototype.enterBlock = function (block) {
        this.blockStack.push(block);
        this.blockStackTop = this.blockStack.length - 1;
    };
    ;
    Compiler.prototype.verifyInBlock = function (block, token) {
        if (this.blockStack[this.blockStackTop] !== block) {
            Compiler.fail('Not inside ' + block + ' block', token);
        }
    };
    ;
    Compiler.prototype.exitBlock = function (block, token) {
        var popped = this.blockStack.pop();
        if (popped !== block) {
            Compiler.fail('Unexpected ' + token.value, token);
        }
        this.blockStackTop = this.blockStack.length - 1;
    };
    ;
    Compiler.prototype.parseFilters = function () {
        function filter() {
            return {
                name: null,
                args: []
            };
        }
        function addArg(f, arg) {
            f.args.push(arg);
            return [];
        }
        var token;
        var inArgs = false;
        var current = filter();
        var filters = {
            collection: [current],
            hasRaw: false,
            hasSafe: false
        };
        var argStack = [];
        while ((token = this.nextRealToken()) !== null) {
            if (token.type === tokenizer.TOKEN_VARIABLE_END) {
                break;
            }
            switch (token.type) {
                case tokenizer.TOKEN_SYMBOL:
                    if (!inArgs) {
                        if (current.name !== null) {
                            Compiler.fail('Unexpected symbol: ' + token.value, token);
                        }
                        current.name = token.value;
                        switch (current.name) {
                            case rt.FILTER_RAW:
                                filters.hasRaw = true;
                                break;
                            case rt.FILTER_SAFE:
                            case rt.FILTER_ESCHTML:
                            case rt.FILTER_ESCATTR:
                            case rt.FILTER_ESCXML:
                            case rt.FILTER_ESCURL:
                            case rt.FILTER_ESCCSS:
                                filters.hasSafe = true;
                                break;
                        }
                    }
                    else {
                        argStack.push(token.value);
                    }
                    break;
                case tokenizer.TOKEN_DOT:
                    if (argStack.length > 0) {
                        argStack.push(token.value);
                    }
                    else {
                        Compiler.fail('Unexpected dot', token);
                    }
                    break;
                case tokenizer.TOKEN_LEFT_PAREN:
                    inArgs = true;
                    break;
                case tokenizer.TOKEN_RIGHT_PAREN:
                    if (argStack.length > 0) {
                        argStack = addArg(current, this.scopeVar(argStack));
                    }
                    inArgs = false;
                    break;
                case tokenizer.TOKEN_FLOAT:
                case tokenizer.TOKEN_STRING:
                case tokenizer.TOKEN_INTEGER:
                case tokenizer.TOKEN_BOOLEAN:
                case tokenizer.TOKEN_NULL:
                    argStack = addArg(current, token.value);
                    break;
                case tokenizer.TOKEN_COMMA:
                    if (argStack.length > 0) {
                        argStack = addArg(current, this.scopeVar(argStack));
                    }
                    break;
                case tokenizer.TOKEN_PIPE:
                    current = filter();
                    filters.collection.push(current);
                    break;
                default:
                    Compiler.fail('Unexpected token: ' + token.type, token);
            }
        }
        return filters;
    };
    ;
    Compiler.prototype.parseVariable = function () {
        var token;
        var filters = {
            collection: [],
            hasRaw: false,
            hasSafe: false
        };
        var varStack = [];
        while ((token = this.nextRealToken()) !== null) {
            if (token.type === tokenizer.TOKEN_VARIABLE_END) {
                break;
            }
            if (token.type === tokenizer.TOKEN_PIPE) {
                filters = this.parseFilters();
                break;
            }
            switch (token.type) {
                case tokenizer.TOKEN_SYMBOL:
                case tokenizer.TOKEN_LEFT_BRACKET:
                case tokenizer.TOKEN_LEFT_PAREN:
                case tokenizer.TOKEN_RIGHT_BRACKET:
                case tokenizer.TOKEN_RIGHT_PAREN:
                case tokenizer.TOKEN_INTEGER:
                case tokenizer.TOKEN_DOT:
                    varStack.push(token.value);
                    break;
                default:
                    Compiler.fail('Unexpected token', token);
            }
        }
        if (this.escape && !filters.hasSafe && !filters.hasRaw) {
            filters.collection.push({ name: rt.FILTER_SAFE, args: [] });
        }
        var scopedVar = this.scopeVar(varStack);
        for (var i = 0; i < filters.collection.length; i++) {
            var filter = filters.collection[i];
            if (filter.name !== rt.FILTER_RAW) {
                scopedVar = RUNTIME_VAR + '.filters[\'' + filter.name + '\'](' + scopedVar;
                if (filter.args.length > 0) {
                    scopedVar += ', ' + filter.args.join(', ');
                }
                scopedVar += ')';
            }
        }
        return OUT_VAR + ' += ' + scopedVar + ';';
    };
    ;
    Compiler.prototype.declare = function (variable) {
        var code = variable;
        if (typeof this.declared[variable] === 'undefined') {
            code = 'var ' + code;
            this.declared[variable] = true;
        }
        return code;
    };
    ;
    Compiler.prototype.scopeVar = function (varParts) {
        var scope = DATA_VAR;
        var buffer = '';
        var args = [];
        varParts.push(tokenizer.CHAR_DOT);
        for (var i = 0; i < varParts.length; i++) {
            var part = varParts[i];
            switch (part) {
                case tokenizer.CHAR_DOT:
                case tokenizer.CHAR_LEFT_BRACKET:
                    args.push(buffer);
                    buffer = '';
                    break;
                case tokenizer.CHAR_RIGHT_BRACKET:
                    break;
                default:
                    buffer += part;
                    break;
            }
        }
        if (this.inScope[args[0]]) {
            scope = args.shift();
            if (this.inScope[scope] !== '') {
                scope = this.inScope[scope];
            }
        }
        if (args.length === 0) {
            return RUNTIME_VAR + '.lookup(' + scope + ')';
        }
        for (var j = 0; j < args.length; j++) {
            var argInt = parseInt(args[j], 10);
            if (isNaN(argInt)) {
                args[j] = '\'' + args[j] + '\'';
            }
        }
        return RUNTIME_VAR + '.lookup(' + scope + ', ' + args.join(', ') + ')';
    };
    ;
    Compiler.prototype.parseIf = function () {
        var token;
        var code = '';
        var piece = '';
        var collecting = false;
        var varStack = [];
        while ((token = this.nextToken()) !== null) {
            piece = '';
            if (token.type === tokenizer.TOKEN_BLOCK_END) {
                this.tokens.back();
                break;
            }
            if (token.type === tokenizer.TOKEN_SYMBOL) {
                collecting = !Compiler.isJsKeyword(token.value);
            }
            if (collecting) {
                switch (token.type) {
                    case tokenizer.TOKEN_DOT:
                    case tokenizer.TOKEN_SYMBOL:
                    case tokenizer.TOKEN_LEFT_BRACKET:
                    case tokenizer.TOKEN_RIGHT_BRACKET:
                    case tokenizer.TOKEN_STRING:
                    case tokenizer.TOKEN_INTEGER:
                        varStack.push(token.value);
                        break;
                    default:
                        collecting = false;
                        piece = token.value;
                }
            }
            else {
                piece = token.value;
            }
            if (!collecting && varStack.length > 0) {
                code += this.scopeVar(varStack);
                varStack = [];
            }
            code += piece;
        }
        return code.trim();
    };
    ;
    Compiler.prototype.parseFor = function () {
        this.loopCounter++;
        var token;
        var iterVar = '_loop' + this.loopCounter;
        var loopVars = [];
        while ((token = this.nextRealToken()) !== null) {
            if (token.value === KEYWORD_IN) {
                break;
            }
            switch (token.type) {
                case tokenizer.TOKEN_SYMBOL:
                    loopVars.push(token.value);
                    break;
                case tokenizer.TOKEN_COMMA:
                    break;
                default:
                    Compiler.fail('Unexpected token "' + token.value + '" in for block', token);
            }
        }
        var indexVar = null;
        var valueVar = null;
        switch (loopVars.length) {
            case 1:
                valueVar = Compiler.safeVar(loopVars[0]);
                break;
            case 2:
                indexVar = Compiler.safeVar(loopVars[0]);
                valueVar = Compiler.safeVar(loopVars[1]);
                break;
            default:
                Compiler.fail('Invalid for block', token);
        }
        var varStack = [];
        var isRange = false;
        var rangeVals = [];
        while ((token = this.nextRealToken()) !== null) {
            if (token.type === tokenizer.TOKEN_BLOCK_END) {
                this.tokens.back();
                break;
            }
            switch (token.type) {
                case tokenizer.TOKEN_SYMBOL:
                    var next = this.tokens.next();
                    if (next.type === tokenizer.TOKEN_LEFT_PAREN) {
                        if (token.value !== rt.FILTER_RANGE) {
                            Compiler.fail('Unexpected filter ' + token.value, token);
                        }
                        isRange = true;
                    }
                    else {
                        varStack.push(token.value);
                    }
                    break;
                case tokenizer.TOKEN_COMMA:
                    if (!isRange) {
                        Compiler.fail('Unexpected comma', token);
                    }
                    break;
                case tokenizer.TOKEN_INTEGER:
                    if (isRange) {
                        rangeVals.push(token.value);
                    }
                    else {
                        varStack.push(token.value);
                    }
                    break;
                case tokenizer.TOKEN_DOT:
                case tokenizer.TOKEN_LEFT_BRACKET:
                case tokenizer.TOKEN_RIGHT_BRACKET:
                    varStack.push(token.value);
                    break;
            }
        }
        if (isRange && rangeVals.length !== 2) {
            Compiler.fail('Expected 2 parameters for range()', token);
        }
        var arrVar = isRange ?
            rangeVals[0] + ', ' + rangeVals[1] :
            this.scopeVar(varStack);
        this.addScopeVar(valueVar.orig, valueVar.safe);
        this.addScopeVar('loop', iterVar);
        var code = [
            this.declare(iterVar) + ' = new ' + RUNTIME_VAR + '.Iterable(' + arrVar + ');',
            this.declare(valueVar.safe) + ' = null;',
            'while ((' + valueVar.safe + ' = ' + iterVar + '.next()) !== null) {'
        ];
        if (indexVar !== null) {
            this.addScopeVar(indexVar.orig, indexVar.safe);
            code.push(this.declare(indexVar.safe) + ' = ' + iterVar + '.index();');
        }
        return code.join('\n');
    };
    ;
    Compiler.prototype.parseBlock = function () {
        var code = '';
        var token = this.nextRealToken();
        if (token.type !== tokenizer.TOKEN_SYMBOL) {
            Compiler.fail('Unexpected token', token);
        }
        switch (token.value) {
            case KEYWORD_IF:
                this.enterBlock(KEYWORD_IF);
                code = 'if (' + this.parseIf() + ') {';
                break;
            case KEYWORD_ELIF:
                this.verifyInBlock(KEYWORD_IF, token);
                code = '} else if (' + this.parseIf() + ') {';
                break;
            case KEYWORD_ELSE:
                this.verifyInBlock(KEYWORD_IF, token);
                code = '} else {';
                break;
            case KEYWORD_ENDIF:
                this.exitBlock(KEYWORD_IF, token);
                code = '}';
                break;
            case KEYWORD_FOR:
                this.enterBlock(KEYWORD_FOR);
                this.enterScope();
                code = this.parseFor();
                break;
            case KEYWORD_ENDFOR:
                this.exitScope();
                this.exitBlock(KEYWORD_FOR, token);
                code = '}';
                break;
            default:
                Compiler.fail('Expected keyword, got ' + token.value, token);
                break;
        }
        token = this.nextRealToken();
        if (token.type !== tokenizer.TOKEN_BLOCK_END) {
            Compiler.fail('Expected block end, got ' + token.value, token);
        }
        return code;
    };
    ;
    Compiler.prototype.compile = function () {
        var token;
        var code = [
            '\'use strict\';',
            'var ' + OUT_VAR + ' = \'\';'
        ];
        while ((token = this.tokens.current()) !== null) {
            switch (token.type) {
                case tokenizer.TOKEN_DATA:
                    var value = token.value;
                    if (this.shouldTrimLeft()) {
                        value = value.replace(/^[\s\t]+/g, '');
                    }
                    if (this.shouldTrimRight()) {
                        value = value.replace(/[\s\uFEFF\xA0]+$/g, '');
                    }
                    code.push(OUT_VAR + ' += ' + JSON.stringify(value) + ';');
                    break;
                case tokenizer.TOKEN_VARIABLE_START:
                    code.push(this.parseVariable());
                    break;
                case tokenizer.TOKEN_BLOCK_START:
                    code.push(this.parseBlock());
                    break;
                case tokenizer.TOKEN_COMMENT:
                    break;
                default:
                    Compiler.fail('Unexpected token', token);
                    break;
            }
            this.tokens.forward();
        }
        code.push('return ' + OUT_VAR + ';');
        return code.join('\n');
    };
    ;
    return Compiler;
})();
function lex(str) {
    var token;
    var tokens = [];
    var tnizer = new tokenizer.Tokenizer(str);
    while ((token = tnizer.nextToken()) !== null) {
        tokens.push(token);
    }
    return new token_collection_1.TokenCollection(tokens);
}
function precompile(name, src) {
    var compiler = new Compiler(lex(src));
    var compiled = compiler.compile();
    return "stache.register('" + name + "', function (" + DATA_VAR + ", " + RUNTIME_VAR + ") {\n" + compiled + "\n});\n";
}
exports.precompile = precompile;
function compile(name, src) {
    if (!global.stacheCompiled[name]) {
        var compiler = new Compiler(lex(src));
        global.stacheCompiled[name] = new Function(DATA_VAR, RUNTIME_VAR, compiler.compile());
    }
    return {
        render: function (data) {
            return rt.render(name, data);
        }
    };
}
exports.compile = compile;
exports.filter = rt.filter;
exports.render = rt.render;
exports.register = rt.register;

}}, (typeof global === 'undefined') ? this : global);
if (typeof module !== 'undefined') {
	module.exports = stache;
}
var fose = (function unpack(modules, global) {
	var _lfreq_ = global._lfreq_;

	if (typeof _lfreq_ !== 'function') {
		_lfreq_ = function _lfreq_(moduleId) {
			if (_lfreq_.installed[moduleId]) {
				return _lfreq_.installed[moduleId].exports;
			}

			if (!_lfreq_.modules[moduleId]) {
				throw new Error('Could not load module "' + moduleId + '"');
			}

			var module = _lfreq_.installed[moduleId] = {
				exports: {},
				id: moduleId,
				loaded: false
			};

			_lfreq_.modules[moduleId].call(
				module.exports,
				module,
				module.exports,
				global,
				_lfreq_
			);

			module.loaded = true;

			return module.exports;
		};

		_lfreq_.modules = {};
		_lfreq_.installed = {};

		global._lfreq_ = _lfreq_;

		if (typeof process === 'undefined' || typeof process.env === 'undefined') {
			global.require = _lfreq_;
		}
	}

	for (var moduleId in modules) {
		_lfreq_.modules[moduleId] = modules[moduleId];
	}

	return _lfreq_('fose/client/fose');
})
({'fose/shared/server-api/routes': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SEARCH = 'search';
exports.DETAILS = 'details';

},
'fose/shared/types': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });

},
'fose/client/actions': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var dom = _lfreq_('fose/client/util/dom');
var log_1 = _lfreq_('fose/client/util/log');
var ATTR_ACTION = 'data-action';
var MODIFIER_ALLOW_DEFAULT = 'allowdefault;';
var actionHandlers = {};
var last = {
    timeout: 0,
    is: function (el) {
        return this.clicked === el;
    },
    set: function (el) {
        var _this = this;
        clearTimeout(this.timeout);
        this.clicked = el;
        this.timeout = setTimeout(function () { delete _this.clicked; }, 400);
    }
};
function handle(action, handler) {
    actionHandlers[action] = handler;
}
exports.handle = handle;
function trigger(actions, target) {
    runAll(actions.split(','), target);
}
exports.trigger = trigger;
function runAll(actions, target) {
    return __awaiter(this, void 0, void 0, function () {
        var _i, actions_1, action, hash, i, action, newTarget, ex_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    for (_i = 0, actions_1 = actions; _i < actions_1.length; _i++) {
                        action = actions_1[_i];
                        if (action !== '' && !actionHandlers[action]) {
                            throw new Error("No handler defined for \"" + action + "\"");
                        }
                    }
                    hash = dom.getAttribute(target, 'data-hash');
                    i = 0;
                    _a.label = 1;
                case 1:
                    if (!(i < actions.length)) return [3, 8];
                    action = actions[i];
                    if (action === '') {
                        return [3, 7];
                    }
                    _a.label = 2;
                case 2:
                    _a.trys.push([2, 6, , 7]);
                    if (!(hash && i > 0)) return [3, 4];
                    return [4, dom.nextAnimationFrame()];
                case 3:
                    _a.sent();
                    newTarget = dom.find("[data-hash=\"" + hash + "\"]");
                    if (newTarget) {
                        target = newTarget;
                    }
                    _a.label = 4;
                case 4: return [4, actionHandlers[action].call(target)];
                case 5:
                    _a.sent();
                    return [3, 7];
                case 6:
                    ex_1 = _a.sent();
                    log_1.default("Action \"" + action + "\" failed: " + ex_1);
                    log_1.default(ex_1);
                    return [3, 8];
                case 7:
                    i++;
                    return [3, 1];
                case 8: return [2];
            }
        });
    });
}
function extractActions(actions, type) {
    if (type === void 0) { type = ''; }
    var extracted = [];
    actions.split(',').forEach(function (action) {
        var colon = action.indexOf(':');
        if (colon === -1 && type === '') {
            extracted.push(action);
            return;
        }
        var actionType = action.substr(0, colon);
        if (actionType === type) {
            extracted.push(action.substr(colon + 1));
        }
    });
    return extracted.join(',');
}
function handleClick(evt) {
    var target = evt.target;
    while (target) {
        var actions = dom.getAttribute(target, ATTR_ACTION);
        if (actions) {
            var allowDefault = false;
            if (actions.indexOf(MODIFIER_ALLOW_DEFAULT) === 0) {
                allowDefault = true;
                actions = actions.substr(MODIFIER_ALLOW_DEFAULT.length);
            }
            if (!last.is(target)) {
                last.set(target);
                trigger(extractActions(actions), target);
            }
            if (!allowDefault) {
                evt.preventDefault();
            }
            evt.stopPropagation();
            break;
        }
        else {
            target = target.parentElement;
        }
    }
}
function handleChange(evt) {
    var target = evt.target;
    while (target) {
        var actions = dom.getAttribute(target, ATTR_ACTION);
        if (actions) {
            var changeActions = extractActions(actions, 'onchange');
            if (changeActions) {
                trigger(changeActions, target);
                evt.stopPropagation();
            }
            break;
        }
        else {
            target = target.parentElement;
        }
    }
}
function initialize() {
    document.addEventListener('click', handleClick);
    document.addEventListener('change', handleChange);
}
exports.initialize = initialize;

},
'fose/client/app': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = _lfreq_('fose/client/config');
var user = _lfreq_('fose/client/user');
var event_emitter_1 = _lfreq_('fose/client/util/event-emitter');
var seligo = _lfreq_('fose/client/util/seligo');
exports.VERSION = '1.0.0';
exports.EVENT_INITIALIZE = 'initialize';
var events = new event_emitter_1.default();
var actions = _lfreq_('fose/client/actions');
var emptySpace = _lfreq_('fose/client/empty-space');
var panels = _lfreq_('fose/client/panels');
var screen = _lfreq_('fose/client/util/screen');
var actionCalendarShowAll = _lfreq_('fose/client/builtin-actions/calendar-show-all');
var actionCartAdd = _lfreq_('fose/client/builtin-actions/cart-add');
var actionCartClear = _lfreq_('fose/client/builtin-actions/cart-clear');
var actionCartRemove = _lfreq_('fose/client/builtin-actions/cart-remove');
var actionCartSubmit = _lfreq_('fose/client/builtin-actions/cart-submit');
var actionDetails = _lfreq_('fose/client/builtin-actions/details');
var actionGroupSearch = _lfreq_('fose/client/builtin-actions/group-search');
var actionLogin = _lfreq_('fose/client/builtin-actions/login');
var actionOtherCart = _lfreq_('fose/client/builtin-actions/other-cart');
var actionPanelBack = _lfreq_('fose/client/builtin-actions/panel-back');
var actionPanelHome = _lfreq_('fose/client/builtin-actions/panel-home');
var actionPrimaryCart = _lfreq_('fose/client/builtin-actions/primary-cart');
var actionResetSearch = _lfreq_('fose/client/builtin-actions/reset-search');
var actionResultsCalendar = _lfreq_('fose/client/builtin-actions/results-calendar');
var actionSearch = _lfreq_('fose/client/builtin-actions/search');
var actionShowCartAdd = _lfreq_('fose/client/builtin-actions/show-cart-add');
var actionShowCartRemove = _lfreq_('fose/client/builtin-actions/show-cart-remove');
var actionTrayRemove = _lfreq_('fose/client/builtin-actions/tray-remove');
var panelCalendar = _lfreq_('fose/client/builtin-panels/calendar');
var panelDetails = _lfreq_('fose/client/builtin-panels/details');
var panelResults = _lfreq_('fose/client/builtin-panels/results');
var panelSearch = _lfreq_('fose/client/builtin-panels/search');
var filterCountsToString = _lfreq_('fose/client/builtin-filters/counts-to-string');
var filterSourceDB = _lfreq_('fose/client/builtin-filters/srcdb');
var filterString = _lfreq_('fose/client/builtin-filters/string');
var initializeables = [
    screen,
    actions,
    emptySpace,
    panels,
    actionCalendarShowAll,
    actionCartAdd,
    actionCartClear,
    actionCartRemove,
    actionCartSubmit,
    actionDetails,
    actionLogin,
    actionGroupSearch,
    actionOtherCart,
    actionPanelBack,
    actionPanelHome,
    actionPrimaryCart,
    actionResetSearch,
    actionResultsCalendar,
    actionSearch,
    actionShowCartAdd,
    actionShowCartRemove,
    actionTrayRemove,
    panelCalendar,
    panelDetails,
    panelResults,
    panelSearch,
    filterCountsToString,
    filterSourceDB,
    filterString
];
function initialize() {
    for (var _i = 0, initializeables_1 = initializeables; _i < initializeables_1.length; _i++) {
        var module = initializeables_1[_i];
        module.initialize();
    }
    seligo.initIn(document.body);
    if (config_1.default.haveSAM) {
        sam.config.cartURL = sam.config.userRecordURL;
        sam.events.on('login', user.handleLogin);
        sam.fetchRecord();
    }
    events.emit(exports.EVENT_INITIALIZE);
}
exports.initialize = initialize;
function on(event, handler) {
    events.on(event, handler);
}
exports.on = on;

},
'fose/client/builtin-actions/calendar-show-all': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var calendarPanel = _lfreq_('fose/client/builtin-panels/calendar');
var panels = _lfreq_('fose/client/panels');
function initialize() {
    actions.handle('calendar-show-all', calendarShowAll);
}
exports.initialize = initialize;
function calendarShowAll() {
    return __awaiter(this, void 0, void 0, function () {
        var srcPanel;
        return __generator(this, function (_a) {
            srcPanel = panels.findByChild(this);
            if (srcPanel) {
                calendarPanel.showAll(srcPanel);
            }
            return [2];
        });
    });
}

},
'fose/client/builtin-actions/cart-add': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var cart = _lfreq_('fose/client/cart');
var config_1 = _lfreq_('fose/client/config');
var trays = _lfreq_('fose/client/panel/tray');
var panels = _lfreq_('fose/client/panels');
function initialize() {
    actions.handle('cart-add', cartAdd);
}
exports.initialize = initialize;
function cartAdd() {
    return __awaiter(this, void 0, void 0, function () {
        var panel, tray, params, response;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    panel = panels.findByChild(this);
                    tray = trays.findByChild(this);
                    if (!tray || !panel) {
                        throw new Error('cart-add action expected to be called from a tray in a panel');
                    }
                    params = cart.getParameters(tray.element);
                    if (params.p_cart_name === '' || params.p_cart_name.indexOf('|') !== -1) {
                        alert(config_1.default.textInvalidCartName);
                        throw new Error('Attempt to use invalid cart name');
                    }
                    if (sam.cart.isReadOnly(params.p_cart_name, params.p_term_code)) {
                        alert(config_1.default.textCartIsReadOnly);
                        throw new Error('Attempt to update a read-only cart');
                    }
                    panel.markBusy();
                    return [4, sam.cart.add(params)];
                case 1:
                    response = _a.sent();
                    panel.markReady();
                    if (response.error) {
                        alert(config_1.default.textUpdateCartFailed + ' ' + response.error);
                        throw new Error(response.error);
                    }
                    return [4, tray.remove()];
                case 2:
                    _a.sent();
                    return [4, cart.showContents(panel, params.p_cart_name, params.p_term_code)];
                case 3:
                    _a.sent();
                    panels.renderAll();
                    return [2];
            }
        });
    });
}

},
'fose/client/builtin-actions/cart-clear': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var resultsPanel = _lfreq_('fose/client/builtin-panels/results');
var config_1 = _lfreq_('fose/client/config');
var panels = _lfreq_('fose/client/panels');
function cartClear() {
    return __awaiter(this, void 0, void 0, function () {
        var srcPanel, panelData, params, cartContents, _i, cartContents_1, cartItem, response, currentPanel, curPanelData;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    srcPanel = panels.findByChild(this);
                    if (!srcPanel) {
                        throw new Error('The cart-clear action must originate from a Panel');
                    }
                    panelData = srcPanel.data();
                    if (!panelData.client.cart) {
                        throw new Error('The cart-clear action must originate from a cart panel');
                    }
                    if (!confirm(config_1.default.textConfirmClearCart)) {
                        return [2];
                    }
                    params = {
                        p_cart_name: panelData.client.cart.id,
                        p_term_code: panelData.client.cart.srcdb,
                        p_crn: ''
                    };
                    if (sam.cart.isReadOnly(params.p_cart_name, params.p_term_code)) {
                        alert(config_1.default.textCartIsReadOnly);
                        throw new Error('Attempt to clear a read-only cart');
                    }
                    srcPanel.markBusy();
                    cartContents = sam.cart.contents(params.p_cart_name, params.p_term_code);
                    _i = 0, cartContents_1 = cartContents;
                    _a.label = 1;
                case 1:
                    if (!(_i < cartContents_1.length)) return [3, 4];
                    cartItem = cartContents_1[_i];
                    params.p_crn = cartItem.crn;
                    return [4, sam.cart.remove(params)];
                case 2:
                    response = _a.sent();
                    if (response.error) {
                        alert(config_1.default.textUpdateCartFailed);
                        throw new Error(response.error);
                    }
                    _a.label = 3;
                case 3:
                    _i++;
                    return [3, 1];
                case 4:
                    srcPanel.markReady();
                    currentPanel = panels.getRoot();
                    _a.label = 5;
                case 5:
                    if (!currentPanel) return [3, 8];
                    if (!currentPanel.isKind(resultsPanel.KIND)) return [3, 7];
                    curPanelData = currentPanel.data();
                    if (!(curPanelData.client.cart && curPanelData.client.cart.id === params.p_cart_name)) return [3, 7];
                    return [4, panels.remove(currentPanel)];
                case 6:
                    _a.sent();
                    return [3, 8];
                case 7:
                    currentPanel = currentPanel.next;
                    return [3, 5];
                case 8: return [2];
            }
        });
    });
}
function initialize() {
    actions.handle('cart-clear', cartClear);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/cart-remove': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var cart = _lfreq_('fose/client/cart');
var config_1 = _lfreq_('fose/client/config');
var trays = _lfreq_('fose/client/panel/tray');
var panels = _lfreq_('fose/client/panels');
function initialize() {
    actions.handle('cart-remove', cartRemove);
}
exports.initialize = initialize;
function cartRemove() {
    return __awaiter(this, void 0, void 0, function () {
        var panel, tray, params, response;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    panel = panels.findByChild(this);
                    tray = trays.findByChild(this);
                    if (!tray || !panel) {
                        throw new Error('cart-remove action expected to be called from a tray in a panel');
                    }
                    params = cart.getParameters(tray.element);
                    if (sam.cart.isReadOnly(params.p_cart_name, params.p_term_code)) {
                        alert(config_1.default.textCartIsReadOnly);
                        throw new Error('Attempt to update a read-only cart');
                    }
                    panel.markBusy();
                    return [4, sam.cart.remove(params)];
                case 1:
                    response = _a.sent();
                    panel.markReady();
                    if (response.error) {
                        alert(config_1.default.textUpdateCartFailed + ' ' + response.error);
                        throw new Error(response.error);
                    }
                    return [4, tray.remove()];
                case 2:
                    _a.sent();
                    return [4, cart.showContents(panel, params.p_cart_name, params.p_term_code)];
                case 3:
                    _a.sent();
                    panels.renderAll();
                    return [2];
            }
        });
    });
}

},
'fose/client/builtin-actions/cart-submit': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var config_1 = _lfreq_('fose/client/config');
function initialize() {
    actions.handle('cart-submit', cartSubmit);
}
exports.initialize = initialize;
function cartSubmit() {
    window.open(config_1.default.cartSubmitURL);
}

},
'fose/client/builtin-actions/details': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var detailsPanel = _lfreq_('fose/client/builtin-panels/details');
var config_1 = _lfreq_('fose/client/config');
var events_1 = _lfreq_('fose/client/events');
var panels = _lfreq_('fose/client/panels');
var detailsAPI = _lfreq_('fose/client/server-api/details');
var dom = _lfreq_('fose/client/util/dom');
function resultDetails() {
    return __awaiter(this, void 0, void 0, function () {
        var el, srcPanel, panelData, group, matched, key, srcdb, reuseSrcPanel, newPanel, response, ex_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    el = this;
                    if (el.classList.contains('notoffered')) {
                        alert(config_1.default.textNotOffered || 'This course is not currently being offered');
                        return [2];
                    }
                    srcPanel = panels.findByChild(el);
                    if (!srcPanel) return [3, 8];
                    panelData = srcPanel.data();
                    group = dom.getAttribute(el, 'data-group');
                    matched = dom.getAttribute(el, 'data-matched');
                    key = dom.getAttribute(el, 'data-key');
                    srcdb = dom.getAttribute(el, 'data-srcdb');
                    reuseSrcPanel = false;
                    if (srcPanel.isKind(detailsPanel.KIND) && panelData.client.group === group) {
                        reuseSrcPanel = true;
                    }
                    if (!srcdb && panelData.client.srcdb) {
                        srcdb = panelData.client.srcdb;
                    }
                    newPanel = srcPanel;
                    if (!reuseSrcPanel) {
                        newPanel = panels.insert(detailsPanel.KIND, srcPanel);
                    }
                    _a.label = 1;
                case 1:
                    _a.trys.push([1, 4, 6, 8]);
                    return [4, detailsAPI.fetchFor(group, key, matched, srcdb)];
                case 2:
                    response = _a.sent();
                    if (response.groupSize === 1 && !key && config_1.default.collapse.keyField) {
                        key = config_1.default.collapse.keyField + ":" + response[config_1.default.collapse.keyField];
                    }
                    return [4, newPanel.render({
                            client: { key: key, srcdb: srcdb, group: group, matched: matched },
                            server: response
                        })];
                case 3:
                    _a.sent();
                    return [3, 8];
                case 4:
                    ex_1 = _a.sent();
                    return [4, newPanel.render({ error: ex_1 })];
                case 5:
                    _a.sent();
                    throw ex_1;
                case 6:
                    newPanel.focus();
                    return [4, events_1.default.emit('action.details.done', newPanel)];
                case 7:
                    _a.sent();
                    return [7];
                case 8: return [2];
            }
        });
    });
}
function initialize() {
    actions.handle('details', resultDetails);
    actions.handle('result-detail', resultDetails);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/group-search': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var resultsPanel = _lfreq_('fose/client/builtin-panels/results');
var panels = _lfreq_('fose/client/panels');
var searchAPI = _lfreq_('fose/client/server-api/search');
var dom = _lfreq_('fose/client/util/dom');
function groupSearch() {
    return __awaiter(this, void 0, void 0, function () {
        var srcPanel, panelData, group, colon, field, value, searchData, newPanel, response, ex_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    srcPanel = panels.findByChild(this);
                    if (!srcPanel) return [3, 7];
                    panelData = srcPanel.data();
                    group = dom.getAttribute(this, 'data-group');
                    colon = group.indexOf(':');
                    field = group.substr(0, colon);
                    value = group.substr(colon + 1);
                    searchData = {
                        client: { descriptions: [] },
                        server: {
                            other: { srcdb: panelData.client.srcdb },
                            criteria: [{ field: field, value: value }]
                        }
                    };
                    newPanel = panels.insert(resultsPanel.KIND, srcPanel);
                    _a.label = 1;
                case 1:
                    _a.trys.push([1, 4, 6, 7]);
                    return [4, searchAPI.executeOn(searchData.server)];
                case 2:
                    response = _a.sent();
                    return [4, newPanel.render({
                            client: searchData.client,
                            server: response
                        })];
                case 3:
                    _a.sent();
                    return [3, 7];
                case 4:
                    ex_1 = _a.sent();
                    return [4, newPanel.render({ error: ex_1 })];
                case 5:
                    _a.sent();
                    throw ex_1;
                case 6:
                    newPanel.focus();
                    return [7];
                case 7: return [2];
            }
        });
    });
}
function initialize() {
    actions.handle('group-search', groupSearch);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/login': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var config_1 = _lfreq_('fose/client/config');
var panels = _lfreq_('fose/client/panels');
function login() {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!config_1.default.haveSAM) {
                        throw new Error('Trying to use SAM features when it is not enabled');
                    }
                    if (sam.isAuthenticated()) {
                        return [2];
                    }
                    return [4, sam.login()];
                case 1:
                    _a.sent();
                    if (sam.isAuthenticated()) {
                        panels.renderAll();
                    }
                    else {
                        throw new Error('SAM authentication failed or cancelled');
                    }
                    return [2];
            }
        });
    });
}
function initialize() {
    actions.handle('login', login);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/other-cart': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var cart = _lfreq_('fose/client/cart');
var config_1 = _lfreq_('fose/client/config');
var panels = _lfreq_('fose/client/panels');
function initialize() {
    actions.handle('other-cart', otherCart);
}
exports.initialize = initialize;
function otherCart() {
    return __awaiter(this, void 0, void 0, function () {
        var panel, pipe, srcdb, cartID;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!config_1.default.haveCART) {
                        throw new Error('Trying to use CART features when it is not currently enabled');
                    }
                    panel = panels.findByChild(this);
                    if (!panel) return [3, 2];
                    if (!(this.value !== '')) return [3, 2];
                    pipe = this.value.indexOf('|');
                    srcdb = this.value.substr(0, pipe);
                    cartID = this.value.substr(pipe + 1);
                    return [4, cart.showContents(panel, cartID, srcdb)];
                case 1:
                    _a.sent();
                    _a.label = 2;
                case 2: return [2];
            }
        });
    });
}

},
'fose/client/builtin-actions/panel-back': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var panels = _lfreq_('fose/client/panels');
var swipe = _lfreq_('fose/client/util/swipe');
function panelBack() {
    var srcPanel = panels.findByChild(this);
    if (srcPanel) {
        panels.remove(srcPanel);
    }
}
function initialize() {
    actions.handle('panel-back', panelBack);
    var swipeEvents = swipe.track(document.body);
    swipeEvents.on('right', function (target) {
        actions.trigger('panel-back', target);
    });
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/panel-home': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var searchPanel = _lfreq_('fose/client/builtin-panels/search');
var panels = _lfreq_('fose/client/panels');
function panelHome() {
    var root = panels.getRoot();
    if (root.next) {
        panels.remove(root.next);
    }
    searchPanel.reset();
}
function initialize() {
    actions.handle('panel-home', panelHome);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/primary-cart': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var searchPanel = _lfreq_('fose/client/builtin-panels/search');
var cart = _lfreq_('fose/client/cart');
var config_1 = _lfreq_('fose/client/config');
var events_1 = _lfreq_('fose/client/events');
var panels = _lfreq_('fose/client/panels');
var srcdb = _lfreq_('fose/client/srcdb');
function initialize() {
    actions.handle('primary-cart', primaryCart);
}
exports.initialize = initialize;
function primaryCart() {
    return __awaiter(this, void 0, void 0, function () {
        var panel, selectedDB;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!config_1.default.haveCART) {
                        throw new Error('Trying to use CART features when it is not currently enabled');
                    }
                    panel = panels.findByChild(this);
                    if (!panel) {
                        panel = panels.getRoot();
                    }
                    selectedDB = getSelectedSourceDB();
                    if (selectedDB.contains) {
                        alert(config_1.default.textAmbiguousCartTerm);
                        throw new Error('Ambiguous term selected for viewing primary cart');
                    }
                    return [4, cart.showContents(panel, sam.cart.getPrimaryCartID(selectedDB.code), selectedDB.code)];
                case 1:
                    _a.sent();
                    return [4, events_1.default.emit('action.primary-cart.done')];
                case 2:
                    _a.sent();
                    return [2];
            }
        });
    });
}
function getSelectedSourceDB() {
    var searchData = searchPanel.gatherSearchData();
    var srcDBs = srcdb.all();
    if (searchData.server.other.srcdb) {
        for (var _i = 0, srcDBs_1 = srcDBs; _i < srcDBs_1.length; _i++) {
            var db = srcDBs_1[_i];
            if (db.code === searchData.server.other.srcdb) {
                return db;
            }
        }
    }
    return srcDBs[0];
}

},
'fose/client/builtin-actions/reset-search': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var searchPanel = _lfreq_('fose/client/builtin-panels/search');
var panels = _lfreq_('fose/client/panels');
function resetSearch() {
    var srcPanel = panels.findByChild(this);
    if (!srcPanel) {
        throw new Error('The reset-search action must originate from a Panel');
    }
    if (srcPanel.previous) {
        if (panels.isRoot(srcPanel.previous)) {
            searchPanel.reset();
        }
    }
    panels.remove(srcPanel);
}
function initialize() {
    actions.handle('reset-search', resetSearch);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/results-calendar': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var calendarPanel = _lfreq_('fose/client/builtin-panels/calendar');
var config_1 = _lfreq_('fose/client/config');
var panels = _lfreq_('fose/client/panels');
function initialize() {
    actions.handle('results-calendar', resultsCalendar);
}
exports.initialize = initialize;
function resultsCalendar() {
    return __awaiter(this, void 0, void 0, function () {
        var srcPanel, newPanel, results, findMapping, _i, results_1, result, srcdb, _a, keyField, keyValues, _b, _c, keyValue, rawData, _d, _e, result, mapKey;
        return __generator(this, function (_f) {
            switch (_f.label) {
                case 0:
                    srcPanel = panels.findByChild(this);
                    if (!srcPanel) return [3, 2];
                    newPanel = panels.insert(calendarPanel.KIND, srcPanel);
                    results = srcPanel.data().server.results;
                    findMapping = {};
                    for (_i = 0, results_1 = results; _i < results_1.length; _i++) {
                        result = results_1[_i];
                        if (result.matched) {
                            srcdb = result.data.srcdb;
                            _a = result.matched.split(':'), keyField = _a[0], keyValues = _a[1];
                            for (_b = 0, _c = keyValues.split(','); _b < _c.length; _b++) {
                                keyValue = _c[_b];
                                findMapping[srcdb + ":" + keyValue] = {
                                    key: keyField + ":" + keyValue,
                                    srcdb: srcdb,
                                    group: result.group
                                };
                            }
                        }
                    }
                    rawData = srcPanel.rawDataClone();
                    for (_d = 0, _e = rawData.server.results; _d < _e.length; _d++) {
                        result = _e[_d];
                        mapKey = result.srcdb + ":" + result[config_1.default.collapse.keyField];
                        result.mapping = findMapping[mapKey];
                    }
                    return [4, newPanel.render(rawData)];
                case 1:
                    _f.sent();
                    newPanel.focus();
                    _f.label = 2;
                case 2: return [2];
            }
        });
    });
}

},
'fose/client/builtin-actions/search': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var resultsPanel = _lfreq_('fose/client/builtin-panels/results');
var searchPanel = _lfreq_('fose/client/builtin-panels/search');
var config_1 = _lfreq_('fose/client/config');
var events_1 = _lfreq_('fose/client/events');
var panels = _lfreq_('fose/client/panels');
var searchAPI = _lfreq_('fose/client/server-api/search');
var lastSearchData = '';
function hasChanges(searchData) {
    return lastSearchData !== JSON.stringify(searchData);
}
function isEmpty(searchData) {
    return searchData.server.criteria.length === 0;
}
function search(el, options) {
    return __awaiter(this, void 0, void 0, function () {
        var srcPanel, searchData, newPanel, response, ex_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    srcPanel = panels.findByChild(el);
                    if (!srcPanel) return [3, 9];
                    searchData = searchPanel.gatherSearchData();
                    if (!options.shouldContinue(srcPanel, searchData)) {
                        return [2];
                    }
                    return [4, events_1.default.emit('action.search.gathered', searchData)];
                case 1:
                    _a.sent();
                    lastSearchData = JSON.stringify(searchData);
                    newPanel = panels.insert(resultsPanel.KIND, srcPanel);
                    _a.label = 2;
                case 2:
                    _a.trys.push([2, 5, 7, 9]);
                    return [4, searchAPI.executeOn(searchData.server)];
                case 3:
                    response = _a.sent();
                    return [4, newPanel.render({
                            client: searchData.client,
                            server: response
                        })];
                case 4:
                    _a.sent();
                    return [3, 9];
                case 5:
                    ex_1 = _a.sent();
                    return [4, newPanel.render({ error: ex_1 })];
                case 6:
                    _a.sent();
                    lastSearchData = '';
                    throw ex_1;
                case 7:
                    if (!options.keepFocus) {
                        newPanel.focus();
                    }
                    return [4, events_1.default.emit('action.search.done')];
                case 8:
                    _a.sent();
                    return [7];
                case 9: return [2];
            }
        });
    });
}
function searchOnClick() {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            return [2, search(this, {
                    shouldContinue: function (panel, data) {
                        if (panel.nextIsKind(resultsPanel.KIND)) {
                            var nextPanel = panel.next;
                            var panelData = nextPanel.data();
                            if (!panelData.client.cart && !hasChanges(data)) {
                                return false;
                            }
                        }
                        if (isEmpty(data)) {
                            alert(config_1.default.textTooBroad || 'Search too broad, please use the search fields to narrow your results');
                            return false;
                        }
                        return true;
                    }
                })];
        });
    });
}
function searchOnChange() {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            return [2, search(this, {
                    shouldContinue: function (panel, data) {
                        return panel.nextIsKind(resultsPanel.KIND) && !isEmpty(data);
                    },
                    keepFocus: true
                })];
        });
    });
}
function initialize() {
    actions.handle('search', searchOnClick);
    actions.handle('live-search', searchOnChange);
}
exports.initialize = initialize;

},
'fose/client/builtin-actions/show-cart-add': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var config_1 = _lfreq_('fose/client/config');
var events_1 = _lfreq_('fose/client/events');
var panels = _lfreq_('fose/client/panels');
var dom = _lfreq_('fose/client/util/dom');
function initialize() {
    actions.handle('show-cart-add', showCartAdd);
}
exports.initialize = initialize;
function showCartAdd() {
    return __awaiter(this, void 0, void 0, function () {
        var panel, tray, data, term, templateData;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    panel = panels.findByChild(this);
                    if (!panel) return [3, 3];
                    return [4, panel.insertTray()];
                case 1:
                    tray = _a.sent();
                    tray.onDOMEvent('change', handleChange);
                    data = panel.data();
                    term = data.client.srcdb;
                    templateData = {
                        term: term,
                        item: data.server,
                        client: data.client,
                        id: tray.id,
                        carts: sam.cart.allWriteable(term),
                        otherFields: '',
                        config: config_1.default
                    };
                    return [4, events_1.default.emit('tray.cart-add.beforeRender', templateData)];
                case 2:
                    _a.sent();
                    tray.show(stache.render('trayCartAdd', templateData));
                    _a.label = 3;
                case 3: return [2];
            }
        });
    });
}
function handleChange(event) {
    var target = event.target;
    if (dom.matches(target, 'select.which-cart')) {
        var inputContainer = dom.mustFindIn(this, '.which-cart-name');
        var input = dom.mustFindIn(this, 'input.which-cart');
        var select = target;
        if (select.value === '') {
            inputContainer.classList.remove('hidden');
            input.focus();
        }
        else {
            inputContainer.classList.add('hidden');
            input.value = '';
        }
    }
}

},
'fose/client/builtin-actions/show-cart-remove': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var config_1 = _lfreq_('fose/client/config');
var panels = _lfreq_('fose/client/panels');
function initialize() {
    actions.handle('show-cart-remove', showCartRemove);
}
exports.initialize = initialize;
function showCartRemove() {
    return __awaiter(this, void 0, void 0, function () {
        var panel, tray, data, term_1, containingCarts, templateData;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    panel = panels.findByChild(this);
                    if (!panel) return [3, 2];
                    return [4, panel.insertTray()];
                case 1:
                    tray = _a.sent();
                    data = panel.data();
                    term_1 = data.client.srcdb;
                    containingCarts = sam.cart.containing(term_1, data.server.crn).filter(function (cart) {
                        return !sam.cart.isReadOnly(cart.id, term_1);
                    });
                    templateData = {
                        term: term_1,
                        item: data.server,
                        client: data.client,
                        id: tray.id,
                        carts: containingCarts,
                        config: config_1.default
                    };
                    tray.show(stache.render('trayCartRemove', templateData));
                    _a.label = 2;
                case 2: return [2];
            }
        });
    });
}

},
'fose/client/builtin-actions/tray-remove': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var trays = _lfreq_('fose/client/panel/tray');
function initialize() {
    actions.handle('tray-remove', trayRemove);
}
exports.initialize = initialize;
function trayRemove() {
    var tray = trays.findByChild(this);
    if (tray) {
        tray.remove();
    }
}

},
'fose/client/builtin-filters/counts-to-string': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = _lfreq_('fose/client/config');
function countsToString(counts, field) {
    if (!Array.isArray(counts)) {
        return counts;
    }
    var parts = [];
    counts.forEach(function (count) {
        var name = count[0], amount = count[1];
        var key = field + ":" + name;
        var mapping = config_1.default.codeMapping[key];
        if (mapping) {
            name = amount === 1 ? mapping.singular : mapping.plural;
        }
        parts.push(count[1] + " " + name);
    });
    return parts.join(', ');
}
function initialize() {
    stache.filter('countsToString', countsToString);
}
exports.initialize = initialize;

},
'fose/client/builtin-filters/srcdb': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var srcdb = _lfreq_('fose/client/srcdb');
function initialize() {
    stache.filter('srcdbName', srcdb.name);
    stache.filter('srcdbShortName', srcdb.shortName);
}
exports.initialize = initialize;

},
'fose/client/builtin-filters/string': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function toLowerCase(value) {
    if (typeof value === 'string') {
        return value.toLowerCase();
    }
    return value;
}
function toUpperCase(value) {
    if (typeof value === 'string') {
        return value.toUpperCase();
    }
    return value;
}
function initialize() {
    stache.filter('toLowerCase', toLowerCase);
    stache.filter('toUpperCase', toUpperCase);
}
exports.initialize = initialize;

},
'fose/client/builtin-panels/calendar': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var resultsPanel = _lfreq_('fose/client/builtin-panels/results');
var config_1 = _lfreq_('fose/client/config');
var panelKind = _lfreq_('fose/client/panel/kind');
var searchAPI = _lfreq_('fose/client/server-api/search');
var dom = _lfreq_('fose/client/util/dom');
var screen = _lfreq_('fose/client/util/screen');
exports.KIND = 'calendar';
var SELECTOR_VIEWING = '.calendar-viewing';
var SELECTOR_MESSAGE = '.calendar-message';
var SELECTOR_TERM = '.calendar-term';
var SELECTOR_CALENDAR = '.calendar';
var SELECTOR_TERM_CALENDAR = '.termcalendar';
function initialize() {
    panelKind.register({
        name: exports.KIND,
        is2x: true,
        prepareData: prepareData,
        drawHead: drawHead,
        drawInfoBar: drawInfoBar,
        drawBody: drawBody,
        onDrawDone: onDrawDone
    });
}
exports.initialize = initialize;
function getCartSections(data) {
    return __awaiter(this, void 0, void 0, function () {
        var crns_1, searchData, response;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!config_1.default.haveCART) return [3, 2];
                    crns_1 = sam.cart.contents(sam.cart.getPrimaryCartID(data.server.srcdb), data.server.srcdb).map(function (item) {
                        return item.crn;
                    });
                    if (config_1.default.cartShowRegistered) {
                        sam.record.registeredSections(data.server.srcdb).forEach(function (crn) {
                            crns_1.push(crn);
                        });
                    }
                    if (config_1.default.cartShowWaitlist) {
                        sam.record.waitlistSections(data.server.srcdb).forEach(function (crn) {
                            crns_1.push(crn);
                        });
                    }
                    if (!crns_1.length) return [3, 2];
                    searchData = {
                        criteria: [{ field: 'crn', value: crns_1.join(',') }],
                        other: { srcdb: data.server.srcdb }
                    };
                    return [4, searchAPI.executeOn(searchData)];
                case 1:
                    response = _a.sent();
                    return [2, response.results];
                case 2: return [2, []];
            }
        });
    });
}
function prepareData(data) {
    return __awaiter(this, void 0, void 0, function () {
        var tbaSections, _i, _a, result, _b;
        return __generator(this, function (_c) {
            switch (_c.label) {
                case 0:
                    tbaSections = [];
                    for (_i = 0, _a = data.server.results; _i < _a.length; _i++) {
                        result = _a[_i];
                        if (result.mpkey === '1') {
                            tbaSections.push(result);
                        }
                    }
                    data.client.tbaSections = tbaSections;
                    _b = data.server;
                    return [4, getCartSections(data)];
                case 1:
                    _b.cartSections = _c.sent();
                    return [2, data];
            }
        });
    });
}
function drawHead(panel, data) {
    return stache.render('calendarHead', { config: config_1.default });
}
function drawBody(panel, data) {
    return stache.render('calendarBody', {
        tbaSections: data.client.tbaSections,
        config: config_1.default
    });
}
function drawInfoBar(panel, data) {
    var isPhone = screen.isPhone();
    return stache.render('calendarInfoBar', {
        isPhone: isPhone
    });
}
function onDrawDone(panel, data) {
    var stash = panel.stash();
    stash.calendar = void 0;
    stash.termcal = void 0;
    if (!screen.isPhone() && config_1.default.displayTermCal === true) {
        setTermCal(panel);
    }
    var sections = redrawCalendar(panel);
    redrawTermCalendar(panel);
    if (stash.viewing) {
        sectionClicked(panel, sections, stash.viewing);
    }
}
function sectionMouseover(data, panel) {
    if (!screen.isPhone()) {
        var previous = panel.previous;
        if (previous && previous.isKind(resultsPanel.KIND)) {
            resultsPanel.scrollIntoView(previous, data.mapping);
        }
    }
    emphasizeCalendar(dom.mustFindIn(panel.content, SELECTOR_CALENDAR), data.crn);
    var termCalEl = dom.findIn(panel.content, SELECTOR_TERM_CALENDAR);
    if (termCalEl) {
        emphasizeTermCalendar(termCalEl, data.crn);
    }
    try {
        var stash = panel.stash();
        var termCalObj = stash.termcal;
        if (termCalObj) {
            setTermCalViewing(stash.termcal, data.crn, termCalObj.TRANSITION_DURATION);
        }
    }
    catch (ex) {
        console.log(ex);
    }
}
function sectionMouseout(data, panel) {
    if (!screen.isPhone()) {
        var previous = panel.previous;
        if (previous && previous.isKind(resultsPanel.KIND)) {
            resultsPanel.clearViewing(previous);
        }
    }
    demphasizeCalendar(dom.mustFindIn(panel.content, SELECTOR_CALENDAR));
    var termCalEl = dom.findIn(panel.content, SELECTOR_TERM_CALENDAR);
    if (termCalEl) {
        demphasizeTermCalendar(termCalEl);
    }
    try {
        var stash = panel.stash();
        var termCalObj = stash.termcal;
        if (termCalObj) {
            stopTermCalViewing(stash.termcal);
        }
    }
    catch (ex) {
        console.log(ex);
    }
}
function termSectMouseover(data, panel) {
    if (!screen.isPhone()) {
        var previous = panel.previous;
        if (previous && previous.isKind(resultsPanel.KIND)) {
            resultsPanel.scrollIntoView(previous, data.mapping);
        }
    }
    emphasizeCalendar(dom.mustFindIn(panel.content, SELECTOR_CALENDAR), data.crn);
    var termCalEl = dom.findIn(panel.content, SELECTOR_TERM_CALENDAR);
    if (termCalEl) {
        emphasizeTermCalendar(termCalEl, data.crn);
    }
}
function termSectMouseout(data, panel) {
    if (!screen.isPhone()) {
        var previous = panel.previous;
        if (previous && previous.isKind(resultsPanel.KIND)) {
            resultsPanel.clearViewing(previous);
        }
    }
    demphasizeCalendar(dom.mustFindIn(panel.content, SELECTOR_CALENDAR));
    var termCalEl = dom.findIn(panel.content, SELECTOR_TERM_CALENDAR);
    if (termCalEl) {
        demphasizeTermCalendar(termCalEl);
    }
}
function termSectFocusin(data, panel) {
    if (!screen.isPhone()) {
        var previous = panel.previous;
        if (previous && previous.isKind(resultsPanel.KIND)) {
            resultsPanel.scrollIntoView(previous, data.mapping);
        }
    }
    emphasizeCalendar(dom.mustFindIn(panel.content, SELECTOR_CALENDAR), data.crn);
    var termCalEl = dom.findIn(panel.content, SELECTOR_TERM_CALENDAR);
    if (termCalEl) {
        emphasizeTermCalendar(termCalEl, data.crn);
    }
    try {
        var stash = panel.stash();
        var termCalObj = stash.termcal;
        if (termCalObj) {
            setTermCalViewing(stash.termcal, data.crn, 0);
        }
    }
    catch (ex) {
        console.log(ex);
    }
}
function updateCalMessage(message, panel) {
    var el = dom.mustFindIn(panel.content, SELECTOR_MESSAGE);
    el.innerHTML = message;
}
function clearCalMessage(panel) {
    var el = dom.mustFindIn(panel.content, SELECTOR_MESSAGE);
    el.innerHTML = '<br>';
}
function redrawCalendar(panel, sections) {
    try {
        var stash = panel.stash();
        var panelData = panel.data();
        var calendarOptions = {
            cartcourses: panelData.server.cartSections,
            calobj: stash.calendar,
            sectionclick: function (clicked) {
                sectionClicked(panel, sections, clicked);
            },
            mouseover: function (data) {
                sectionMouseover(data, panel);
            },
            mouseout: function (data) {
                sectionMouseout(data, panel);
            },
            updateMessage: function (message) {
                updateCalMessage(message, panel);
            },
            clearMessage: function () {
                clearCalMessage(panel);
            },
            topmargin: 20,
            rightmargin: 30,
            bottommargin: 30,
            leftmargin: 40,
            width: panel.bodyWidth() - 10,
            height: 500,
            labels: false
        };
        if (!sections) {
            var rawData = panel.rawDataClone();
            sections = prepareSections(rawData.server.results, calendarOptions);
        }
        stash.calendar = drawCalendar(dom.mustFindIn(panel.content, SELECTOR_CALENDAR), sections, calendarOptions);
        return sections;
    }
    catch (ex) {
        console.log(ex);
    }
}
function redrawTermCalendar(panel, sections) {
    try {
        var stash = panel.stash();
        var panelData = panel.data();
        var termCalendarEl = dom.findIn(panel.content, SELECTOR_TERM_CALENDAR);
        if (termCalendarEl) {
            var termCalOptions;
            if (screen.isPhone()) {
                termCalOptions = {
                    cartcourses: panelData.server.cartSections,
                    calobj: stash.termcal,
                    topmargin: 30,
                    rightmargin: 10,
                    bottommargin: 35,
                    leftmargin: 0,
                    width: panel.bodyWidth() - 10,
                    height: 15,
                    labels: false
                };
            }
            else {
                termCalOptions = {
                    cartcourses: panelData.server.cartSections,
                    calobj: stash.termcal,
                    mouseover: function (data) {
                        termSectMouseover(data, panel);
                    },
                    mouseout: function (data) {
                        termSectMouseout(data, panel);
                    },
                    focusin: function (data) {
                        termSectFocusin(data, panel);
                    },
                    updateMessage: function (message) {
                        updateCalMessage(message, panel);
                    },
                    clearMessage: function () {
                        clearCalMessage(panel);
                    },
                    topmargin: 30,
                    rightmargin: 15,
                    bottommargin: 35,
                    leftmargin: 0,
                    width: panel.bodyWidth() - 10,
                    height: 75,
                    labels: false
                };
            }
            if (!sections) {
                var rawData = panel.rawDataClone();
                sections = prepareSections(rawData.server.results, termCalOptions);
            }
            stash.termcal = drawTermCalendar(termCalendarEl, sections, termCalOptions);
        }
        return sections;
    }
    catch (ex) {
        console.log(ex);
    }
}
function showAll(panel) {
    if (screen.isPhone()) {
        clearTermCal(panel);
    }
    redrawCalendar(panel);
    redrawTermCalendar(panel);
    clearViewing(panel);
}
exports.showAll = showAll;
function clearViewing(panel) {
    var stash = panel.stash();
    stash.viewing = void 0;
    var el = dom.mustFindIn(panel.content, SELECTOR_VIEWING);
    el.innerHTML = '';
}
function setViewing(panel, clicked) {
    var stash = panel.stash();
    stash.viewing = clicked;
    var el = dom.mustFindIn(panel.content, SELECTOR_VIEWING);
    el.innerHTML = stache.render('calendarViewing', { item: clicked, config: config_1.default });
}
function clearTermCal(panel) {
    var el = dom.mustFindIn(panel.content, SELECTOR_TERM);
    if (el) {
        el.innerHTML = '';
    }
}
function setTermCal(panel) {
    var stash = panel.stash();
    stash.termcal = null;
    var el = dom.mustFindIn(panel.content, SELECTOR_TERM);
    el.innerHTML = stache.render('calendarTerm', { config: config_1.default });
}
function sectionClicked(panel, all, clicked) {
    if (screen.isPhone() && config_1.default.displayTermCal === true) {
        setTermCal(panel);
    }
    redrawCalendar(panel, [clicked]);
    redrawTermCalendar(panel, [clicked]);
    try {
        var stash = panel.stash();
        var termCalObj = stash.termcal;
        if (termCalObj) {
            resetTermCalViewing(termCalObj);
        }
    }
    catch (ex) {
        console.log(ex);
    }
    setViewing(panel, clicked);
}

},
'fose/client/builtin-panels/details': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var resultsPanel = _lfreq_('fose/client/builtin-panels/results');
var config_1 = _lfreq_('fose/client/config');
var notes = _lfreq_('fose/client/notes');
var panelKind = _lfreq_('fose/client/panel/kind');
exports.KIND = 'details';
function initialize() {
    panelKind.register({
        name: exports.KIND,
        is2x: true,
        prepareData: prepareData,
        drawHead: drawHead,
        drawBody: drawBody,
        drawFoot: drawFoot,
        onDrawDone: onDrawDone,
        onRemove: onRemove
    });
}
exports.initialize = initialize;
function prepareData(data) {
    notes.addToItem(data.server);
    if (config_1.default.haveCART) {
        data.server.isCartable = !!data.client.key;
        var term = data.client.srcdb;
        var containingCarts = sam.cart.containing(term, data.server.crn);
        data.server.isInCart = containingCarts.length > 0;
        data.server.isInWriteableCart = false;
        for (var _i = 0, containingCarts_1 = containingCarts; _i < containingCarts_1.length; _i++) {
            var cart = containingCarts_1[_i];
            if (!sam.cart.isReadOnly(cart.id, term)) {
                data.server.isInWriteableCart = true;
            }
        }
    }
    return data;
}
function drawHead(panel, data) {
    return stache.render('detailHead', { item: data.server, config: config_1.default });
}
function drawBody(panel, data) {
    return stache.render('detailBody', { item: data.server, config: config_1.default });
}
function drawFoot(panel, data) {
    return stache.render('detailFoot', {
        item: data.server,
        config: config_1.default
    });
}
function onDrawDone(panel, data) {
    var previous = panel.previous;
    if (previous && previous.isKind(resultsPanel.KIND)) {
        resultsPanel.markViewing(previous, data.client);
    }
}
function onRemove(panel) {
    var previous = panel.previous;
    if (previous && previous.isKind(resultsPanel.KIND)) {
        resultsPanel.clearViewing(previous);
    }
}

},
'fose/client/builtin-panels/results': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var searchPanel = _lfreq_('fose/client/builtin-panels/search');
var config_1 = _lfreq_('fose/client/config');
var notes = _lfreq_('fose/client/notes');
var panelKind = _lfreq_('fose/client/panel/kind');
var collapse_1 = _lfreq_('fose/client/results/collapse');
var rowType = _lfreq_('fose/client/results/row-type');
var srcdb = _lfreq_('fose/client/srcdb');
var array = _lfreq_('fose/client/util/array');
var dom = _lfreq_('fose/client/util/dom');
exports.KIND = 'results';
exports.CLASS_LINK = 'result__link';
var CLASS_LINK_VIEWING = exports.CLASS_LINK + "--viewing";
var SELECTOR_LINK_VIEWING = "." + CLASS_LINK_VIEWING;
function initialize() {
    panelKind.register({
        name: exports.KIND,
        prepareData: prepareData,
        drawPendingHead: drawPendingHead,
        drawHead: drawHead,
        drawInfoBar: drawInfoBar,
        drawBody: drawBody,
        drawFoot: drawFoot
    });
}
exports.initialize = initialize;
function clearViewing(panel) {
    var lastViewing = dom.findIn(panel.element, SELECTOR_LINK_VIEWING);
    if (lastViewing) {
        lastViewing.classList.remove(CLASS_LINK_VIEWING);
        panel.scrollStop();
    }
}
exports.clearViewing = clearViewing;
function markViewing(panel, data) {
    clearViewing(panel);
    if (data) {
        var viewing = findResult(panel, data);
        if (viewing) {
            viewing.classList.add(CLASS_LINK_VIEWING);
        }
    }
}
exports.markViewing = markViewing;
function scrollIntoView(panel, data) {
    if (data) {
        var result = findResult(panel, data);
        if (result) {
            panel.scrollSmooth(result.offsetTop);
            result.classList.add(CLASS_LINK_VIEWING);
        }
    }
}
exports.scrollIntoView = scrollIntoView;
var templateMap = (_a = {},
    _a[rowType.HEADLINE] = 'resultRowHeadline',
    _a[rowType.PART] = 'resultRowPart',
    _a[rowType.META] = 'resultRowMeta',
    _a[rowType.BAR] = 'resultRowBar',
    _a[rowType.WARNING] = 'resultRowWarning',
    _a);
function findResult(panel, data) {
    var selectors = [];
    if (data.key) {
        selectors.push("[data-key=\"" + data.key + "\"][data-srcdb=\"" + data.srcdb + "\"]");
    }
    selectors.push("[data-group=\"" + data.group + "\"][data-matched=\"" + data.matched + "\"][data-srcdb=\"" + data.srcdb + "\"]");
    selectors.push("[data-group=\"" + data.group + "\"][data-srcdb=\"" + data.srcdb + "\"]");
    selectors.push("[data-group=\"" + data.group + "\"]");
    var found;
    for (var _i = 0, selectors_1 = selectors; _i < selectors_1.length; _i++) {
        var selector = selectors_1[_i];
        found = dom.findIn(panel.element, selector);
        if (found) {
            break;
        }
    }
    return found;
}
function prepareCartData(data) {
    var resultsData = {
        client: data.client,
        config: config_1.default,
        server: collapse_1.default(data.server, {
            groupByPrimary: config_1.default.collapse.groupByPrimary,
            groupBySecondary: '',
            keyField: config_1.default.collapse.keyField,
            countFields: '',
            rollupFields: '',
            rollupSomeFields: '',
            rollupEveryFields: '',
            neverCollapse: true,
            noMetaRows: true
        })
    };
    if (data.client.preflight) {
        var preflight = data.client.preflight;
        if (preflight.sections && Object.keys(preflight.sections).length) {
            for (var _i = 0, _a = resultsData.server.results; _i < _a.length; _i++) {
                var result = _a[_i];
                if (preflight.sections[result.data.crn]) {
                    result.data.warnings = preflight.sections[result.data.crn];
                }
            }
        }
        if (preflight.global) {
            for (var _b = 0, _c = preflight.global; _b < _c.length; _b++) {
                var globalError = _c[_b];
                resultsData.server.results.unshift({
                    type: 'w',
                    data: {
                        message: globalError
                    }
                });
            }
        }
    }
    return resultsData;
}
function prepareResultsData(data) {
    var isCombined = srcdb.isCombined(data.server.srcdb);
    var filteredResponse = {
        count: 0,
        srcdb: data.server.srcdb,
        results: []
    };
    var _loop_1 = function (result) {
        var keep = true;
        searchPanel.eachWidget(function (widget) {
            if (!widget.filter(result)) {
                keep = false;
                return false;
            }
        });
        if (keep) {
            result.isCombined = isCombined;
            filteredResponse.count++;
            filteredResponse.results.push(result);
        }
    };
    for (var _i = 0, _a = data.server.results; _i < _a.length; _i++) {
        var result = _a[_i];
        _loop_1(result);
    }
    return {
        client: data.client,
        config: config_1.default,
        server: collapse_1.default(filteredResponse, config_1.default.collapse)
    };
}
function prepareData(data) {
    data.server = notes.addToAll(data.server);
    if (array.isNotEmpty(data.server.results) && 'meets' in data.server.results[0]) {
        data.client.allowCalendar = true;
    }
    var preparedData;
    if (data.client.cart) {
        preparedData = prepareCartData(data);
    }
    else {
        preparedData = prepareResultsData(data);
    }
    notes.pickForResults(preparedData.server.results);
    data.client.canSubmitCart = function (cart) {
        return sam.cart.canSubmit(cart.id, cart.srcdb);
    };
    data.client.isPrimaryCart = function (cart) {
        return sam.cart.isPrimary(cart.id);
    };
    return preparedData;
}
function drawPendingHead(panel) {
    return stache.render('resultPendingHead', { config: config_1.default });
}
function drawHead(panel, data) {
    return stache.render('resultHead', data);
}
function drawFoot(panel, data) {
    return stache.render('resultFoot', data);
}
function drawInfoBar(panel, data) {
    var templateData = {
        client: data.client,
        items: config_1.default.itemName,
        count: data.server.count,
        config: config_1.default
    };
    if (data.server.count !== 1) {
        templateData.items = config_1.default.itemsName;
    }
    return stache.render('resultInfoBar', templateData);
}
function drawBody(panel, data) {
    var html = '';
    if (data.server.count === 0) {
        html = stache.render('resultNoneFound', data);
    }
    else {
        for (var _i = 0, _a = data.server.results; _i < _a.length; _i++) {
            var result = _a[_i];
            html += drawBodyResult(result);
        }
    }
    html += drawBodyCriteria(data.client.descriptions);
    return html;
}
function drawBodyResult(result) {
    var template = templateMap[result.type];
    if (!template) {
        return '';
    }
    result.config = config_1.default;
    return stache.render(template, result);
}
function drawBodyCriteria(descriptions) {
    if (!descriptions || descriptions.length === 0) {
        return '';
    }
    return stache.render('resultCriteria', { criteria: descriptions, config: config_1.default });
}
var _a;

},
'fose/client/builtin-panels/search': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions = _lfreq_('fose/client/actions');
var config_1 = _lfreq_('fose/client/config');
var dom = _lfreq_('fose/client/util/dom');
var url = _lfreq_('fose/client/util/url');
var SELECTOR_SEARCH_FORM = '#search-form';
var SELECTOR_SEARCH_BUTTON = '#search-button';
var baseWidget = {
    init: function () {
    },
    restore: function (parameters) {
        if (this.field in parameters) {
            return dom.setFieldValue(this.el, parameters[this.field]);
        }
        return false;
    },
    gather: function () {
        return baseGather(this);
    },
    filter: function (result) {
        return true;
    }
};
var widgets = [];
var searchRegexes = {};
var searchForm;
var searchButton;
function registerWidget(widget) {
    var element = dom.mustFind(widget.selector);
    var widgetClone = Object.assign({}, baseWidget, widget);
    widgetClone.el = element;
    widgetClone.el.addEventListener('change', handleFieldChange);
    widgets.push(widgetClone);
}
exports.registerWidget = registerWidget;
function baseGather(widget) {
    var value = dom.getFieldValue(widget.el);
    if (value) {
        var description = widget.label;
        var text = dom.getFieldText(widget.el);
        if (text !== description) {
            if (description !== '') {
                description += ': ';
            }
            description += text;
        }
        return {
            description: description,
            criteria: [{
                    field: widget.field,
                    value: value
                }]
        };
    }
}
exports.baseGather = baseGather;
function gatherSearchData() {
    var searchData = {
        client: {},
        server: {
            other: {
                srcdb: ''
            },
            criteria: []
        }
    };
    searchData.client.descriptions = [];
    for (var _i = 0, widgets_1 = widgets; _i < widgets_1.length; _i++) {
        var widget = widgets_1[_i];
        var fieldData = widget.gather();
        if (!fieldData) {
            continue;
        }
        if (fieldData.description) {
            searchData.client.descriptions.push(fieldData.description);
        }
        if (Array.isArray(fieldData.criteria)) {
            for (var _a = 0, _b = fieldData.criteria; _a < _b.length; _a++) {
                var criterion = _b[_a];
                searchData.server.criteria.push(mapFieldValue(criterion));
            }
        }
        if (fieldData.post) {
            for (var key in fieldData.post) {
                if (fieldData.post.hasOwnProperty(key)) {
                    searchData.server.other[key] = fieldData.post[key];
                }
            }
        }
    }
    return searchData;
}
exports.gatherSearchData = gatherSearchData;
function reset() {
    searchForm.reset();
}
exports.reset = reset;
function eachWidget(callback) {
    for (var _i = 0, widgets_2 = widgets; _i < widgets_2.length; _i++) {
        var widget = widgets_2[_i];
        if (callback(widget) === false) {
            break;
        }
    }
}
exports.eachWidget = eachWidget;
function initialize() {
    searchForm = dom.mustFind(SELECTOR_SEARCH_FORM);
    searchButton = dom.mustFind(SELECTOR_SEARCH_BUTTON);
    searchForm.addEventListener('submit', handleFormSubmit);
    if (config_1.default.searchRegexes) {
        var lookupPrefix = 'lookup:';
        var lookupPrefixLength = lookupPrefix.length;
        if (!Array.isArray(config_1.default.searchRegexes)) {
            config_1.default.searchRegexes = [config_1.default.searchRegexes];
        }
        for (var _i = 0, _a = config_1.default.searchRegexes; _i < _a.length; _i++) {
            var searchRegex = _a[_i];
            if (!searchRegexes[searchRegex.appearsIn]) {
                searchRegexes[searchRegex.appearsIn] = [];
            }
            var regex = searchRegex.regex;
            if (regex.indexOf(lookupPrefix) === 0) {
                regex = config_1.default[regex.substr(lookupPrefixLength)];
            }
            searchRegexes[searchRegex.appearsIn].push({
                regex: new RegExp(regex),
                mapsTo: searchRegex.mapsTo
            });
        }
    }
    for (var _b = 0, widgets_3 = widgets; _b < widgets_3.length; _b++) {
        var widget = widgets_3[_b];
        widget.init();
    }
    restoreFromURL();
}
exports.initialize = initialize;
function restoreFromURL() {
    var numRestored = 0;
    var qs = Object.assign({}, url.parseQueryString(document.location.hash), url.parseQueryString(document.location.search.substr(1)));
    for (var _i = 0, widgets_4 = widgets; _i < widgets_4.length; _i++) {
        var widget = widgets_4[_i];
        if (widget.restore(qs)) {
            numRestored++;
        }
    }
    if (numRestored > 0) {
        searchButton.click();
    }
}
function handleFieldChange() {
    actions.trigger('live-search', searchButton);
}
function handleFormSubmit(evt) {
    searchButton.click();
    evt.preventDefault();
    evt.stopPropagation();
}
function mapFieldValue(criterion) {
    var value = criterion.value;
    var field = criterion.field;
    if (searchRegexes[criterion.field]) {
        for (var _i = 0, _a = searchRegexes[criterion.field]; _i < _a.length; _i++) {
            var searchRegex = _a[_i];
            if (searchRegex.regex.exec(value) !== null) {
                field = searchRegex.mapsTo;
                break;
            }
        }
    }
    return {
        field: field,
        value: value
    };
}

},
'fose/client/cart': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var resultsPanel = _lfreq_('fose/client/builtin-panels/results');
var config_1 = _lfreq_('fose/client/config');
var panels = _lfreq_('fose/client/panels');
var searchAPI = _lfreq_('fose/client/server-api/search');
var dom = _lfreq_('fose/client/util/dom');
function showContents(after, cart, srcdb) {
    return __awaiter(this, void 0, void 0, function () {
        var cartContents, crns, preflightCRNs, searchData, newPanel, searchResponse, _a, ex_1;
        return __generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    cartContents = sam.cart.contents(cart, srcdb);
                    crns = [];
                    preflightCRNs = [];
                    cartContents.forEach(function (entry) {
                        crns.push(entry.crn);
                        preflightCRNs.push(entry.crn);
                    });
                    if (config_1.default.cartShowRegistered) {
                        sam.record.registeredSections(srcdb).forEach(function (crn) {
                            crns.push(crn);
                        });
                    }
                    if (config_1.default.cartShowWaitlist) {
                        sam.record.waitlistSections(srcdb).forEach(function (crn) {
                            crns.push(crn);
                        });
                    }
                    searchData = {
                        client: {
                            srcdb: srcdb,
                            cart: {
                                id: cart,
                                name: sam.cart.name(cart, srcdb),
                                srcdb: srcdb,
                                readonly: sam.cart.isReadOnly(cart, srcdb)
                            }
                        },
                        server: {
                            other: {
                                srcdb: srcdb
                            },
                            criteria: [
                                { field: 'crn', value: crns.join(',') }
                            ]
                        }
                    };
                    newPanel = panels.insert(resultsPanel.KIND, after);
                    _b.label = 1;
                case 1:
                    _b.trys.push([1, 6, 8, 9]);
                    return [4, searchAPI.executeOn(searchData.server)];
                case 2:
                    searchResponse = _b.sent();
                    if (!sam.cart.isPrimary(cart)) return [3, 4];
                    _a = searchData.client;
                    return [4, sam.cart.preflight({
                            p_term_code: srcdb,
                            p_crn_list: preflightCRNs.join(',')
                        })];
                case 3:
                    _a.preflight = _b.sent();
                    _b.label = 4;
                case 4: return [4, newPanel.render({
                        client: searchData.client,
                        server: searchResponse
                    })];
                case 5:
                    _b.sent();
                    updateOtherPanels(cart, newPanel, {
                        client: searchData.client,
                        server: searchResponse
                    });
                    return [3, 9];
                case 6:
                    ex_1 = _b.sent();
                    return [4, newPanel.render({ error: ex_1 })];
                case 7:
                    _b.sent();
                    throw ex_1;
                case 8:
                    newPanel.focus();
                    return [7];
                case 9: return [2];
            }
        });
    });
}
exports.showContents = showContents;
function getParameters(element) {
    var params = {
        p_term_code: '',
        p_crn: '',
        p_gmod: '',
        p_meetinfo: '',
        p_cart_name: ''
    };
    var fields = dom.findAllIn(element, 'input, select');
    for (var _i = 0, fields_1 = fields; _i < fields_1.length; _i++) {
        var field = fields_1[_i];
        var key = dom.getAttribute(field, 'data-field');
        var value = dom.getFieldValue(field);
        if (key !== '') {
            if (!(key in params) || params[key] === '') {
                params[key] = value;
            }
        }
    }
    return params;
}
exports.getParameters = getParameters;
function updateOtherPanels(cartID, skip, data) {
    var currentPanel = panels.getRoot();
    while (currentPanel && currentPanel !== skip) {
        if (currentPanel.isKind(resultsPanel.KIND)) {
            var panelData = currentPanel.data();
            if (panelData.client.cart && panelData.client.cart.id === cartID) {
                currentPanel.updateData(data);
            }
        }
        currentPanel = currentPanel.next;
    }
}

},
'fose/client/config': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config = JSON.parse(JSON.stringify(foseConfig));
exports.default = config;
function get(setting) {
    return config[setting];
}
exports.get = get;

},
'fose/client/empty-space': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var dom = _lfreq_('fose/client/util/dom');
var CLASS_EMPTY_SPACE = 'empty-space';
var CLASS_EMPTY_SPACE_HIDDEN = 'empty-space--hidden';
var CLASS_EMPTY_SPACE_REMOVED = 'empty-space--removed';
var SELECTOR_EMPTY_SPACE = "." + CLASS_EMPTY_SPACE;
var VISIBILITY_WAIT = 200;
var emptySpace;
var timeout;
function updateVisibility(count) {
    clearTimeout(timeout);
    if (count > 1) {
        emptySpace.classList.add(CLASS_EMPTY_SPACE_HIDDEN);
    }
    else {
        timeout = setTimeout(function () {
            emptySpace.classList.remove(CLASS_EMPTY_SPACE_REMOVED);
            dom.nextAnimationFrame(function () {
                emptySpace.classList.remove(CLASS_EMPTY_SPACE_HIDDEN);
            });
        }, VISIBILITY_WAIT);
    }
}
exports.updateVisibility = updateVisibility;
function transform(duration, x) {
    emptySpace.style.transitionDuration = duration + "ms";
    emptySpace.style.transform = "translateX(" + x + "px)";
}
exports.transform = transform;
function initialize() {
    emptySpace = dom.mustFind(SELECTOR_EMPTY_SPACE);
    emptySpace.addEventListener('transitionend', handleTransitionEnd);
}
exports.initialize = initialize;
function handleTransitionEnd() {
    if (emptySpace.classList.contains(CLASS_EMPTY_SPACE_HIDDEN)) {
        emptySpace.classList.add(CLASS_EMPTY_SPACE_REMOVED);
    }
}

},
'fose/client/events': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var event_emitter_1 = _lfreq_('fose/client/util/event-emitter');
var events = new event_emitter_1.default();
exports.default = events;

},
'fose/client/fose': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = _lfreq_('fose/client/app');
exports.app = app;
document.addEventListener('DOMContentLoaded', app.initialize);
var actions = _lfreq_('fose/client/actions');
exports.actions = actions;
var search = _lfreq_('fose/client/builtin-panels/search');
exports.search = search;
var events_1 = _lfreq_('fose/client/events');
exports.events = events_1.default;
var panelKind = _lfreq_('fose/client/panel/kind');
exports.panelKind = panelKind;
var panels = _lfreq_('fose/client/panels');
exports.panels = panels;
var serverAPI = _lfreq_('fose/client/server-api');
exports.serverAPI = serverAPI;
var srcdb = _lfreq_('fose/client/srcdb');
exports.srcdb = srcdb;
var dom = _lfreq_('fose/client/util/dom');
exports.dom = dom;

},
'fose/client/init': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = _lfreq_('fose/client/app');
var log_1 = _lfreq_('fose/client/util/log');
function addHandler(handler) {
    log_1.default("init.addHandler(handler) is deprecated; use fose.app.on(fose.app.EVENT_INITIALIZE, handler) instead.");
    app.on(app.EVENT_INITIALIZE, handler);
}
exports.addHandler = addHandler;

},
'fose/client/notes': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = _lfreq_('fose/client/config');
exports.TYPE_CART = 'cart';
exports.TYPE_REGISTERED = 'registered';
exports.TYPE_TAKEN = 'taken';
exports.TYPE_TAKEN_EQUIV = 'taken-equiv';
exports.TYPE_WARN = 'warn';
exports.TYPE_WAITLIST = 'waitlist';
var PICK_PRIORITY = (_a = {},
    _a[exports.TYPE_REGISTERED] = 1,
    _a[exports.TYPE_WAITLIST] = 2,
    _a[exports.TYPE_CART] = 3,
    _a[exports.TYPE_WARN] = 4,
    _a);
var STAT_CANCELED = 'C';
var STAT_FULL = 'F';
function typeToProp(type) {
    var prop = type[0].toUpperCase() + type.substr(1);
    prop = prop.replace(/-([a-z])/gi, function (match, $1) {
        return $1.toUpperCase();
    });
    return "has" + prop + "Note";
}
function addToItem(result) {
    result.notes = [];
    if (config_1.default.haveSAM) {
        if (sam.record.isRegistered(result.srcdb, result.crn)) {
            result.notes.push({
                type: exports.TYPE_REGISTERED,
                text: config_1.default.textRegisteredSection
            });
        }
        if (sam.record.hasTaken(result.code)) {
            result.notes.push({
                type: exports.TYPE_TAKEN,
                text: config_1.default.textCourseTaken
            });
        }
        if (sam.record.hasTakenEquiv(result.code)) {
            result.notes.push({
                type: exports.TYPE_TAKEN_EQUIV,
                text: config_1.default.textCourseTakenEquiv
            });
        }
    }
    if (config_1.default.haveCART) {
        var containingCarts = sam.cart.containing(result.srcdb, result.crn);
        for (var _i = 0, containingCarts_1 = containingCarts; _i < containingCarts_1.length; _i++) {
            var cart = containingCarts_1[_i];
            result.notes.push({
                type: exports.TYPE_CART,
                text: config_1.default.textSectionInCart + ': ' + cart.name
            });
        }
        if (sam.record.isWaitlisted(result.srcdb, result.crn)) {
            var position = sam.record.waitlistPosition(result.srcdb, result.crn);
            var text = position === undefined ? config_1.default.textSectionOnWaitlist :
                config_1.default.textSectionOnWaitlistPosition + ' ' + position;
            result.notes.push({
                type: exports.TYPE_WAITLIST,
                text: text
            });
        }
    }
    switch (result.stat) {
        case STAT_FULL:
            result.notes.push({
                type: exports.TYPE_WARN,
                text: config_1.default.textSectionFull
            });
            break;
        case STAT_CANCELED:
            result.notes.push({
                type: exports.TYPE_WARN,
                text: config_1.default.textSectionCanceled
            });
            break;
    }
    for (var _a = 0, _b = result.notes; _a < _b.length; _a++) {
        var note = _b[_a];
        var prop = typeToProp(note.type);
        result[prop] = true;
    }
    return result;
}
exports.addToItem = addToItem;
function addToAll(data) {
    for (var _i = 0, _a = data.results; _i < _a.length; _i++) {
        var result = _a[_i];
        addToItem(result);
    }
    return data;
}
exports.addToAll = addToAll;
function pickForResults(results) {
    for (var _i = 0, results_1 = results; _i < results_1.length; _i++) {
        var result = results_1[_i];
        if (result.data.notes && result.data.notes.length) {
            result.data.notes.sort(compareNotes);
            if (result.data.notes[0].force) {
                result.data.note = result.data.notes[0];
                continue;
            }
            for (var _a = 0, _b = result.data.notes; _a < _b.length; _a++) {
                var note = _b[_a];
                var prop = typeToProp(note.type);
                if (result.data[prop] && note.type in PICK_PRIORITY) {
                    result.data.note = note;
                    break;
                }
            }
        }
    }
}
exports.pickForResults = pickForResults;
function compareNotes(a, b) {
    if (a.force) {
        return -1;
    }
    if (b.force) {
        return 1;
    }
    var aPriority = PICK_PRIORITY[a.type] || Infinity;
    var bPriority = PICK_PRIORITY[b.type] || Infinity;
    return aPriority - bPriority;
}
var _a;

},
'fose/client/panel': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var events_1 = _lfreq_('fose/client/events');
var tray_1 = _lfreq_('fose/client/panel/tray');
var dom = _lfreq_('fose/client/util/dom');
var event_emitter_1 = _lfreq_('fose/client/util/event-emitter');
var screen = _lfreq_('fose/client/util/screen');
var CLASS_PANEL = 'panel';
var CLASS_PANEL_WIDTH = 'panel--{{multiple}}x';
var CLASS_PANEL_VISIBLE = 'panel--visible';
var CLASS_PANEL_BUSY = 'panel--busy';
var CLASS_PANEL_LEFT = 'panel--left';
var CLASS_BODY = 'panel__body';
var SELECTOR_BODY = "." + CLASS_BODY;
var MULTIPLE_REGEX = /\{\{multiple\}\}/g;
var lastID = 0;
var Panel = (function () {
    function Panel(type, el) {
        if (el === void 0) { el = createElement(); }
        this.events = new event_emitter_1.default();
        this.left = 0;
        this.width = Panel.baseWidth;
        this.isHidden = true;
        this.isPending = true;
        this.isAnimating = false;
        this.id = (lastID++).toString();
        this.element = el;
        this.content = el.firstElementChild;
        this.kind = type;
        this.stashData = {};
        if (type.is2x && type.widthMultiple === 1) {
            type.widthMultiple = 2;
        }
        if (type.widthMultiple !== 1) {
            this.width *= type.widthMultiple;
            var widthClass = type.widthMultiple.toString().replace(/\./g, '_');
            this.element.classList.add(CLASS_PANEL_WIDTH.replace(MULTIPLE_REGEX, widthClass));
        }
        this.element.classList.add(className(this.kind.name));
    }
    Panel.prototype.setLeft = function (left) {
        this.left = left;
        this.element.style.left = left + "px";
        return this;
    };
    Panel.prototype.setPrevious = function (panel) {
        this.previous = panel;
        return this;
    };
    Panel.prototype.setNext = function (panel) {
        this.next = panel;
        return this;
    };
    Panel.prototype.setNextEmpty = function () {
        this.next = void 0;
        return this;
    };
    Panel.prototype.rawDataClone = function () {
        return JSON.parse(JSON.stringify(this.rawData));
    };
    Panel.prototype.bodyWidth = function () {
        var el = dom.findIn(this.element, SELECTOR_BODY);
        if (el) {
            return el.clientWidth;
        }
        return this.content.clientWidth;
    };
    Panel.prototype.data = function () {
        return this.preparedData;
    };
    Panel.prototype.stash = function () {
        return this.stashData;
    };
    Panel.prototype.moveLeft = function () {
        this.element.classList.add(CLASS_PANEL_LEFT);
        return this;
    };
    Panel.prototype.moveRight = function () {
        this.element.classList.remove(CLASS_PANEL_LEFT);
        return this;
    };
    Panel.prototype.isKind = function (typeName) {
        return this.kind.name === typeName;
    };
    Panel.prototype.nextIsKind = function (name) {
        if (this.next) {
            return this.next.isKind(name);
        }
        return false;
    };
    Panel.prototype.placeInto = function (element, after) {
        if (after) {
            element.insertBefore(this.element, after.nextElementSibling);
        }
        else {
            element.appendChild(this.element);
        }
        return this;
    };
    Panel.prototype.focus = function () {
        this.kind.onFocus(this);
    };
    Panel.prototype.markBusy = function () {
        this.element.classList.add(CLASS_PANEL_BUSY);
        return this;
    };
    Panel.prototype.markReady = function () {
        this.element.classList.remove(CLASS_PANEL_BUSY);
        return this;
    };
    Panel.prototype.insertTray = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.tray) return [3, 2];
                        return [4, this.tray.remove()];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        this.tray = new tray_1.default();
                        this.tray.insert(this.content);
                        this.tray.onRemove(function () {
                            _this.tray = undefined;
                        });
                        return [2, this.tray];
                }
            });
        });
    };
    Panel.prototype.scroll = function (to) {
        var el = dom.findIn(this.element, SELECTOR_BODY);
        if (el) {
            el.scrollTop = to;
        }
        return this;
    };
    Panel.prototype.scrollSmooth = function (to, duration) {
        if (duration === void 0) { duration = 1250; }
        var scrollable = dom.findIn(this.element, SELECTOR_BODY);
        if (scrollable) {
            var currTop = scrollable.scrollTop;
            var maxTop = scrollable.scrollHeight - scrollable.offsetHeight;
            var newTop = Math.min(maxTop, to - 200);
            d3.select(scrollable).transition()
                .duration(duration)
                .tween('scroll', scrollTween(currTop, newTop, scrollable));
        }
        return this;
    };
    Panel.prototype.scrollStop = function () {
        var scrollable = dom.findIn(this.element, SELECTOR_BODY);
        if (scrollable) {
            d3.select(scrollable).transition();
        }
    };
    Panel.prototype.show = function () {
        var _this = this;
        this.showTimeout = setTimeout(function () {
            _this.markBusy();
            _this.drawPending();
            _this.makeVisible();
        }, Panel.renderWait);
        return this;
    };
    Panel.prototype.updateData = function (data) {
        this.rawData = data;
    };
    Panel.prototype.render = function (data) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clearTimeout(this.showTimeout);
                        this.isPending = false;
                        if (data) {
                            this.rawData = data;
                        }
                        return [4, this.atRest()];
                    case 1:
                        _a.sent();
                        if (!(data && data.error)) return [3, 2];
                        this.drawError();
                        return [3, 4];
                    case 2: return [4, this.drawReady()];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4:
                        this.markReady();
                        return [2, this.makeVisible()];
                }
            });
        });
    };
    Panel.prototype.remove = function (behind) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var x;
            return __generator(this, function (_a) {
                this.isAnimating = true;
                this.kind.onRemove(this, this.preparedData);
                this.events.emit(2);
                dom.afterTransitionEnd(this.element, function () {
                    _this.isAnimating = false;
                    _this.isHidden = true;
                    dom.nextAnimationFrame(function () {
                        if (_this.element.parentElement) {
                            _this.element.parentElement.removeChild(_this.element);
                        }
                        _this.events.emit(3);
                    });
                });
                if (!screen.isPhone()) {
                    x = (behind.left - this.left) + (behind.width - this.width);
                    this.content.style.transform = "translateX(" + x + "px)";
                }
                else {
                    this.element.classList.remove(CLASS_PANEL_VISIBLE);
                    this.element.classList.remove(CLASS_PANEL_LEFT);
                }
                return [2, this];
            });
        });
    };
    Panel.prototype.atRest = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                if (!this.isAnimating) {
                    return [2, Promise.resolve()];
                }
                return [2, new Promise(function (resolve) {
                        _this.events.once(1, resolve);
                    })];
            });
        });
    };
    Panel.prototype.drawError = function () {
        this.tray = undefined;
        this.preparedData = {};
        this.content.innerHTML = stache.render('panelError', {
            headHTML: this.kind.drawErrorHead(this),
            bodyHTML: this.kind.drawErrorBody(this)
        });
    };
    Panel.prototype.drawReady = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _i, _b, el, hash;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        this.tray = undefined;
                        this.preparedData = {};
                        if (!this.rawData) return [3, 2];
                        _a = this;
                        return [4, this.kind.prepareData(JSON.parse(JSON.stringify(this.rawData)))];
                    case 1:
                        _a.preparedData = _c.sent();
                        _c.label = 2;
                    case 2:
                        events_1.default.emit("panel." + this.kind.name + ".dataPrepared", this.preparedData);
                        this.content.innerHTML = stache.render('panelReady', {
                            headHTML: this.kind.drawHead(this, this.preparedData),
                            infoBarHTML: this.kind.drawInfoBar(this, this.preparedData),
                            bodyHTML: this.kind.drawBody(this, this.preparedData),
                            footHTML: this.kind.drawFoot(this, this.preparedData)
                        });
                        this.kind.onDrawDone(this, this.preparedData);
                        events_1.default.emit("panel." + this.kind.name + ".drawDone", this);
                        for (_i = 0, _b = dom.findAllIn(this.content, '[data-hash=""]'); _i < _b.length; _i++) {
                            el = _b[_i];
                            hash = dom.generateMD5(el, this.id);
                            el.setAttribute('data-hash', hash);
                        }
                        return [2];
                }
            });
        });
    };
    Panel.prototype.drawPending = function () {
        this.tray = undefined;
        if (this.isPending) {
            this.content.innerHTML = stache.render('panelPending', {
                headHTML: this.kind.drawPendingHead(this),
                bodyHTML: this.kind.drawPendingBody(this)
            });
        }
    };
    Panel.prototype.makeVisible = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                if (!this.isHidden) {
                    return [2, Promise.resolve()];
                }
                return [2, new Promise(function (resolve) {
                        _this.isAnimating = true;
                        _this.events.emit(0);
                        dom.afterTransitionEnd(_this.element, function () {
                            _this.isAnimating = false;
                            _this.events.emit(1);
                            resolve();
                        });
                        dom.nextAnimationFrame(function () {
                            _this.isHidden = false;
                            _this.element.classList.add(CLASS_PANEL_VISIBLE);
                            if (_this.previous) {
                                _this.previous.moveLeft();
                            }
                        });
                    })];
            });
        });
    };
    return Panel;
}());
Panel.baseWidth = 350;
Panel.renderWait = 80;
exports.default = Panel;
function className(kindName) {
    return "panel--kind-" + kindName;
}
function createElement() {
    var el = document.createElement('div');
    el.classList.add(CLASS_PANEL);
    el.innerHTML = stache.render('panelContent');
    return el;
}
function scrollTween(start, off, scrollable) {
    return function () {
        var i = d3.interpolateNumber(start, off);
        var e = d3.ease('ease-in');
        return function (t) {
            d3.select(scrollable).property('scrollTop', i(e(t)));
        };
    };
}

},
'fose/client/panel/events': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var PanelEvents;
(function (PanelEvents) {
    PanelEvents[PanelEvents["ShowStart"] = 0] = "ShowStart";
    PanelEvents[PanelEvents["ShowEnd"] = 1] = "ShowEnd";
    PanelEvents[PanelEvents["RemoveStart"] = 2] = "RemoveStart";
    PanelEvents[PanelEvents["RemoveEnd"] = 3] = "RemoveEnd";
})(PanelEvents || (PanelEvents = {}));
exports.default = PanelEvents;

},
'fose/client/panel/kind': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = _lfreq_('fose/client/config');
var base = {
    name: '__base__',
    is2x: false,
    widthMultiple: 1,
    prepareData: function (data) { return data; },
    drawPendingHead: function () { return "<h2>" + (config_1.default.textLoading || 'Loading...') + "</h2>"; },
    drawPendingBody: function () { return ''; },
    drawErrorHead: function () { return stache.render('panelErrorHead', { config: config_1.default }); },
    drawErrorBody: function () { return stache.render('panelErrorBody', { config: config_1.default }); },
    drawHead: function () { return 'Header'; },
    drawInfoBar: function () { return ''; },
    drawBody: function () { return 'Body'; },
    drawFoot: function () { return ''; },
    onDrawDone: function () { },
    onFocus: function (panel) {
        panel.element.firstElementChild.focus();
    },
    onRemove: function () { }
};
var types = {};
function create(panelKind) {
    return Object.assign({}, base, panelKind);
}
exports.create = create;
function register(panelKind) {
    types[panelKind.name] = create(panelKind);
}
exports.register = register;
function fetch(kindName) {
    return types[kindName];
}
exports.fetch = fetch;

},
'fose/client/panel/tray': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var dom = _lfreq_('fose/client/util/dom');
var CLASS_TRAY = 'tray';
var CLASS_TRAY_VISIBLE = CLASS_TRAY + "--visible";
var ATTR_TRAY_ID = 'data-tray-id';
var SELECTOR_FOCUSABLES = 'input, select, a, button';
var activeTrays = {};
var nextID = 1;
var Tray = (function () {
    function Tray() {
        this.id = (nextID++).toString();
        activeTrays[this.id] = this;
    }
    Tray.prototype.insert = function (inside) {
        this.element = document.createElement('div');
        this.element.classList.add(CLASS_TRAY);
        this.element.setAttribute(ATTR_TRAY_ID, this.id);
        inside.appendChild(this.element);
    };
    Tray.prototype.show = function (html) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2, new Promise(function (resolve) {
                        _this.wasFocused = document.activeElement;
                        _this.element.innerHTML = html;
                        dom.nextAnimationFrame(function () {
                            _this.element.classList.add(CLASS_TRAY_VISIBLE);
                        });
                        dom.afterTransitionEnd(_this.element, function () {
                            var focusable = dom.findIn(_this.element, SELECTOR_FOCUSABLES);
                            if (focusable) {
                                focusable.focus();
                            }
                            resolve();
                        });
                    })];
            });
        });
    };
    Tray.prototype.onRemove = function (handler) {
        this.removeHandler = handler;
    };
    Tray.prototype.onDOMEvent = function (event, handler) {
        this.element.addEventListener(event, handler);
    };
    Tray.prototype.remove = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2, new Promise(function (resolve) {
                        dom.afterTransitionEnd(_this.element, function () {
                            if (_this.element.parentElement) {
                                _this.element.parentElement.removeChild(_this.element);
                            }
                            resolve();
                        });
                        if (_this.wasFocused) {
                            _this.wasFocused.focus();
                        }
                        _this.element.classList.remove(CLASS_TRAY_VISIBLE);
                        delete activeTrays[_this.id];
                        if (_this.removeHandler) {
                            _this.removeHandler();
                        }
                    })];
            });
        });
    };
    return Tray;
}());
exports.default = Tray;
function findByElement(el) {
    var id = dom.getAttribute(el, ATTR_TRAY_ID);
    if (id && activeTrays[id]) {
        return activeTrays[id];
    }
}
exports.findByElement = findByElement;
function findByChild(child) {
    var current = child;
    while (current && current !== document.body) {
        if (current.hasAttribute(ATTR_TRAY_ID)) {
            return findByElement(current);
        }
        current = current.parentElement;
    }
}
exports.findByChild = findByChild;

},
'fose/client/panels': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var emptySpace = _lfreq_('fose/client/empty-space');
var panel_1 = _lfreq_('fose/client/panel');
var panelKind = _lfreq_('fose/client/panel/kind');
var dom = _lfreq_('fose/client/util/dom');
var screen = _lfreq_('fose/client/util/screen');
var CLASS_CONTAINER = 'panels';
var SELECTOR_CONTAINER = "." + CLASS_CONTAINER;
var ATTR_PANEL_ID = 'data-panel-id';
var activePanels = {};
var rootPanelKind = {
    name: 'root',
    onFocus: function (panel) {
        panel.scroll(0);
        var element = dom.findIn(panel.element, 'input, select');
        if (!element) {
            element = panel.element.firstElementChild;
        }
        element.focus();
    }
};
var root;
var stack = [];
var container;
var containerX = 0;
function insert(kindName, after) {
    if (after === void 0) { after = last(); }
    var type = panelKind.fetch(kindName);
    if (!type) {
        throw new Error("Unknown panel type: " + kindName);
    }
    var panel;
    if (after.next) {
        if (after.next.isKind(kindName)) {
            panel = after.next;
            removeAfter(panel);
        }
        else {
            remove(after.next);
        }
    }
    if (!panel) {
        panel = new panel_1.default(type)
            .placeInto(container, after.element)
            .setLeft(after.left + after.width)
            .setPrevious(after);
        panel.events.once(0, function () {
            updateContainerX(panel);
        });
        panel.events.once(1, function () {
            after.setNext(panel);
        });
        track(panel);
    }
    panel.show();
    return panel;
}
exports.insert = insert;
function remove(panel) {
    return __awaiter(this, void 0, void 0, function () {
        var previous, current;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (panel === root) {
                        throw new Error('Cannot remove the root panel');
                    }
                    previous = panel.previous;
                    if (!previous) {
                        throw new Error('Panel to be removed has no previous panel');
                    }
                    return [4, panel.atRest()];
                case 1:
                    _a.sent();
                    panel.events.once(3, function () {
                        previous.focus();
                    });
                    current = panel;
                    previous
                        .moveRight()
                        .setNextEmpty();
                    while (current) {
                        current.remove(previous);
                        untrack(current);
                        current = current.next;
                    }
                    updateContainerX(previous);
                    return [2];
            }
        });
    });
}
exports.remove = remove;
function findByElement(el) {
    var id = dom.getAttribute(el, ATTR_PANEL_ID);
    if (id && activePanels[id]) {
        return activePanels[id];
    }
}
exports.findByElement = findByElement;
function findByChild(child) {
    var current = child;
    while (current && current !== document.body) {
        if (current.hasAttribute(ATTR_PANEL_ID)) {
            return findByElement(current);
        }
        current = current.parentElement;
    }
}
exports.findByChild = findByChild;
function getRoot() {
    return root;
}
exports.getRoot = getRoot;
function isRoot(panel) {
    return panel === root;
}
exports.isRoot = isRoot;
function renderAll() {
    return __awaiter(this, void 0, void 0, function () {
        var _i, stack_1, panel;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    _i = 0, stack_1 = stack;
                    _a.label = 1;
                case 1:
                    if (!(_i < stack_1.length)) return [3, 4];
                    panel = stack_1[_i];
                    if (!!isRoot(panel)) return [3, 3];
                    return [4, panel.render()];
                case 2:
                    _a.sent();
                    _a.label = 3;
                case 3:
                    _i++;
                    return [3, 1];
                case 4: return [2];
            }
        });
    });
}
exports.renderAll = renderAll;
function last() {
    return stack[stack.length - 1];
}
function track(panel) {
    panel.element.setAttribute(ATTR_PANEL_ID, panel.id);
    activePanels[panel.id] = panel;
    stack.push(panel);
}
function untrack(panel) {
    delete activePanels[panel.id];
    var newStack = [];
    for (var _i = 0, stack_2 = stack; _i < stack_2.length; _i++) {
        var p = stack_2[_i];
        if (p !== panel) {
            newStack.push(p);
        }
    }
    stack = newStack;
}
function removeAfter(panel) {
    var next = panel.next;
    if (next) {
        remove(next);
    }
}
function updateContainerX(panel) {
    if (panel === void 0) { panel = last(); }
    if (!screen.isPhone() && panel) {
        var maxRight = panel.width + panel.left;
        var windowWidth = screen.getWidth();
        var duration = 300;
        var x = 0;
        if (windowWidth < maxRight) {
            x = maxRight - windowWidth + 40;
        }
        if (x < containerX) {
            duration = 600;
        }
        container.style.transitionDuration = duration + "ms";
        container.style.transform = "translateX(" + -x + "px)";
        emptySpace.transform(duration, x);
        emptySpace.updateVisibility(stack.length);
        containerX = x;
    }
}
function initialize() {
    container = dom.mustFind(SELECTOR_CONTAINER);
    root = new panel_1.default(panelKind.create(rootPanelKind), container.firstElementChild);
    track(root);
    root.focus();
    screen.on(screen.EVENT_RESIZE, updateContainerX);
}
exports.initialize = initialize;

},
'fose/client/results/collapse': function(module, exports, global, _lfreq_) {
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
var rowType = _lfreq_('fose/client/results/row-type');
function makeGroupKey(result, bys) {
    var parts = [];
    for (var _i = 0, bys_1 = bys; _i < bys_1.length; _i++) {
        var by = bys_1[_i];
        if (by in result) {
            parts.push(result[by]);
        }
    }
    return parts.join('-');
}
function makeNextFunction(results, groupByFields) {
    var i = 0;
    var end = results.length - 1;
    var currentGroup = null;
    return function next() {
        var group = [];
        if (i > end) {
            return;
        }
        currentGroup = makeGroupKey(results[i], groupByFields);
        for (var j = i; j < results.length; j++, i++) {
            var groupKey = makeGroupKey(results[i], groupByFields);
            if (groupKey !== currentGroup) {
                break;
            }
            group.push(results[i]);
        }
        return group;
    };
}
function groupRollup(group, result, fields) {
    if (group.data === result) {
        return;
    }
    for (var _i = 0, fields_1 = fields; _i < fields_1.length; _i++) {
        var field = fields_1[_i];
        if (!Array.isArray(group.data[field])) {
            group.data[field] = [group.data[field]];
        }
        group.data[field] = group.data[field].concat(result[field]);
    }
}
function groupRollupSome(group, result, fields) {
    for (var _i = 0, fields_2 = fields; _i < fields_2.length; _i++) {
        var field = fields_2[_i];
        if (field in group.data) {
            group.data[field] = !!group.data[field] || !!result[field];
        }
        else {
            group.data[field] = !!result[field];
        }
    }
}
function groupRollupEvery(group, result, fields) {
    for (var _i = 0, fields_3 = fields; _i < fields_3.length; _i++) {
        var field = fields_3[_i];
        if (field in group.data) {
            group.data[field] = !!group.data[field] && !!result[field];
        }
        else {
            group.data[field] = !!result[field];
        }
    }
}
function groupCount(group, result, fields, map) {
    if (!group.total) {
        group.total = 0;
    }
    group.total++;
    if (!group.counts) {
        group.counts = {};
    }
    for (var _i = 0, fields_4 = fields; _i < fields_4.length; _i++) {
        var field = fields_4[_i];
        if (field in result) {
            var value = result[field];
            var key = field + "-" + value;
            if (!group.counts[field]) {
                group.counts[field] = [];
            }
            if (!map[key]) {
                map[key] = [value, 0];
                group.counts[field].push(map[key]);
            }
            map[key][1]++;
        }
    }
}
function collapseGroup(group, config) {
    if (group.length < 1) {
        return [];
    }
    var first = group[0];
    var total = parseInt(first.total, 10);
    var found = group.length;
    var hasAllResults = isNaN(total) || total <= found;
    var hasMultipleResults = total > 1;
    var shouldCollapse = !config.neverCollapse && config.hasMultipleGroups && hasMultipleResults && hasAllResults;
    var groupMap = {};
    var countMap = {};
    var matched = [];
    var rows = [];
    for (var i = 0; i < group.length; i++) {
        var result = group[i];
        var type = i === 0 ? rowType.HEADLINE : rowType.PART;
        if (shouldCollapse) {
            var groupKey = makeGroupKey(result, config.groupBySecondary);
            if (!groupMap[groupKey]) {
                countMap[groupKey] = {};
                groupMap[groupKey] = {
                    type: type,
                    group: config.groupByPrimary + ":" + result[config.groupByPrimary],
                    counts: {},
                    total: 0,
                    collapsed: true,
                    data: result
                };
                rows.push(groupMap[groupKey]);
            }
            groupCount(groupMap[groupKey], result, config.countFields, countMap[groupKey]);
            groupRollup(groupMap[groupKey], result, config.rollupFields);
            groupRollupSome(groupMap[groupKey], result, config.rollupSomeFields);
            groupRollupEvery(groupMap[groupKey], result, config.rollupEveryFields);
        }
        else {
            rows.push({
                type: type,
                group: config.groupByPrimary + ":" + result[config.groupByPrimary],
                key: config.keyField + ":" + result[config.keyField],
                data: result
            });
        }
        matched.push(result[config.keyField]);
    }
    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {
        var row = rows_1[_i];
        if (row.collapsed && row.total === 1) {
            row.key = config.keyField + ":" + row.data[config.keyField];
        }
        row.matched = config.keyField + ":" + matched.join(',');
    }
    if (!hasAllResults && !config.noMetaRows) {
        rows.push({
            type: rowType.META,
            data: {
                found: found,
                total: total
            }
        });
    }
    return rows;
}
function collapseWithOptions(results, options) {
    var collapsed = {
        count: 0,
        results: []
    };
    if (results.length > 0) {
        var firstResult = results[0];
        var lastResult = results[results.length - 1];
        var groupPrimaryFields = options.groupByPrimary.split(',');
        var config = {
            groupByPrimary: groupPrimaryFields[0],
            groupPrimaryFields: groupPrimaryFields,
            groupBySecondary: options.groupBySecondary ? options.groupBySecondary.split(',') : [],
            countFields: options.countFields ? options.countFields.split(',') : [],
            keyField: options.keyField,
            rollupFields: options.rollupFields ? options.rollupFields.split(',') : [],
            rollupSomeFields: options.rollupSomeFields ? options.rollupSomeFields.split(',') : [],
            rollupEveryFields: options.rollupEveryFields ? options.rollupEveryFields.split(',') : [],
            hasMultipleGroups: false,
            neverCollapse: options.neverCollapse,
            noMetaRows: options.noMetaRows
        };
        var getNextGroup = makeNextFunction(results, config.groupPrimaryFields);
        config.hasMultipleGroups = firstResult[config.groupByPrimary] !== lastResult[config.groupByPrimary];
        while (true) {
            var group = getNextGroup();
            if (!group) {
                break;
            }
            collapsed.count++;
            collapsed.results = collapsed.results.concat(collapseGroup(group, config));
        }
    }
    return collapsed;
}
function collapse(response, options) {
    return collapseWithOptions(response.results, options);
}
exports.default = collapse;

},
'fose/client/results/row-type': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HEADLINE = 'h';
exports.PART = 'p';
exports.META = 'm';
exports.BAR = 'b';
exports.WARNING = 'w';

},
'fose/client/server-api': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = _lfreq_('fose/client/config');
var event_emitter_1 = _lfreq_('fose/client/util/event-emitter');
var url = _lfreq_('fose/client/util/url');
exports.EVENT_ERROR = 'error';
var events = new event_emitter_1.default();
function call(route, postData) {
    return new Promise(function (resolve, reject) {
        function fail(message) {
            events.emit(exports.EVENT_ERROR);
            reject("API call to \"" + route + "\" failed: " + message);
        }
        $.ajax({
            url: url.addQueryParam(config_1.default.apiURL, 'route', route),
            type: 'POST',
            processData: false,
            contentType: 'application/json',
            data: encodeURIComponent(JSON.stringify(postData)),
            dataType: 'json'
        })
            .done(function apiCallDone(data) {
            if (data && data.fatal) {
                fail(data.fatal);
            }
            else {
                resolve(data);
            }
        })
            .fail(function apiCallFail(jqXHR, status, err) {
            fail(err);
        });
    });
}
exports.call = call;
function on(event, handler) {
    events.on(event, handler);
}
exports.on = on;
function once(event, handler) {
    events.once(event, handler);
}
exports.once = once;

},
'fose/client/server-api/details': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var routes = _lfreq_('fose/shared/server-api/routes');
var api = _lfreq_('fose/client/server-api');
function fetchFor(group, key, matched, srcdb) {
    return api.call(routes.DETAILS, { group: group, key: key, srcdb: srcdb, matched: matched });
}
exports.fetchFor = fetchFor;

},
'fose/client/server-api/search': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var routes = _lfreq_('fose/shared/server-api/routes');
var api = _lfreq_('fose/client/server-api');
function executeOn(searchData) {
    return api.call(routes.SEARCH, searchData);
}
exports.executeOn = executeOn;

},
'fose/client/srcdb': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = _lfreq_('fose/client/config');
function all() {
    if (Array.isArray(config_1.default.srcDBs)) {
        return config_1.default.srcDBs;
    }
    return [config_1.default.srcDBs];
}
exports.all = all;
function isCombined(srcdb) {
    for (var _i = 0, _a = all(); _i < _a.length; _i++) {
        var db = _a[_i];
        if (db.code === srcdb) {
            return db.contains !== '';
        }
    }
    return false;
}
exports.isCombined = isCombined;
function name(srcdb) {
    for (var _i = 0, _a = all(); _i < _a.length; _i++) {
        var db = _a[_i];
        if (db.code === srcdb) {
            return db.name;
        }
    }
    return srcdb;
}
exports.name = name;
function shortName(srcdb) {
    for (var _i = 0, _a = all(); _i < _a.length; _i++) {
        var db = _a[_i];
        if (db.code === srcdb) {
            return db.short;
        }
    }
    return srcdb;
}
exports.shortName = shortName;

},
'fose/client/types': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });

},
'fose/client/user': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var dom = _lfreq_('fose/client/util/dom');
var CLASS_USER_NAME = 'user-name';
var SELECTOR_USER_NAME = "." + CLASS_USER_NAME;
function handleLogin() {
    var nameElements = dom.findAll(SELECTOR_USER_NAME);
    for (var i = 0; i < nameElements.length; i++) {
        var element = nameElements[i];
        element.innerText = sam.record.name();
    }
    document.body.classList.remove('user-anon');
    document.body.classList.add('user-authed');
}
exports.handleLogin = handleLogin;

},
'fose/client/util/array': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function isNotEmpty(value) {
    return Array.isArray(value) && value.length > 0;
}
exports.isNotEmpty = isNotEmpty;

},
'fose/client/util/dom': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
function find(selector) {
    var element = document.querySelector(selector);
    if (element) {
        return element;
    }
}
exports.find = find;
function mustFind(selector) {
    var element = find(selector);
    if (!element) {
        throw new Error("Did not find element using selector: " + selector);
    }
    return element;
}
exports.mustFind = mustFind;
function findIn(el, selector) {
    var element = el.querySelector(selector);
    if (element) {
        return element;
    }
}
exports.findIn = findIn;
function mustFindIn(el, selector) {
    var element = findIn(el, selector);
    if (!element) {
        throw new Error("Did not find contained element using selector: " + selector);
    }
    return element;
}
exports.mustFindIn = mustFindIn;
function generateMD5(el, salt) {
    if (salt === void 0) { salt = ''; }
    return md5(salt + el.outerHTML);
}
exports.generateMD5 = generateMD5;
function findAll(selector) {
    return Array.prototype.slice.call(document.querySelectorAll(selector));
}
exports.findAll = findAll;
function findAllIn(el, selector) {
    return Array.prototype.slice.call(el.querySelectorAll(selector));
}
exports.findAllIn = findAllIn;
function afterTransitionEnd(el, callback) {
    el.addEventListener('transitionend', function cb(event) {
        callback();
        event.currentTarget.removeEventListener(event.type, cb);
    });
}
exports.afterTransitionEnd = afterTransitionEnd;
function nextAnimationFrame(callback) {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            return [2, new Promise(function (resolve) {
                    requestAnimationFrame(function () {
                        requestAnimationFrame(function (time) {
                            if (callback) {
                                callback(time);
                            }
                            resolve();
                        });
                    });
                })];
        });
    });
}
exports.nextAnimationFrame = nextAnimationFrame;
function matches(el, selector) {
    return (el.matches || el.msMatchesSelector || el.webkitMatchesSelector).call(el, selector);
}
exports.matches = matches;
function getAttribute(el, attrName) {
    var attr = el.getAttribute(attrName);
    if (attr === null) {
        return '';
    }
    return attr;
}
exports.getAttribute = getAttribute;
function getFieldValue(field) {
    switch (field.tagName.toLowerCase()) {
        case 'input':
            return getInputFieldValue(field);
        case 'select':
            return getSelectFieldValue(field);
        case 'textarea':
            return getTextareaFieldValue(field);
        default:
            return '';
    }
}
exports.getFieldValue = getFieldValue;
function getFieldText(field) {
    switch (field.tagName.toLowerCase()) {
        case 'input':
            return getInputFieldText(field);
        case 'select':
            return getSelectFieldText(field);
        case 'textarea':
            return getTextareaFieldText(field);
        default:
            return '';
    }
}
exports.getFieldText = getFieldText;
function setFieldValue(field, value) {
    switch (field.tagName.toLowerCase()) {
        case 'input':
            return setInputFieldValue(field, value);
        case 'select':
            return setSelectFieldValue(field, value);
        case 'textarea':
            return setTextareaFieldValue(field, value);
        default:
            return false;
    }
}
exports.setFieldValue = setFieldValue;
function setInputFieldValue(field, value) {
    switch (field.type.toLowerCase()) {
        case 'checkbox':
        case 'radio':
            field.checked = field.value === value;
            return field.checked;
        default:
            field.value = value;
            break;
    }
    return true;
}
function getInputFieldValue(field) {
    switch (field.type.toLowerCase()) {
        case 'checkbox':
        case 'radio':
            if (field.checked) {
                return field.value;
            }
            return '';
        default:
            return field.value;
    }
}
function getInputFieldText(field) {
    switch (field.type.toLowerCase()) {
        case 'checkbox':
        case 'radio':
            if (field.id) {
                var label = find("label[for=" + field.id + "]");
                if (label) {
                    return label.innerText;
                }
            }
            return field.value;
        default:
            return field.value;
    }
}
function setSelectFieldValue(field, value) {
    for (var i = 0; i < field.options.length; i++) {
        var option = field.options[i];
        if (option.value === value) {
            option.selected = true;
            return true;
        }
    }
    return false;
}
function getSelectFieldValue(field) {
    if (field.selectedIndex !== -1) {
        var option = field.options[field.selectedIndex];
        return option.value;
    }
    return '';
}
function getSelectFieldText(field) {
    if (field.selectedIndex !== -1) {
        var option = field.options[field.selectedIndex];
        return option.text;
    }
    return '';
}
function setTextareaFieldValue(field, value) {
    field.value = value;
    return true;
}
function getTextareaFieldValue(field) {
    return field.value;
}
function getTextareaFieldText(field) {
    return getTextareaFieldValue(field);
}

},
'fose/client/util/event-emitter': function(module, exports, global, _lfreq_) {
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter = (function () {
    function EventEmitter() {
        this.handlers = {};
    }
    EventEmitter.prototype.on = function (event, handler) {
        this.add(event, handler, false);
    };
    EventEmitter.prototype.once = function (event, handler) {
        this.add(event, handler, true);
    };
    EventEmitter.prototype.emit = function (event) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        return __awaiter(this, void 0, void 0, function () {
            var _i, _a, handler, _b, _c, handler;
            return __generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        if (!this.handlers[event]) return [3, 9];
                        _i = 0, _a = this.handlers[event].every;
                        _d.label = 1;
                    case 1:
                        if (!(_i < _a.length)) return [3, 4];
                        handler = _a[_i];
                        return [4, handler.apply(window, args)];
                    case 2:
                        _d.sent();
                        _d.label = 3;
                    case 3:
                        _i++;
                        return [3, 1];
                    case 4:
                        _b = 0, _c = this.handlers[event].once;
                        _d.label = 5;
                    case 5:
                        if (!(_b < _c.length)) return [3, 8];
                        handler = _c[_b];
                        return [4, handler.apply(window, args)];
                    case 6:
                        _d.sent();
                        _d.label = 7;
                    case 7:
                        _b++;
                        return [3, 5];
                    case 8:
                        this.handlers[event].once = [];
                        _d.label = 9;
                    case 9: return [2];
                }
            });
        });
    };
    EventEmitter.prototype.add = function (event, handler, once) {
        if (!this.handlers[event]) {
            this.handlers[event] = {
                once: [],
                every: []
            };
        }
        if (once) {
            this.handlers[event].once.push(handler);
        }
        else {
            this.handlers[event].every.push(handler);
        }
    };
    return EventEmitter;
}());
exports.default = EventEmitter;

},
'fose/client/util/log': function(module, exports, global, _lfreq_) {
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
function log(message) {
    var optionalParams = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        optionalParams[_i - 1] = arguments[_i];
    }
    if (console) {
        console.log.apply(console, arguments);
    }
}
exports.default = log;

},
'fose/client/util/screen': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var event_emitter_1 = _lfreq_('fose/client/util/event-emitter');
exports.EVENT_RESIZE = 'resize';
var WIDTH_PHONE = 768;
var DEBOUNCE_WAIT = 100;
var events = new event_emitter_1.default();
var windowWidth = 0;
var resizeTimeout;
function getWidth() {
    return windowWidth;
}
exports.getWidth = getWidth;
function initialize() {
    updateWindowWidth();
    window.addEventListener('resize', handleWindowResize);
    events.emit(exports.EVENT_RESIZE);
}
exports.initialize = initialize;
function isPhone() {
    return getWidth() <= WIDTH_PHONE;
}
exports.isPhone = isPhone;
function on(event, handler) {
    events.on(event, handler);
}
exports.on = on;
function updateWindowWidth() {
    windowWidth = window.innerWidth;
}
function handleWindowResize() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(function () {
        updateWindowWidth();
        events.emit(exports.EVENT_RESIZE);
    }, DEBOUNCE_WAIT);
}

},
'fose/client/util/seligo': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var screen = _lfreq_('fose/client/util/screen');
var SELECTOR_SELIGO_DESKTOP = '.seligo-desktop';
function initIn(el) {
    if (!screen.isPhone()) {
        $(SELECTOR_SELIGO_DESKTOP, el).seligo();
    }
}
exports.initIn = initIn;

},
'fose/client/util/swipe': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var dom = _lfreq_('fose/client/util/dom');
var event_emitter_1 = _lfreq_('fose/client/util/event-emitter');
var ATTR_SWIPE_KEY = 'data-swipe-key';
var Swipe = (function () {
    function Swipe(el) {
        var _this = this;
        this.events = new event_emitter_1.default();
        this.touchStartCoords = {
            x: -1,
            y: -1
        };
        this.minDistanceXAxis = 30;
        this.maxDistanceYAxis = 30;
        this.maxAllowedTime = 1000;
        this.startTime = 0;
        el.addEventListener('touchstart', function (evt) { return _this.swipeStart(evt); }, false);
        el.addEventListener('touchend', function (evt) { return _this.swipeEnd(evt); }, false);
    }
    Swipe.prototype.swipeStart = function (evt) {
        var touch = evt.changedTouches[0];
        if (touch) {
            this.touchStartCoords.x = touch.pageX;
            this.touchStartCoords.y = touch.pageY;
            this.startTime = Date.now();
        }
    };
    Swipe.prototype.swipeEnd = function (evt) {
        var touch = evt.changedTouches[0];
        if (touch) {
            var touchEndCoords = {
                x: touch.pageX - this.touchStartCoords.x,
                y: touch.pageY - this.touchStartCoords.y
            };
            var elapsedTime = Date.now() - this.startTime;
            if (elapsedTime <= this.maxAllowedTime) {
                if (Math.abs(touchEndCoords.x) >= this.minDistanceXAxis && Math.abs(touchEndCoords.y) <= this.maxDistanceYAxis) {
                    this.events.emit(touchEndCoords.x < 0 ? 'left' : 'right', evt.target);
                }
            }
        }
    };
    return Swipe;
}());
var trackedElements = {};
function track(el) {
    var swipeKey = dom.getAttribute(el, ATTR_SWIPE_KEY);
    if (swipeKey) {
        return trackedElements[swipeKey].events;
    }
    swipeKey = md5(Math.random().toString());
    el.setAttribute(ATTR_SWIPE_KEY, swipeKey);
    var swipe = new Swipe(el);
    trackedElements[swipeKey] = swipe;
    return swipe.events;
}
exports.track = track;

},
'fose/client/util/url': function(module, exports, global, _lfreq_) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function addQueryParam(url, name, value) {
    var append = encodeURIComponent(name) + "=" + encodeURIComponent(value);
    if (url.indexOf('?') === -1) {
        return url + "?" + append;
    }
    return url + "&" + append;
}
exports.addQueryParam = addQueryParam;
function parseQueryString(str) {
    var ret = Object.create(null);
    if (typeof str !== 'string') {
        return ret;
    }
    str = str.trim().replace(/^(\?|#|&)/, '');
    if (!str) {
        return ret;
    }
    str.split('&').forEach(function (param) {
        var parts = param.replace(/\+/g, ' ').split('=');
        var key = decodeURIComponent(parts.shift() || '');
        var val = parts.length > 0 ? decodeURIComponent(parts.join('=')) : true;
        if (ret[key] === undefined) {
            ret[key] = val;
        }
        else if (Array.isArray(ret[key])) {
            ret[key].push(val);
        }
        else {
            ret[key] = [ret[key], val];
        }
    });
    return ret;
}
exports.parseQueryString = parseQueryString;

}}, (typeof global === 'undefined') ? this : global);
if (typeof module !== 'undefined' && module.exports) { module.exports = fose; }


/* Stache templates compiled from config and formbuilder */
stache.register('calendarBody', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSearchResultsSchedules'));
_O_ += "</h3>\u000a<div class=\"section__content\">\u000a<svg class=\"calendar\" role=\"application\"></svg>\u000a</div>\u000a</div>\u000a<div class=\"calendar-term\"></div>\u000a<div class=\"calendar-viewing\"></div>";
if (_RT_.lookup(_D_, 'tbaSections', 'length')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textScheduleTBA'));
_O_ += "</h3>\u000a<div class=\"section__content\">\u000a<div class=\"course-sections\" role=\"grid\" aria-readonly=\"true\">";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'tbaSections'));
var _tba = null;
while ((_tba = _loop1.next()) !== null) {
_O_ += "<a role=\"row\" href=\"#\" class=\"course-section\" data-action=\"result-detail\" data-group=\"code:";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'code'));
_O_ += "\" data-srcdb=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'srcdb'));
_O_ += "\" data-key=\"crn:";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'crn'));
_O_ += "\">\u000a<div role=\"rowheader\" class=\"course-section-course\"><span class=\"header-text\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCourse'));
_O_ += ": </span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'code'));
_O_ += "</div>\u000a<div role=\"gridcell\" class=\"course-section-section-no\"><span class=\"header-text\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSectionNumber'));
_O_ += ": </span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'no'));
_O_ += "</div>\u000a<div role=\"gridcell\" class=\"course-section-schd\"><span class=\"header-text\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textMeets'));
_O_ += ": </span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'schd'));
_O_ += "</div>\u000a<div role=\"gridcell\" class=\"course-section-instr\"><span class=\"header-text\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textInstructor'));
_O_ += ": </span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_tba, 'instr'));
_O_ += "</div>\u000a</a>";
}
_O_ += "</div>\u000a</div>\u000a</div>";
}
_O_ += "";
return _O_;
});

stache.register('calendarHead', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<h2>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCalendar'));
_O_ += "</h2>\u000a\u000a";
return _O_;
});

stache.register('calendarViewing', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"section\">\u000a<h4 class=\"section__title\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSelectedSection'));
_O_ += "</h4>\u000a<div class=\"section__content\">\u000a<div class=\"calendar_viewing\">\u000a<div class=\"calendar_viewing__course\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'code'));
_O_ += " ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'no'));
_O_ += "</div>\u000a<div class=\"calendar_viewing__meets\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'meets'));
_O_ += "</div>\u000a<div class=\"calendar_viewing__instr\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'instr'));
_O_ += "</div>\u000a</div>\u000a<div class=\"calendar__buttons\">\u000a<button class=\"btn\" data-action=\"calendar-show-all\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textShowAll'));
_O_ += "</button>\u000a</div>\u000a</div>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('detailFoot', function (_D_, _RT_) {
'use strict';
var _O_ = '';
if (_RT_.lookup(_D_, 'item', 'isCartable')) {
_O_ += "<div class=\"button-bar button-bar--right-align\">";
if (_RT_.lookup(_D_, 'item', 'isInWriteableCart')) {
_O_ += "<button class=\"btn\" data-action=\"show-cart-remove\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textRemoveFromCart'));
_O_ += "</button>";
}
_O_ += "<button class=\"btn\" data-hash=\"\" data-action=\"login,show-cart-add\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textAddToCart'));
_O_ += "</button>\u000a</div>";
}
_O_ += "";
return _O_;
});

stache.register('detailHead', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<h2>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'code'));
_O_ += " <span class=\"sr-only\">Details</span></h2>\u000a\u000a";
return _O_;
});

stache.register('panelContent', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"panel__content\" tabindex=\"0\"></div>\u000a\u000a";
return _O_;
});

stache.register('panelError', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"panel__head\">\u000a<a href=\"#\" class=\"panel__back icon-link\" data-action=\"panel-back\" aria-label=\"Back\">\u000a<i class=\"fa fa-caret-left\" aria-hidden=\"true\"></i>\u000a</a>\u000a";
_O_ += _RT_.lookup(_D_, 'headHTML');
_O_ += "\u000a</div>\u000a<div class=\"panel__body\">\u000a";
_O_ += _RT_.lookup(_D_, 'bodyHTML');
_O_ += "\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('panelErrorBody', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"error-message\">\u000a<i class=\"fa fa-exclamation-circle error-message__icon\" aria-hidden=\"true\"></i>\u000a<div class=\"error-message__text\">\u000a";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCouldNotProcessRequest'));
_O_ += "\u000a</div>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('panelErrorHead', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<h2>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textError'));
_O_ += "</h2>\u000a\u000a";
return _O_;
});

stache.register('panelPending', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"panel__head\">\u000a";
_O_ += _RT_.lookup(_D_, 'headHTML');
_O_ += "\u000a</div>\u000a<div class=\"panel__body\">\u000a";
_O_ += _RT_.lookup(_D_, 'bodyHTML');
_O_ += "\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('panelReady', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"panel__head\">\u000a<a href=\"#\" class=\"panel__back icon-link\" data-action=\"panel-back\" aria-label=\"Back\">\u000a<i class=\"fa fa-caret-left\" aria-hidden=\"true\"></i>\u000a</a>\u000a";
_O_ += _RT_.lookup(_D_, 'headHTML');
_O_ += "\u000a<a href=\"#\" class=\"panel__home icon-link icon-link--labelled\" data-action=\"panel-home\" aria-label=\"Home\">\u000a<i class=\"fa fa-home\" aria-hidden=\"true\"></i>\u000a<span class=\"icon-link__label\">Reset Search</span>\u000a</a>\u000a</div>";
if (_RT_.lookup(_D_, 'infoBarHTML')) {
_O_ += "<div class=\"panel__info-bar\">";
_O_ += _RT_.lookup(_D_, 'infoBarHTML');
_O_ += "</div>";
}
_O_ += "<div class=\"panel__body\">";
_O_ += _RT_.lookup(_D_, 'bodyHTML');
_O_ += "</div>";
if (_RT_.lookup(_D_, 'footHTML')) {
_O_ += "<div class=\"panel__foot\">";
_O_ += _RT_.lookup(_D_, 'footHTML');
_O_ += "</div>";
}
_O_ += "";
return _O_;
});

stache.register('resultCriteria', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"result-criteria\">\u000a<strong>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSearchCriteria'));
_O_ += "</strong>\u000a<ul class=\"result-criteria__list\">";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'criteria'));
var _criterion = null;
while ((_criterion = _loop1.next()) !== null) {
_O_ += "<li class=\"result-criteria__item\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_criterion));
_O_ += "</li>";
}
_O_ += "</ul>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('resultFoot', function (_D_, _RT_) {
'use strict';
var _O_ = '';
if (_RT_.lookup(_D_, 'client', 'cart') && _RT_.lookup(_D_, 'client', 'canSubmitCart')(_RT_.lookup(_D_, 'client', 'cart'))) {
_O_ += "<div class=\"button-bar button-bar--centered\">\u000a<button class=\"btn\" data-action=\"cart-submit\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSubmitSchedule'));
_O_ += "</button>\u000a</div>";
}
_O_ += "";
return _O_;
});

stache.register('resultHead', function (_D_, _RT_) {
'use strict';
var _O_ = '';
if (_RT_.lookup(_D_, 'client', 'cart')) {
_O_ += "<h2>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCartContents'));
_O_ += "</h2>";
} else {
_O_ += "<h2>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSearchResults'));
_O_ += "</h2>";
}
_O_ += "";
if (_RT_.lookup(_D_, 'client', 'allowCalendar')) {
_O_ += "<a href=\"#\" class=\"icon-link icon-link--small\" data-action=\"results-calendar\" aria-label=\"Calendar View\">\u000a<i class=\"fa fa-calendar\" aria-hidden=\"true\"></i>\u000a</a>";
}
_O_ += "";
return _O_;
});

stache.register('resultInfoBar', function (_D_, _RT_) {
'use strict';
var _O_ = '';
if (_RT_.lookup(_D_, 'client', 'cart')) {
_O_ += "<div class=\"panel__info-bar-text\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCart'));
_O_ += ": ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'client', 'cart', 'name'));
_O_ += " (";
_O_ += _RT_.filters['safe'](_RT_.filters['srcdbName'](_RT_.lookup(_D_, 'client', 'cart', 'srcdb')));
_O_ += ")</div>\u000a<a href=\"#\" class=\"panel__info-bar-button\" data-action=\"cart-clear\">";
if (_RT_.lookup(_D_, 'client', 'isPrimaryCart')(_RT_.lookup(_D_, 'client', 'cart'))) {
_O_ += "\u000a";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textClearCart'));
_O_ += "";
} else {
_O_ += "\u000a";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textDeleteCart'));
_O_ += "";
}
_O_ += "</a>";
} else {
_O_ += "<div class=\"panel__info-bar-text\" aria-live=\"polite\">Found <strong>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'count'));
_O_ += "</strong> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'items'));
_O_ += "</div>\u000a<a href=\"#\" class=\"panel__info-bar-button\" data-action=\"reset-search\">\u000a<i class=\"fa fa-home\"></i>\u000a";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textResetSearch'));
_O_ += "\u000a</a>";
}
_O_ += "";
return _O_;
});

stache.register('resultNoneFound', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"panel__fill-text\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textNoResultsFound'));
_O_ += "</div>\u000a\u000a";
return _O_;
});

stache.register('resultPendingHead', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<h2>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSearching'));
_O_ += "</h2>\u000a\u000a";
return _O_;
});

stache.register('resultRowHeadline', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"result result--group-start\">\u000a<a href=\"#\" data-group=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'group'));
_O_ += "\" data-key=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'key'));
_O_ += "\" data-matched=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'matched'));
_O_ += "\" data-srcdb=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'srcdb'));
_O_ += "\" class=\"result__link\" data-action=\"result-detail\">\u000a<span class=\"result__headline\">";
if (_RT_.lookup(_D_, 'data', 'hasTakenNote') || _RT_.lookup(_D_, 'data', 'hasTakenEquivNote')) {
_O_ += "<span class=\"result__icon\"><i class=\"fa fa-fw icon--taken\" title=\"";
_O_ += _RT_.filters['escattr'](_RT_.lookup(_D_, 'config', 'textCourseTaken'));
_O_ += "\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCourseTaken'));
_O_ += "</span></i></span>";
}
_O_ += "<span class=\"result__code\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'code'));
_O_ += "</span>\u000a<span class=\"result__title\">";
_O_ += _RT_.lookup(_D_, 'data', 'title');
_O_ += "</span>\u000a</span>";
if (_RT_.lookup(_D_, 'data', 'crn')) {
_O_ += "";
if (_RT_.lookup(_D_, 'data', 'warnings')) {
_O_ += "";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'data', 'warnings'));
var _message = null;
while ((_message = _loop1.next()) !== null) {
_O_ += "<span class=\"result__warning\">\u000a<span class=\"result__icon\"><i class=\"fa fa-fw fa-exclamation-triangle\" aria-hidden=\"true\"></i></span>\u000a<span class=\"flex--grow\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_message));
_O_ += "</span>\u000a</span>";
}
_O_ += "";
}
_O_ += "<span class=\"result__part";
if (_RT_.lookup(_D_, 'data', 'isCancelled')) {
_O_ += " result__part--cancelled";
}
_O_ += "\">\u000a<span class=\"result__icon\">";
if (_RT_.lookup(_D_, 'data', 'note')) {
_O_ += "<i class=\"fa fa-fw icon--";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'note', 'type'));
_O_ += "\" title=\"";
_O_ += _RT_.filters['escattr'](_RT_.lookup(_D_, 'data', 'note', 'text'));
_O_ += "\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'note', 'text'));
_O_ += "</span></i>";
} else {
_O_ += "<i class=\"fa fa-fw\"></i>";
}
_O_ += "</span>";
if (_RT_.lookup(_D_, 'data', 'isCombined')) {
_O_ += "<span class=\"result__flex--2\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textTerm'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.filters['srcdbShortName'](_RT_.lookup(_D_, 'data', 'srcdb')));
_O_ += "</span>";
}
_O_ += "";
if (_RT_.lookup(_D_, 'collapsed')) {
_O_ += "<span class=\"flex-grow\">\u000a";
_O_ += _RT_.filters['safe'](_RT_.filters['countsToString'](_RT_.lookup(_D_, 'counts', 'schd'), 'schd'));
_O_ += "\u000a</span>";
} else {
_O_ += "<span class=\"result__flex--3\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSectionNumber'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'no'));
_O_ += "</span>\u000a<span class=\"flex--grow\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textMeets'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'meets'));
_O_ += "</span>\u000a<span class=\"result__flex--9 text--right\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textInstructor'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'instr'));
_O_ += "</span>";
}
_O_ += "</span>";
}
_O_ += "</a>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('resultRowMeta', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"result result--meta\">Matched ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'found'));
_O_ += " of ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'total'));
_O_ += "</div>\u000a\u000a";
return _O_;
});

stache.register('resultRowPart', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"result\">\u000a<a href=\"#\" data-group=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'group'));
_O_ += "\" data-key=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'key'));
_O_ += "\" data-matched=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'matched'));
_O_ += "\" data-srcdb=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'srcdb'));
_O_ += "\" class=\"result__link\" data-action=\"result-detail\">";
if (_RT_.lookup(_D_, 'data', 'warnings')) {
_O_ += "";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'data', 'warnings'));
var _message = null;
while ((_message = _loop1.next()) !== null) {
_O_ += "<span class=\"result__warning\">\u000a<span class=\"result__icon\"><i class=\"fa fa-fw fa-exclamation-triangle\" aria-hidden=\"true\"></i></span>\u000a<span class=\"flex--grow\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_message));
_O_ += "</span>\u000a</span>";
}
_O_ += "";
}
_O_ += "<span class=\"result__part";
if (_RT_.lookup(_D_, 'data', 'isCancelled')) {
_O_ += " result__part--cancelled";
}
_O_ += "\">\u000a<span class=\"result__icon\">";
if (_RT_.lookup(_D_, 'data', 'note')) {
_O_ += "<i class=\"fa fa-fw icon--";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'note', 'type'));
_O_ += "\" title=\"";
_O_ += _RT_.filters['escattr'](_RT_.lookup(_D_, 'data', 'note', 'text'));
_O_ += "\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'note', 'text'));
_O_ += "</span></i>";
} else {
_O_ += "<i class=\"fa fa-fw\"></i>";
}
_O_ += "</span>";
if (_RT_.lookup(_D_, 'data', 'isCombined')) {
_O_ += "<span class=\"result__flex--2\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textTerm'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.filters['srcdbShortName'](_RT_.lookup(_D_, 'data', 'srcdb')));
_O_ += "</span>";
}
_O_ += "";
if (_RT_.lookup(_D_, 'collapsed')) {
_O_ += "<span class=\"flex--grow\">\u000a";
_O_ += _RT_.filters['safe'](_RT_.filters['countsToString'](_RT_.lookup(_D_, 'counts', 'schd'), 'schd'));
_O_ += "\u000a</span>";
} else {
_O_ += "<span class=\"result__flex--3\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textSectionNumber'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'no'));
_O_ += "</span>\u000a<span class=\"flex--grow\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textMeets'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'meets'));
_O_ += "</span>\u000a<span class=\"result__flex--9 text--right\"><span class=\"sr-only\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textInstructor'));
_O_ += ":</span> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'instr'));
_O_ += "</span>";
}
_O_ += "</span>\u000a</a>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('resultRowWarning', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"result result--warning\">\u000a<div class=\"result__icon\"><i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i></div>\u000a<div class=\"flex--grow\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'data', 'message'));
_O_ += "</div>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('trayCartAdd', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<form id=\"add-cart-form\" class=\"add-remove-cart-form\">\u000a<fieldset>\u000a<legend>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'code'));
_O_ += " section ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'section'));
_O_ += " in ";
_O_ += _RT_.filters['safe'](_RT_.filters['srcdbName'](_RT_.lookup(_D_, 'term')));
_O_ += " will be added to your ";
_O_ += _RT_.filters['safe'](_RT_.filters['toLowerCase'](_RT_.lookup(_D_, 'config', 'textCart')));
_O_ += "</legend>";
if (!_RT_.lookup(_D_, 'config', 'canCreateCart') && _RT_.lookup(_D_, 'carts', 'length') === 1) {
_O_ += "<input type=\"hidden\" data-field=\"p_cart_name\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'carts', 0, 'id'));
_O_ += "\">";
} else {
_O_ += "<div class=\"tray__flex-row tray__flex-row--right-align\">\u000a<label for=\"which-add-";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'id'));
_O_ += "\">Which ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCart'));
_O_ += "</label>\u000a<select id=\"which-add-";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'id'));
_O_ += "\" class=\"form-control which-cart\" data-field=\"p_cart_name\">";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'carts'));
var _cart = null;
while ((_cart = _loop1.next()) !== null) {
_O_ += "<option value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_cart, 'id'));
_O_ += "\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_cart, 'name'));
_O_ += "</option>";
}
_O_ += "";
if (_RT_.lookup(_D_, 'config', 'canCreateCart')) {
_O_ += "<option value=\"\">Create a new ";
_O_ += _RT_.filters['safe'](_RT_.filters['toLowerCase'](_RT_.lookup(_D_, 'config', 'textCart')));
_O_ += "...</option>";
}
_O_ += "</select>\u000a</div>\u000a<div class=\"tray__flex-row tray__flex-row--right-align which-cart-name";
if (_RT_.lookup(_D_, 'carts', 'length')) {
_O_ += " hidden";
}
_O_ += "\">\u000a<label for=\"which-name-";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'id'));
_O_ += "\">New ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCart'));
_O_ += " Name</label>\u000a<input id=\"which-name-";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'id'));
_O_ += "\" type=\"text\" class=\"form-control which-cart\" data-field=\"p_cart_name\">\u000a</div>";
}
_O_ += "";
_O_ += _RT_.lookup(_D_, 'otherFields');
_O_ += "";
if (_RT_.lookup(_D_, 'item', 'inst')) {
_O_ += "<input type=\"hidden\" data-field=\"p_institution\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'inst'));
_O_ += "\">";
}
_O_ += "<input type=\"hidden\" data-field=\"p_crn\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'crn'));
_O_ += "\">\u000a<input type=\"hidden\" data-field=\"p_term_code\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'term'));
_O_ += "\">\u000a<input type=\"hidden\" data-field=\"p_meetinfo\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'hash'));
_O_ += "\">\u000a<div class=\"button-bar button-bar--right-align\">\u000a<button class=\"btn btn--inverse\" data-action=\"tray-remove\">CANCEL</button>\u000a<button class=\"btn\" data-action=\"cart-add\">OK</button>\u000a</div>\u000a</fieldset>\u000a</form>\u000a\u000a";
return _O_;
});

stache.register('trayCartRemove', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<form id=\"remove-cart-form\" class=\"add-remove-cart-form\">\u000a<fieldset>\u000a<legend>";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'code'));
_O_ += " section ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'section'));
_O_ += " in ";
_O_ += _RT_.filters['safe'](_RT_.filters['srcdbName'](_RT_.lookup(_D_, 'term')));
_O_ += " will be removed from your ";
_O_ += _RT_.filters['safe'](_RT_.filters['toLowerCase'](_RT_.lookup(_D_, 'config', 'textCart')));
_O_ += "</legend>";
if (_RT_.lookup(_D_, 'carts', 'length') === 1) {
_O_ += "<input type=\"hidden\" data-field=\"p_cart_name\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'carts', 0, 'id'));
_O_ += "\">";
} else {
_O_ += "<div class=\"tray__flex-row tray__flex-row--right-align\">\u000a<label for=\"which-remove-";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'id'));
_O_ += "\">Which ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textCart'));
_O_ += "</label>\u000a<select id=\"which-remove-";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'id'));
_O_ += "\" class=\"form-control\" data-field=\"p_cart_name\">";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'carts'));
var _cart = null;
while ((_cart = _loop1.next()) !== null) {
_O_ += "<option value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_cart, 'id'));
_O_ += "\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_cart, 'name'));
_O_ += "</option>";
}
_O_ += "</select>\u000a</div>";
}
_O_ += "";
if (_RT_.lookup(_D_, 'item', 'inst')) {
_O_ += "<input type=\"hidden\" data-field=\"p_institution\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'inst'));
_O_ += "\">";
}
_O_ += "<input type=\"hidden\" data-field=\"p_crn\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'crn'));
_O_ += "\">\u000a<input type=\"hidden\" data-field=\"p_term_code\" value=\"";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'term'));
_O_ += "\">\u000a<div class=\"button-bar button-bar--right-align\">\u000a<button class=\"btn btn--inverse\" data-action=\"tray-remove\">CANCEL</button>\u000a<button class=\"btn\" data-action=\"cart-remove\">OK</button>\u000a</div>\u000a</fieldset>\u000a</form>\u000a\u000a";
return _O_;
});

stache.register('calendarInfoBar', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"panel__info-bar-text calendar-message\" aria-hidden=\"true\"><br></div>\u000a\u000a";
return _O_;
});

stache.register('calendarTerm', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'config', 'textTermCalendar'));
_O_ += "</h3>\u000a<div class=\"section__content\">\u000a<svg class=\"termcalendar\" role=\"application\"></svg>\u000a<div class=\"termcalendardisclaimer\">";
_O_ += _RT_.lookup(_D_, 'config', 'textTermCalendarDisclaimer');
_O_ += "</div>\u000a</div>\u000a</div>\u000a\u000a";
return _O_;
});

stache.register('detailBody', function (_D_, _RT_) {
'use strict';
var _O_ = '';
_O_ += "\u0009\u000a\u0009\u0009<div class=\"cols pad--tlr-default\">\u000a<div class=\"text col-3 detail-courseinfo text--semibold text--huge\"><div class=\"dtl-course-code\">";
_O_ += _RT_.lookup(_D_, 'item', 'code');
_O_ += "</div>";
if (_RT_.lookup(_D_, 'item', 'section') && _RT_.lookup(_D_, 'item', 'section') !== _RT_.lookup(_D_, 'config', 'textValueVaries')) {
_O_ += "<div class=\"dtl-section\">Section ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'section'));
_O_ += ", Class Nbr ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_D_, 'item', 'crn'));
_O_ += "</div>";
}
_O_ += "</div>";
if (_RT_.lookup(_D_, 'item', 'title')) {
_O_ += "\u000a<div class=\"text col-8 detail-title text--huge\">";
_O_ += _RT_.lookup(_D_, 'item', 'title');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--blr-default\">";
if (_RT_.lookup(_D_, 'item', 'last_updated')) {
_O_ += "\u000a<div class=\"text detail-last_updated text--light\">Last Updated ";
_O_ += _RT_.filters['safe'](_RT_.filters['dbDate'](_RT_.lookup(_D_, 'item', 'last_updated')));
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--lr-default\">";
if (_RT_.lookup(_D_, 'item', 'hours_text')) {
_O_ += "\u000a<div class=\"text detail-hours_text\"><strong>Credit Hours:</strong> ";
_O_ += _RT_.lookup(_D_, 'item', 'hours_text');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--lr-default\">";
if (_RT_.lookup(_D_, 'item', 'seats')) {
_O_ += "\u000a<div class=\"text detail-seats\">";
_O_ += _RT_.lookup(_D_, 'item', 'seats');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--lr-default\">";
if (_RT_.lookup(_D_, 'item', 'grd')) {
_O_ += "\u000a<div class=\"text detail-grd\"><strong>Grading Mode:</strong> ";
_O_ += _RT_.lookup(_D_, 'item', 'grd');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--lr-default\">";
if (_RT_.lookup(_D_, 'item', 'xlist')) {
_O_ += "\u000a<div class=\"text detail-xlist\"><strong>Meets with</strong> ";
_O_ += _RT_.lookup(_D_, 'item', 'xlist');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--lr-default\">";
if (_RT_.lookup(_D_, 'item', 'campus')) {
_O_ += "\u000a<div class=\"text detail-campus\"><strong>Campus:</strong> ";
_O_ += _RT_.lookup(_D_, 'item', 'campus');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--lr-default\">";
if (_RT_.lookup(_D_, 'item', 'instmode_html')) {
_O_ += "\u000a<div class=\"text detail-instmode_html\"><strong>Instruction Method:</strong> ";
_O_ += _RT_.lookup(_D_, 'item', 'instmode_html');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row pad--blr-default\">";
if (_RT_.lookup(_D_, 'item', 'dates_html')) {
_O_ += "\u000a<div class=\"text detail-dates_html\"><strong>Dates:</strong> ";
_O_ += _RT_.lookup(_D_, 'item', 'dates_html');
_O_ += "</div>\u000a";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'notes', 'length')) {
_O_ += "<div class=\"section\">\u000a<h4 class=\"section__title\">Registration Notes</h4>\u000a<div class=\"section__content\"><ul class=\"course-notes\">";
var _loop1 = new _RT_.Iterable(_RT_.lookup(_D_, 'item', 'notes'));
var _note = null;
while ((_note = _loop1.next()) !== null) {
_O_ += "<li><i class=\"fa icon--";
_O_ += _RT_.filters['safe'](_RT_.lookup(_note, 'type'));
_O_ += "\"></i> ";
_O_ += _RT_.filters['safe'](_RT_.lookup(_note, 'text'));
_O_ += "</li>";
}
_O_ += "</ul></div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'restrict_info')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Registration Restrictions</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'restrict_info');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'clssnotes')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Class Notes</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'clssnotes');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'description')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Description</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'description');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'meeting_html')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Schedule and Location</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'meeting_html');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'exams_html')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Final Exam</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'exams_html');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'instructordetail_html')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Instructors</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'instructordetail_html');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'attributes')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Class Attributes</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'attributes');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'law')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Law Attributes</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'law');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'eval_links')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Evaluations</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'eval_links');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'books_html')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Textbooks</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'books_html');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'linkedhtml')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">Required Sections</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'linkedhtml');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u0009<div class=\"row\">";
if (_RT_.lookup(_D_, 'item', 'all_sections')) {
_O_ += "<div class=\"section\">\u000a<h3 class=\"section__title\">All Sections</h3>\u000a<div class=\"section__content\">";
_O_ += _RT_.lookup(_D_, 'item', 'all_sections');
_O_ += "</div>\u000a</div>";
}
_O_ += "</div>\u000a\u0009\u000a\u000a";
return _O_;
});



/* import /class-search//fose-custom.js */
/* A republish is required to activate edits to this file */

/* 2018-02-28 - Modifications to this file are deprecated. Use /localfocussearch/fose-parts/fose-append.js */


(function () {
	'use strict';

	sam.config.multiplePrimaryCarts = true;
	sam.cart.setApiTimeout(60000);

	var grademodes = {"ADM":"Admissions","CBE":"Credit by Exam","CCD":"Inter-Institutional (CCD)","CCP":"CCD Pooled (MAP)","CNM":"Conversion Metro","CNV":"Conversion","CPF":"CCD Pass/Fail","CRE":"Conversion Remedial","CU2":"CU to CU","GIP":"Letter Grade with IP","INP":"In Progress","LAW":"Law","LM1":"LLM1 Grading Exception","LM2":"LLM2 Grading Exception","LM3":"LLM3 Grading Exception","LM4":"LLM4 Grading Exception","LM5":"LLM5 Grading Exception","LTR":"Letter","MED":"Medical School","MEP":"Metro Pass/Fail","MET":"Metro Letter Grade","MPF":"Metro Pass/Fail","MSO":"Metro Student Option","NCG":"Non-Credit Good","NCL":"Non-Credit Letter","NCP":"Non-Credit Pass","NCS":"Non-Credit Satisfactory","NLI":"Non-Credit Letter no I","NOC":"No Credit Basis (Audit)","NON":"Non-Graded Component","OP2":"Student Option P/F and NC","OPT":"Student Option","P80":"Pre-80 GPA","PF1":"Pass/Fail","PF2":"Pass/Fail with IP","PF4":"Pass/Fail","PHF":"Pharmacy Course Forgiveness","RLT":"Remedial Letter","RPF":"Remedial Pass/Fail","RS2":"Remedial Student Option PF NC","RSO":"Remedial Student Option","TRN":"Transfer Grading Basis"};
	sam.config.levels = {"DENT":"Dentistry","DPT":"Doctor of Physical Therapy","GRAD":"Graduate","LAW":"Law","MED":"Medicine","NCHS":"Non-credit High School","NDGR":"Graduate Non-degree","NOCR":"Non-credit","PHAR":"Pharmacy","UGRD":"Undergraduate"};
/*
 * Turning this off for now
 * See Jalot #109 - Respect Mixed Case
	var courseCodeRegex = /^$/;
	foseConfig.searchRegexes.forEach(function (regex) {
		if (regex.mapsTo === 'alias') {
			courseCodeRegex = new RegExp(regex.regex);
		}
	});

	fose.events.on(
		'action.search.gathered',
		function (searchData) {
			searchData.server.criteria.forEach(function (crit) {
				if (crit.field === 'alias') {
					crit.field = 'keyword';

					var matches = courseCodeRegex.exec(crit.value);
					if (matches) {
						crit.value = matches[1] + ' ' + matches[2];
					}
				}
			});
		}
	);
*/

	fose.events.on(
		'tray.cart-add.beforeRender',
		function (data) {
			var otherFields = [];

			if (data.item && data.item.gmods) {
				otherFields.push(
					'<div class="tray__flex-row tray__flex-row--right-align">',
					'<label for="grade-mode-' + data.id + '">Grade Mode</label>',
					'<select id="grade-mode-' + data.id + '" data-field="p_gmod" class="form-control">'
				);

				var gmods = data.item.gmods.split(',');
				for (var i = 0; i < gmods.length; i++) {
					var gmod = gmods[i];
					otherFields.push('<option value="' + gmod + '">' + grademodes[gmod] + '</option>');
				}

				otherFields.push(
					'</select>',
					'</div>'
				);
			}

			if (data.item.hours !== data.item.hours_min) {
				otherFields.push(
					'<div class="tray__flex-row tray__flex-row--right-align">',
					'<label for="hours-' + data.id + '">Credit Hours</label>',
					'<input type="text" id="hours-' + data.id + '" data-field="p_hours" class="form-control" value="' +  data.item.hours_min + '">',
					'</div>'
				);
			}

			data.otherFields += otherFields.join('\n');
		}
	);

	fose.events.on(
		'panel.results.drawDone',
		function () {
			// Client requested that this message not appear in
			// the cart preflight messages.
			$('.result__warning:contains(You do not have access to validate)')
				.remove();
		}
	);

	fose.events.on(
		'panel.details.drawDone',
		function (panel) {
			var $seats = $(panel.content).find('.detail-seats');
			var seatsText = $seats.text();

			if (seatsText.toLowerCase().indexOf('varies') === 0) {
				$seats.html(
					'<strong>Maximum Enrollment</strong> / <strong>Seats Avail</strong>: ' + seatsText
				);
			}
		}
	);

	sam.events.on(
		'got-record',
		function () {
			// The current version of the student record does not
			// contain everything we need for carts.  Fetch that data
			// separately after the student record is retrieved.
			sam.cart.read();
		}
	);

})();
// From Title, Subject, Instructor or Keyword widget
fose.search.registerWidget(({selector:"#crit-keyword", field:"keyword", label:"Title, Subject, Instructor or Keyword"}));

// From Term widget
fose.search.registerWidget(({selector:"#crit-srcdb", field:"srcdb", label:"Term", gather:(function () {"use strict";var data = fose.search.baseGather(this);if (data) {data.post = {srcdb: data.criteria[0].value};data.criteria = [];}return data;})}));

// From Subject widget
fose.search.registerWidget(({selector:"#crit-subject", field:"subject", label:"Subject"}));

// From Campus widget
fose.search.registerWidget(({selector:"#crit-camp", field:"camp", label:"Campus"}));

// From Career widget
fose.search.registerWidget(({selector:"#crit-career", field:"career", label:"Career"}));

// From Course Level widget
fose.search.registerWidget(({selector:"#crit-course_level", field:"course_level", label:"Course Level"}));

// From Avoid Schedule Conflicts widget
fose.search.registerWidget(({selector:"#crit-no-overlap-cart", field:"no-overlap-cart", label:"Avoid Schedule Conflicts", gather:(function () {var data = fose.search.baseGather(this);if (data) {var srcdb = $("#crit-srcdb").val();var cart = sam.cart.getPrimaryCartID(srcdb);var cartContents = sam.cart.contents(cart, srcdb);var crns = [];cartContents.forEach(function (entry) {crns.push(entry.crn);});if (foseConfig.cartShowRegistered) {sam.record.registeredSections(srcdb).forEach(function (crn) {crns.push(crn);});}if (foseConfig.cartShowWaitlist) {sam.record.waitlistSections(srcdb).forEach(function (crn) {crns.push(crn);});}if (!crns.length) {return;}data.criteria = [{field: "cart", value: crns.join(",")}];return data;}})}));

// From SEARCH CLASSES widget
(function initStickySearchButton() {
    "use strict";
    if ("ActiveXObject" in window) {
        return;
    }
    var $sticky;
    $(function () {var $searchForm = $("#search-form");var $panelBody = $searchForm.parents(".panel__body");var $original = $("#search-button");var $clone = $original.clone().attr("id", "search-button-sticky");var $div = $("<div id=\"search-button-sticky-container\">").css("width", $searchForm.outerWidth() + "px").append($clone);$searchForm.prepend($div);var hidden = true;var showOffset = $original[0].offsetTop - $panelBody[0].offsetTop - 10;$panelBody.on("scroll", function () {if ($panelBody[0].scrollTop >= showOffset) {if (hidden) {hidden = false;$div.show();}} else {if (!hidden) {hidden = true;$div.hide();}}});window.addEventListener("resize", function () {$div.css("width", $searchForm.outerWidth() + "px");});});
})();

// From Session widget
fose.search.registerWidget(({selector:"#crit-session", field:"session", label:"Session"}));

// From Open, Waitlisted, or Closed widget
fose.search.registerWidget(({selector:"#crit-stat", field:"stat", label:"Open, Waitlisted, or Closed"}));

// From Waitlist Type widget
fose.search.registerWidget(({selector:"#crit-waitlist_type", field:"waitlist_type", label:"Waitlist Type"}));

// From Meeting Time widget
fose.search.registerWidget(({selector:"#crit-overlap", field:"overlap", label:"Meeting Time"}));

// From A&S GenEd Attributes (Fall 2018+) widget
fose.search.registerWidget(({selector:"#crit-asgened", field:"asgened", label:"A&S GenEd Attributes (Fall 2018+)", gather:(function () {"use strict";var data = fose.search.baseGather(this);if (data) {data.criteria.forEach(function (crit) {var baseValue = crit.value;var colonIndex = baseValue.indexOf(":");if (colonIndex !== - 1) {crit.field = baseValue.substr(0, colonIndex);crit.value = baseValue.substr(colonIndex + 1);} else {crit.field = baseValue;crit.value = "Y";}});}return data;})}));

// From A&S Core Attribute  widget
fose.search.registerWidget(({selector:"#crit-arsc", field:"arsc", label:"A&S Core Attribute ", gather:(function () {"use strict";var data = fose.search.baseGather(this);if (data) {data.criteria.forEach(function (crit) {var baseValue = crit.value;var colonIndex = baseValue.indexOf(":");if (colonIndex !== - 1) {crit.field = baseValue.substr(0, colonIndex);crit.value = baseValue.substr(colonIndex + 1);} else {crit.field = baseValue;crit.value = "Y";}});}return data;})}));

// From Class Type widget
fose.search.registerWidget(({selector:"#crit-schd", field:"schd", label:"Class Type"}));

// From Instruction Mode widget
fose.search.registerWidget(({selector:"#crit-instmode", field:"instmode", label:"Instruction Mode"}));

// From Credit Hours widget
fose.search.registerWidget(({selector:"#crit-hours", field:"hours", label:"Credit Hours", gather:(function () {"use strict";var data = fose.search.baseGather(this);if (data) {var value = data.criteria[0].value;var plus = value.indexOf("+");if (plus === - 1) {data.criteria.push({field: "hours_min", value: "<=" + value});} else {value = value.substr(0, plus);}data.criteria[0].value = ">=" + value;return data;}})}));

// From Other Attributes widget
fose.search.registerWidget(({selector:"#crit-othattrs", field:"othattrs", label:"Other Attributes", gather:(function () {"use strict";var data = fose.search.baseGather(this);if (data) {data.criteria.forEach(function (crit) {var baseValue = crit.value;var colonIndex = baseValue.indexOf(":");if (colonIndex !== - 1) {crit.field = baseValue.substr(0, colonIndex);crit.value = baseValue.substr(colonIndex + 1);} else {crit.field = baseValue;crit.value = "Y";}});}return data;})}));

// From Other Carts widget
fose.events.on('action.search.done', function reset() {"use strict";var select = document.getElementById("crit-other-carts");if (select) {select.selectedIndex = 0;}});
fose.events.on('action.primary-cart.done', function reset() {"use strict";var select = document.getElementById("crit-other-carts");if (select) {select.selectedIndex = 0;}});
sam.events.on('got-record', function updateOtherCarts() {"use strict";var others = sam.cart.others();var select = document.getElementById("crit-other-carts");if (select) {for (var i = 0; i < select.options.length; i++) {var option = select.options[i];if (option.value !== "") {select.removeChild(option);i--;}}if (!Array.isArray(foseConfig.srcDBs)) {foseConfig.srcDBs = [foseConfig.srcDBs];}var knownTerms = {};foseConfig.srcDBs.forEach(function (srcdb) {if (srcdb && srcdb.contains === "") {knownTerms[srcdb.code] = true;}});for (var j = 0; j < others.length; j++) {var cart = others[j];if (cart.term in knownTerms) {var option = document.createElement("option");option.value = cart.term + "|" + cart.id;option.innerText = cart.name + " (" + fose.srcdb.name(cart.term) + ")";select.appendChild(option);}}}});
sam.events.on('got-cart', function updateOtherCarts() {"use strict";var others = sam.cart.others();var select = document.getElementById("crit-other-carts");if (select) {for (var i = 0; i < select.options.length; i++) {var option = select.options[i];if (option.value !== "") {select.removeChild(option);i--;}}if (!Array.isArray(foseConfig.srcDBs)) {foseConfig.srcDBs = [foseConfig.srcDBs];}var knownTerms = {};foseConfig.srcDBs.forEach(function (srcdb) {if (srcdb && srcdb.contains === "") {knownTerms[srcdb.code] = true;}});for (var j = 0; j < others.length; j++) {var cart = others[j];if (cart.term in knownTerms) {var option = document.createElement("option");option.value = cart.term + "|" + cart.id;option.innerText = cart.name + " (" + fose.srcdb.name(cart.term) + ")";select.appendChild(option);}}}});

(function dbTimeFormatter() {"use strict";stache.filter("dbDate", function stacheDate(value) {var ts = Date.parse(value);if (isNaN(ts)) {return value;}return (new Date(ts)).toLocaleString();});})();

// From widget all_sections
fose.events.on('panel.details.drawDone', function panelDetailsDrawDone(panel) {"use strict";if (!panel) {return;}var data = panel.data();var matchedKeys = {};var hasMatched = !!data.client.matched;if (hasMatched) {var colon = data.client.matched.indexOf(":");var matchedKey = data.client.matched.substr(0, colon);data.client.matched.substr(colon + 1).split(",").forEach(function (value) {matchedKeys[matchedKey + ":" + value] = true;});}$(".course-section", panel.element).each(function eachCourseSection() {var $this = $(this);var key = $this.attr("data-key");if (key === data.client.key) {$this.addClass("course-section--viewing");}if (hasMatched) {$this.attr("data-matched", data.client.matched);if (matchedKeys[key]) {$this.addClass("course-section--matched");} else {$this.addClass("course-section--not-matched");}}});});
